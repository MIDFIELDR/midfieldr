---
output: github_document
bibliography: inst/REFERENCES.bib
csl: inst/information-science-and-technology.csl
link-citations: yes
always_allow_html: true
resource_files:
  - man/figures/README-midfielddata-help-page-1.png
  - man/figures/README-midfieldr-help-page-1.png
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup}
#| echo: false

# code chunks
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = FALSE
)

# figures
knitr::opts_chunk$set(
  fig.path = "man/figures/README-",
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center"
)

# inline numbers
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
```

```{r}
#| echo: false

# Printing options for data.table
options(
  datatable.print.nrows = 10,
  datatable.print.topn = 5,
  datatable.print.class = TRUE
)
```


<br>`midfieldr` is an R package that provides tools and methods for studying undergraduate student-level records from the MIDFIELD database. Practice data supplied by `midfielddata`. 

![](https://github.com/MIDFIELDR/midfieldr/blob/main/docs/logo.png?raw=true)

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/midfieldr)](https://CRAN.R-project.org/package=midfieldr)
[![R-CMD-check](https://github.com/MIDFIELDR/midfieldr/workflows/R-CMD-check/badge.svg)](https://github.com/MIDFIELDR/midfieldr/actions)
[![codecov](https://codecov.io/gh/MIDFIELDR/midfieldr/branch/main/graph/badge.svg?token=KcuCzBkLBP)](https://app.codecov.io/gh/MIDFIELDR/midfieldr)

<!-- [![CRAN check](https://badges.cranchecks.info/summary/midfieldr.svg)](https://cran.r-project.org/web/checks/check_results_midfieldr.html) -->
<!-- badges: end -->



## Introduction

`midfieldr` provides functions for working with undergraduate "student-level" data from the MIDFIELD database. Data at the "student-level" refers to information about individual students including demographics, programs, academic standing, courses, grades, and degrees. For [more information] on data structure, see the companion `R` package `midfielddata`. 


`midfieldr` services include: 

- `add_completion_status()` Determine completion status for every student
- `add_data_sufficiency()` Determine data sufficiency for every student
- `add_timely_term()` Calculate a timely completion term for every student
- `filter_cip()` Subset rows that include matches to search strings
- `order_multiway()` Order categorical variables of multiway data
- `prep_fye_mice()` Prepare FYE data for multiple imputation
- `same_content()` Test for equal content between two data tables
- `select_required()` Select required midfieldr variables


```{r}
# Tools and methods
library(midfieldr)
packageVersion("midfieldr")

# Practice data
library(midfielddata)
packageVersion("midfielddata")

# Rendered
format(Sys.Date(), "%Y-%m-%d")
```

*Note on syntax.* &nbsp; We use `data.table` syntax for data manipulation. Other systems, e.g., base R or `dplyr`, could be used instead; each system has its strengths. Users are welcome to translate our examples to their preferred syntax. 





## Usage

A typical workflow for studying student-level records includes:  

- Plan which records, programs, and metrics to use 
- Gather relevant blocs of records
- Join appropriate grouping variables 
- Compute metrics 
- Create tables and charts to display results
- Assess findings and iterate.

In this example, we summarize the graduation status of engineering students by race/ethnicity and sex. 

```{r}
# For data manipulation
library(data.table)

# Load the practice data
data(student, term, degree)
```

Reduce initial dimensions of data tables using `select_required()`. 

```{r}
# Reduce dimensions of source data tables
student <- select_required(student)
term <- select_required(term)
degree <- select_required(degree)
```

Filter for data sufficiency using `add_timely_term()` and `add_data_sufficiency()`. 

```{r}
# Initialize the working data frame
DT <- term[, .(mcid, cip6)]

# Filter observations for data sufficiency
DT <- add_timely_term(DT, term)
DT <- add_data_sufficiency(DT, term)
DT <- DT[data_sufficiency == "include"]
```

Determine completion status using `add_completion_status()`. 

```{r}
# Inner join to filter observations for degree-seeking
cols_we_want <- student[, .(mcid)]
DT <- cols_we_want[DT, on = c("mcid"), nomatch = NULL]

# Filter observations for engineering programs
DT <- DT[cip6 %like% "^14"]

# Filter observations for unique students (first instance)
DT <- DT[, .SD[1], by = c("mcid")]

# Add completion status variable
DT <- add_completion_status(DT, degree)
```

Aggregate observations by groupings and display results.

```{r}
# Left join to add race/ethnicity and sex variables (omit unknowns)
cols_we_want <- student[, .(mcid, race, sex)]
DT <- student[DT, on = c("mcid")]
DT <- DT[!(race %ilike% "unknown" | sex %ilike% "unknown")]

# Create a variable combining race/ethnicity and sex
DT[, people := paste(race, sex)]

# Aggregate observations by groupings
DT_display <- DT[, .N, by = c("completion_status", "people")]

# Transform to row-record form
DT_display <- dcast(DT_display, people ~ completion_status, value.var = "N", fill = 0)

# Prepare the table for display
setcolorder(DT_display, c("people", "timely", "late"))
setkeyv(DT_display, c("people"))
setnames(DT_display,
  old = c("people", "timely", "late", "NA"),
  new = c("People", "Timely completion", "Late completion", "Did not complete")
)
```

Tabulated results of usage example are shown in Table 2, ordered alphabetically. "Timely completion" is the count of graduates completing their programs in no more than 6 years; "Late completion" is the count of those graduating in more than 6 years; "Did not complete" is the count of non-graduates. 

```{r}
#| echo: false
DT_display |>
  kableExtra::kbl(align = "lrrr", caption = "Table 2: Completion status of engineering undergraduates in the practice data") |>
  kableExtra::kable_paper(lightable_options = "basic", full_width = TRUE) |>
  kableExtra::row_spec(0, background = "#c7eae5") |>
  kableExtra::column_spec(1:4, color = "black", background = "white")
```












## Installation

Install with: 

```{r}
#| eval: false
install.packages("midfieldr",
  repos = "https://MIDFIELDR.github.io/drat/",
  type = "source"
)
```

Alternatively, you can install the development version from the MIDFIELD GitHub repository:

```{r}
#| eval: false
install.packages("devtools")
devtools::install_github("MIDFIELDR/midfieldr")
```











## More information

[`midfielddata`](https://midfieldr.github.io/midfielddata/)

: A companion `R` package containing a proportionate, stratified sample of the  MIDFIELD database to practice using the tools and methods provided by `midfieldr`.  


[MIDFIELD](https://midfield.online/)

: A database of student-level records for approximately 1.7M undergraduates at nineteen US institutions from 1987 through 2018, of which `midfielddata`  provides a sample. The full research database is currently accessible to MIDFIELD partner institutions only. 



 
 
 
## Acknowledgments

This work is supported by a grant from the US National Science Foundation (EEC 1545667).

```{r}
#| echo: false

# to change the CSS file
# per https://github.com/rstudio/rmarkdown/issues/732
knitr::opts_chunk$set(echo = FALSE)
```

