---
output: github_document
bibliography: inst/REFERENCES.bib
csl: inst/information-science-and-technology.csl
link-citations: yes
always_allow_html: true
resource_files:
  - man/figures/README-midfielddata-help-page-1.png
  - man/figures/README-midfieldr-help-page-1.png
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup}
#| echo: false

# code chunks
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  collapse = FALSE,
  comment = "#>",
  error = FALSE
)

# figures
knitr::opts_chunk$set(
  fig.path = "man/figures/README-",
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center"
)

# inline numbers
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
```

```{r}
#| echo: false

# Printing options for data.table
options(
  datatable.print.nrows = 10,
  datatable.print.topn = 5,
  datatable.print.class = TRUE
)
```


# midfieldr

Tools for Studying MIDFIELD Student Unit Record Data in R

<!-- badges: start -->
[![R-CMD-check](https://github.com/MIDFIELDR/midfieldr/workflows/R-CMD-check/badge.svg)](https://github.com/MIDFIELDR/midfieldr/actions)
[![codecov](https://codecov.io/gh/MIDFIELDR/midfieldr/branch/main/graph/badge.svg?token=KcuCzBkLBP)](https://app.codecov.io/gh/MIDFIELDR/midfieldr)
[![CRAN status](https://www.r-pkg.org/badges/version/midfieldr)](https://CRAN.R-project.org/package=midfieldr)
[![License: GPL v2](https://img.shields.io/badge/License-GPL%20v2-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html)
<!-- badges: end -->


The goal of midfieldr is to provide tools and guides for working with longitudinal data from the MIDFIELD database.  

## Overview 

[**MIDFIELD**](https://midfield.online){target="_blank"} (as of June 2022) contains Student Unit Records (SURs) of 1.7M undergraduates at nineteen US institutions from 1987 through 2018, though different institutions provide data over different time spans. MIDFIELD is large enough to permit summarizing by multiple characteristics such as race/ethnicity, sex, and program.

Access to the MIDFIELD research database is currently limited to MIDFIELD partner institutions. However, a sample of the data are accessible via the midfielddata R package. 

**midfieldr** is an R package that provides tools for working with MIDFIELD SURs, both MIDFIELD research data and midfielddata practice data.

[**midfielddata**](https://midfieldr.github.io/midfielddata/) is an R data package that provides a proportionate stratified sample of the MIDFIELD research data. The sample contains anonymized SURs for nearly 98,000 undergraduates at 12 institutions from 1987--2016. We refer to these sample data tables as the MIDFIELD *practice* data, suitable for practice working with SURs but not for drawing inferences about program attributes or student experiences. The practice data are characterized in Table 1. 

```{r}
#| echo: false

wrapr::build_frame(
  "Practice data table", "Each row is", "No. of rows", "No. of columns", "Memory" |
    "course", "a student in a course", "3,439,936", "12", "340 Mb" |
    "term", "a student in a term", "710,841", "13", "80 Mb" |
    "student", "a degree-seeking student", "97,640", "13", "19 Mb" |
    "degree", "a student who graduates", "47,499", "5", "10.2 Mb"
) |>
  kableExtra::kbl(
    align = "llrrr",
    caption = "Table 1: Attributes of the practice data tables in midfielddata"
  ) |>
  kableExtra::kable_paper(lightable_options = "basic", full_width = TRUE) |>
  kableExtra::row_spec(0, background = "#c7eae5") |>
  kableExtra::column_spec(1, monospace = TRUE) |>
  kableExtra::column_spec(1:4, color = "black", background = "white")
```

All four data tables (in both the research data and the practice data) are keyed by student ID. The `course` table  has multiple observations (rows) per student with one observation per student per course. The `term` table also has multiple rows per student, with one observation per student per term. The `student` and `degree` tables each have one observation per student. 

## Usage

The outline of a typical workflow is: 

- Plan which records, programs, and metrics to use 
- Gather relevant blocs of records
- Join appropriate grouping variables 
- Compute metrics 
- Create tables and charts to display results
- Assess findings and iterate.

To illustrate usage, we tabulate counts of engineering students by race/ethnicity, sex, and graduation status. Data processing is performed using data.table syntax. 

```{r}
# Packages used
library("midfieldr")
library("midfielddata")
library("data.table")

# Load the practice data
data(student, term, degree, package = "midfielddata")

# Reduce dimensions of source data tables
student <- select_required(student)
term <- select_required(term)
degree <- select_required(degree)

# Initialize the working data frame
DT <- term[, .(mcid, cip6)]

# Filter observations for data sufficiency
DT <- add_timely_term(DT, term)
DT <- add_data_sufficiency(DT, term)
DT <- DT[data_sufficiency == "include"]

# Inner join to filter observations for degree-seeking
cols_we_want <- student[, .(mcid)]
DT <- cols_we_want[DT, on = c("mcid"), nomatch = NULL]

# Filter observations for engineering programs
DT <- DT[cip6 %like% "^14"]

# Filter observations for unique students (first instance)
DT <- DT[, .SD[1], by = c("mcid")]

# Add completion status variable
DT <- add_completion_status(DT, degree)

# Left join to add race/ethnicity and sex variables (omit unknowns)
cols_we_want <- student[, .(mcid, race, sex)]
DT <- student[DT, on = c("mcid")]
DT <- DT[!(race %ilike% "unknown" | sex %ilike% "unknown")]

# Create a variable combining race/ethnicity and sex
DT[, people := paste(race, sex)]

# Aggregate observations by groupings
DT_display <- DT[, .N, by = c("completion_status", "people")]

# Transform to row-record form
DT_display <- dcast(DT_display, people ~ completion_status, value.var = "N")

# Prepare the table for display
setcolorder(DT_display, c("people", "timely", "late"))
setkeyv(DT_display, c("people"))
setnames(DT_display,
  old = c("people", "timely", "late", "NA"),
  new = c("People", "Timely completion", "Late completion", "Did not complete")
)
```

Tabulated results of usage example are shown in Table 2, ordered alphabetically. "Timely completion" is the count of graduates completing their programs in no more than 6 years; "Late completion" is the count of those graduating in more than 6 years; "Did not complete" is the count of non-graduates. 

```{r}
#| echo: false
DT_display |>
  kableExtra::kbl(align = "lrrr", caption = "Table 2: Completion status of engineering undergraduates in the practice data") |>
  kableExtra::kable_paper(lightable_options = "basic", full_width = TRUE) |>
  kableExtra::row_spec(0, background = "#c7eae5") |>
  kableExtra::column_spec(1:4, color = "black", background = "white")
```





## Documentation

- [Articles.](https://midfieldr.github.io/midfieldr/articles/){target="_blank"} For a listing of all vignettes. 
- [Reference (midfieldr).](https://midfieldr.github.io/midfieldr/reference/){target="_blank"} For a listing of all midfieldr functions and prepared data. 
- [Reference (midfielddata).](https://midfieldr.github.io/midfielddata/reference/){target="_blank"} For a listing of the four practice MIDFIELD data tables. 







## Requirements {#requirements}

- [R](https://www.r-project.org/){target="_blank"} (>= 3.5.0)
- [data.table](https://rdatatable.gitlab.io/data.table/){target="_blank"} (>= 1.9.8)   
- [ggplot2](https://ggplot2.tidyverse.org/){target="_blank"} recommended for data graphics, but not required.






## Install midfieldr {#install-midfieldr}

midfieldr is not yet available from [CRAN](https://cran.r-project.org/). To install the development version of midfieldr from its `drat` repository, type in the Console: 

``` r
# Install midfieldr from drat repo
install.packages("midfieldr", 
                 repos = "https://MIDFIELDR.github.io/drat/", 
                 type = "source")
```

You can confirm a successful installation by running the following lines to bring up the package help page in the Help window. 

```{r}
#| eval: false

# Run in Console
library("midfieldr")
help("midfieldr-package")
```

![](man/figures/README-midfieldr-help-page-1.png){width="100%"}




## Install midfielddata {#install-midfielddata}

Because of its size, installing the practice data takes time; please be patient and wait for the prompt “>” to reappear. In the Console, run:

``` r
# Install midfielddata  
install.packages("midfielddata", 
                 repos = "https://MIDFIELDR.github.io/drat/", 
                 type = "source")
# be patient
``` 

You can confirm a successful installation by running the following lines to bring up the package help page in the Help window. 

```{r}
#| eval: false

# Run in Console
library("midfielddata")
help("midfielddata-package")
```

![](man/figures/README-midfielddata-help-page-1.png){width="100%"}





## Contributing

To contribute to midfieldr,

- Please clone this repo locally.  
- Commit your contribution on a separate branch.
- If you submit a function, please use the _checkmate_ package to include runtime argument checks and the _tinytest_ package to write unit tests for your code. Save tests in the `inst/tinytest/` directory. 

To provide feedback or report a bug,  

- Use the GitHub [Issues](https://github.com/MIDFIELDR/midfieldr/issues){target="_blank"} page. 
- Please run the package unit tests and report the results with your bug report. Any user can run the package tests by installing the _tinytest_ package and running: 

```{r}
#| eval: false

# Detailed test results
test_results <- tinytest::test_package("midfieldr")
as.data.frame(test_results)
```


Participation in this open source project is subject to a [Code of Conduct](CONDUCT.html).








## Acknowledgments

This work is supported by a grant from the US National Science Foundation (EEC 1545667).






## License

midfieldr is licensed under GPL (>= 2.0) [(full license)](LICENSE.html)   
&copy; 2018--2022 Richard Layton, Russell Long, Susan Lord, Matthew Ohland, and Marisa Orr. 


```{r}
#| echo: false

# to change the CSS file
# per https://github.com/rstudio/rmarkdown/issues/732
knitr::opts_chunk$set(echo = FALSE)
```

