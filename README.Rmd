---
output: github_document 
bibliography: inst/REFERENCES.bib 
always_allow_html: true 
link-citations: yes 
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r child = "man/rmd/common-setup.Rmd"}
```

```{r}
#| include: false
knitr::opts_chunk$set(fig.path = "man/figures/README-")
```

<br>midfieldr is an R package that provides tools and methods for studying undergraduate student-level records from the MIDFIELD database.  

```{r}
#| echo: false
#| out.width: "15%"
knitr::include_graphics("man/figures/logo.png")
```

<!-- badges: start -->
[![R-CMD-check](https://github.com/MIDFIELDR/midfieldr/workflows/R-CMD-check/badge.svg)](https://github.com/MIDFIELDR/midfieldr/actions)    
[![CRAN status](https://www.r-pkg.org/badges/version/midfieldr)](https://CRAN.R-project.org/package=midfieldr)    
[![codecov](https://codecov.io/gh/MIDFIELDR/midfieldr/branch/main/graph/badge.svg?token=KcuCzBkLBP)](https://app.codecov.io/gh/MIDFIELDR/midfieldr)

<!-- [![CRAN check](https://badges.cranchecks.info/summary/midfieldr.svg)](https://cran.r-project.org/web/checks/check_results_midfieldr.html) -->
<!-- badges: end -->




## Introduction

```{r child = "man/rmd/note-description-paragraph.Rmd"}
```

midfieldr provides these functions for processing student-level data: 

- `add_completion_status()` Determine completion status for every student
- `add_data_sufficiency()` Determine data sufficiency for every student
- `add_timely_term()` Calculate a timely completion term for every student
- `filter_cip()` Filter CIP data to match search strings
- `prep_fye_mice()` Prepare FYE data for multiple imputation
- `select_required()` Select required midfieldr variables

Additional functions for processing intermediate results: 

- `order_multiway()` Order categorical variables of multiway data
- `same_content()` Test for equal content between two data tables

*Notes on syntax.* &nbsp;   Throughout this work, we use the data.table package for data manipulation [@Dowle+Srinivasan:2022:data.table] and the ggplot2 package for charts [@Wickham:2016:ggplot2]. Some users may prefer base R or dplyr for data [@Wickham:2022:dplyr], or lattice for charts [@Sarkar:2008]. Each system has its strengths---users are welcome to translate our examples to their preferred syntax.





## Usage

In this example, we gather all students ever enrolled in Engineering and summarize their graduation status (in any major), grouping by race/ethnicity and sex. If you are writing your own script to follow along, we use these packages in this example:

```{r}
library(midfieldr)
library(midfielddata)
library(data.table)
```

Load the practice data. Reduce initial dimensions of data tables. 

```{r}
# Load the practice data
data(student, term, degree)

# Reduce dimensions of source data tables
student <- select_required(student)
term <- select_required(term)
degree <- select_required(degree)

# View example result
term
```

Filter for data sufficiency. 

```{r}
# Initialize the working data frame
DT <- term[, .(mcid, cip6)]

# Filter observations for data sufficiency
DT <- add_timely_term(DT, term)
DT <- add_data_sufficiency(DT, term)
DT <- DT[data_sufficiency == "include"]
DT
```

Filter for degree-seeking students ever enrolled in Engineering. 

```{r}
# Inner join to filter observations for degree-seeking
cols_we_want <- student[, .(mcid)]
DT <- cols_we_want[DT, on = c("mcid"), nomatch = NULL]

# Filter observations for engineering programs
DT <- DT[cip6 %like% "^14"]

# Filter observations for unique students (first instance)
DT <- DT[, .SD[1], by = c("mcid")]
DT
```

Determine completion status. 

```{r}
# Add completion status variable
DT <- add_completion_status(DT, degree)
DT
```

Aggregate observations by groupings.

```{r}
# Left join to add race/ethnicity and sex variables (omit unknowns)
cols_we_want <- student[, .(mcid, race, sex)]
DT <- student[DT, on = c("mcid")]
DT <- DT[!(race %ilike% "unknown" | sex %ilike% "unknown")]

# Create a variable combining race/ethnicity and sex
DT[, people := paste(race, sex)]

# Aggregate observations by groupings
DT_display <- DT[, .N, by = c("completion_status", "people")]
setorderv(DT_display, c("completion_status", "people"))
DT_display
```

Reshape and display results. 

```{r}
# Transform to row-record form
DT_display <- dcast(DT_display, people ~ completion_status, value.var = "N", fill = 0)

# Prepare the table for display
setcolorder(DT_display, c("people", "timely", "late"))
setkeyv(DT_display, c("people"))
setnames(DT_display,
  old = c("people", "timely", "late", "NA"),
  new = c("People", "Timely completion", "Late completion", "Did not complete")
)
```

```{r}
#| echo: false
DT_display |>
  kableExtra::kbl(align = "lrrr", caption = "Table 1: Completion status of engineering undergraduates in the practice data") |>
  kableExtra::kable_paper(lightable_options = "basic", full_width = TRUE) |>
  kableExtra::row_spec(0, background = "#c7eae5") |>
  kableExtra::column_spec(1:4, color = "black", background = "white")
```

"Timely completion" is the count of graduates completing their programs in no more than 6 years; "Late completion" is the count of those graduating in more than 6 years; "Did not complete" is the count of non-graduates. 

```{r child = "man/rmd/note-for-practice-only-1.Rmd"}
```








## Installation

Install the current release with:

```{r}
#| eval: false
install.packages("midfieldr")
```

Alternatively, one can install the current release from our drat repository: 

```{r}
#| eval: false
install.packages("midfieldr",
  repos = "https://MIDFIELDR.github.io/drat/",
  type = "source"
)
```

One can install the development version from our GitHub repository:

```{r}
#| eval: false
install.packages("pak")
pak::pkg_install("MIDFIELDR/midfieldr")
```

Link to installation instructions for midfielddata below. 









## More information

```{r child = "man/rmd/note-midfielddata-and-midfield.Rmd"}
```

[MIDFIELD Institute](https://midfieldr.github.io/2023-midfield-institute/). &nbsp; Materials from the 2023 workshop, including an introduction to R for beginners, chart basics with ggplot2, and data basics with data.table. 

 
 
 
 
## Acknowledgments

```{r child = "man/rmd/note-nsf-grant.Rmd"}
```

## References

<div id="refs">

```{r child = "man/rmd/common-closing.Rmd"}
```



