---
title: "Gather programs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Gather programs}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
csl: ../inst/journal-of-glaciology.csl
link-citations: yes
---

```{r setup, include = FALSE}
source("vignette-knitr-opts.R")
knitr::opts_chunk$set(fig.path = "../man/figures/vignette-get-programs-")
```

Focus on midfieldr functions:

- `label_programs()` 

## Introduction 

While CIP data include 2-, 4-, and 6-digit program codes and names, all program data in MIDFIELD is encoded using only the 6-digit codes. Thus, once we have identified the 6-digit CIP codes for the programs we wish to study, we collect them and label them with program names suitable for grouping, summarizing, and joining operations. 

```{r}
# packages used
library(midfieldr)
library(data.table)

# data.table, print max 20 rows, otherwise 5 rows head/tail
options(datatable.print.nrows = 20, datatable.print.topn = 5)
```




## Determine the CIP subset

In the *Explore program CIP codes* vignette [(link)](explore_cip.html), we obtain the subset of CIP codes and names for the engineering case study. These data are included with midfieldr as the built-in data set `exa_cip`. View its help page by loading midfieldr and running

```r
? exa_cip 
```

The data are loaded with midfieldr. 

```{r}
# view the example CIP
exa_cip
```





<br>
<a href="#top">&#9650; top of page</a>  





## Extract and label programs

`label_programs()` is used to to extract 6-digit codes (and names) and to label groups of programs to suit our purposes. The result is used to filter the student-record data sets (students, courses, terms, or degrees) for the analysis at hand.

In the example data, the program names at the 4-digit level are those associated with accredited engineering departments. To see the names in full, 

```{r}
# case study CIP subset
columns_we_want <- c("cip4", "cip4name")
exa_cip4 <- exa_cip[, ..columns_we_want]

# examine the result
exa_cip4
```

Three of these names (Civil, Industrial, and Mechanical) are concise enough for small-multiple or faceted graphs. The Electrical program name is inconveniently long.  

Two approaches to editing the program labels are shown below. 

### 1. Work with one program one at a time

We separate `exa_cip` into four data frames, one for each program. 

```{r}
# work with programs one at a time and bind
# get civil engineering
cve_cip <- get_cip(exa_cip, keep_any = "^1408")
cve_cip
```

We operate on the result with `label_programs()` to extract its 6-digit columns. The `label` argument creates the label in a new column called `program`, used later for grouping, summarizing, and joining. 

```{r}
# keep the 6-digit CIP and add a program label
cve <- label_programs(cve_cip, label = "Civil Engineering")
cve
```

Repeat for electrical engineering.  

```{r}
# get electrical  engineering
ele_cip <- get_cip(exa_cip, keep_any = "^1410")
ele <- label_programs(ele_cip, label = "Electrical Engineering")
ele
```

For industrial and mechanical engineering, we assign the default 4-digit CIP name using the option `label = "cip4name"`. 

```{r}
# get mechanical  engineering
mce_cip <- get_cip(exa_cip, keep_any = "^1419")
mce <- label_programs(mce_cip, label = "cip4name")
mce

# get industrial engineering
ise_cip <- get_cip(exa_cip, keep_any = "^1435")
ise <- label_programs(ise_cip, label = "cip4name")
ise
```

We have 4 data frames that we combine row-wise. We can see that our custom program names are consistent with the default 6-digit CIP names, so we can dispense with the `cip6names` column. 

```{r }
# gather the programs in the study
program_group <- rbind(cve, ele, ise, mce)

# delete the verbose column
program_group[, cip6name := NULL]

# examine the result
program_group
```

### 2. Work with all programs in one data frame

Alternatively, we can operate on one data frame throughout. We assign the 4-digit name as our preliminary program label. 

```{r}
# work with programs all in one data frame
program_group <- label_programs(exa_cip, label = "cip4name")

# delete the verbose column
program_group[, cip6name := NULL]

# examine the result
program_group
```

Then we edit the electrical programs only.  

```{r}
# identify the CIP rows that start with 1410
rows_to_edit <- startsWith(program_group$cip6, "1410")

# relabel the electrical programs
program_group[rows_to_edit, program := "Electrical Engineering"]

# examine the result
program_group
```

For convenience, this program group is included in midfieldr as the built-in data set `exa_group`. View its help page by running

```r
? exa_group
```


<br>
<a href="#top">&#9650; top of page</a> 



## Options for the program argument

In this section, we explore three options for `program` argument in `label_programs()`. 

### Option 1. Assign any string

When a string of our own choosing is assigned to `program`, then that string (with some exceptions) is the value assigned to every observation. In the previous example, we used this option for Electrical Engineering. 

Here we use this option for CIP code 31 programs: Parks, Recreation, Leisure and Fitness Studies.

```{r}
# assign an arbitrary program name
sub_cip <- get_cip(cip, keep_any = "^31")
program_group <- label_programs(sub_cip, label = "Leisure Studies")
```

```{r echo = FALSE}
kable2html(program_group)
```

<br>

The exceptions to this option are the special `program` arguments "cip2name", "cip4name", and "cip6name", described below. 

### Option 2. Default CIP strings

When the `program` argument is "cip2name", "cip4name", or "cip6name", then the 2-, 4-, or 6-digit names from `cip` are  assigned to the new column. In the previous example, we used this option for Industrial and Mechanical Engineering.

Using these options for CIP code 31 programs yields: 

```{r}
# assign the 2-digit level name
program_group <- label_programs(sub_cip, label = "cip2name")
```

```{r echo = FALSE}
kable2html(program_group)
```

<br>

```{r}
# assign the 6-digit level name
program_group <- label_programs(sub_cip, label = "cip6name")
```

```{r echo = FALSE}
kable2html(program_group)
```

### Option 3. NULL value

When `label_programs = NULL`, then the 4-digit CIP program name is used. This result is identical to `label_programs = "cip4name"`. 

```{r}
# label argument NULL same as 4-digit level name
program_group <- label_programs(sub_cip)
```

```{r echo = FALSE}
kable2html(program_group)
```

<br>

To learn more about `label_programs()`, open the help page by running 

```r
? label_programs
```



<a href="#top">&#9650; top of page</a> 





## CIP data from another source

If you use a CIP data set from another source, it must have the same structure as `cip`. Reshaping data frames is a conventional bit of R data carpentry. If you need help, consult any convenient R resource.

```{r}
# name and class of variables (columns) in cip
sapply(cip, FUN = class)
```

 




<br>
<a href="#top">&#9650; top of page</a> 







## Appendix

### Complete script

The vignette code chunks are collected below in a single, condensed script.

```{r eval = FALSE}
# packages used
library(midfieldr)
library(data.table)

# work with programs one at a time and bind
cve_cip <- get_cip(exa_cip, keep_any = "^1408")
cve <- label_programs(cve_cip, label = "Civil Engineering")

ele_cip <- get_cip(exa_cip, keep_any = "^1410")
ele <- label_programs(ele_cip, label = "Electrical Engineering")

mce_cip <- get_cip(exa_cip, keep_any = "^1419")
mce <- label_programs(mce_cip, label = "cip4name")

ise_cip <- get_cip(exa_cip, keep_any = "^1435")
ise <- label_programs(ise_cip, label = "cip4name")

program_group <- rbind(cve, ele, ise, mce)
program_group[, cip6name := NULL]

# work with programs all in one data frame
program_group <- label_programs(exa_cip, label = "cip4name")
program_group[, cip6name := NULL]
rows_to_edit <- startsWith(program_group$cip6, "1410")
program_group[rows_to_edit, program := "Electrical Engineering"]

# assign an arbitrary program name
sub_cip <- get_cip(cip, keep_any = "^31")
program_group <- label_programs(sub_cip, label = "Leisure Studies")

# assign the 2-digit level name
program_group <- label_programs(sub_cip, label = "cip2name")

# assign the 6-digit level name
program_group <- label_programs(sub_cip, label = "cip6name")

# label argument NULL same as 4-digit level name
program_group <- label_programs(sub_cip)

# name and class of variables (columns) in cip
sapply(cip, FUN = class)
```




<br>
<a href="#top"         >&#9650;     top of page </a>     
<a href="../index.html">&#9665;       main page </a> 


