---
title: "Select and label programs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Select and label programs}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
---

```{r setup, echo = FALSE, message = FALSE, purl = FALSE}
knitr::opts_knit$set(root.dir = "../")
knitr::opts_chunk$set(
  echo = TRUE, # varies from one Rmd to another
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = TRUE,
  purl = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center",
  fig.path = "../man/figures/selecting-programs-"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
options(tibble.print_min = 8L, tibble.print_max = 8L)

# normally, purl is FALSE. But in some code chunks, I want purl = TRUE so that the code in the vignette is executed to pass R CMD check. These next few lines set that up. In the code chunk header, add opts.label = 'dopurl'
knitr::knit_hooks$set(purl = knitr::hook_purl)
knitr::opts_template$set(dopurl = list(purl = TRUE, error = FALSE))
```

```{r echo = FALSE}
# for my use, load the following but conceal from novice user
library("kableExtra")

# function to print to html using kable, control font size
kable2html <- function(...) {
  kable(..., "html") %>%
    kable_styling(font_size = 12)
}
```

Before we can compute a persistence metric, we have to select the academic programs of the student records we wish to study. Here, we show the details of selecting and labeling a set of programs that we re-use in subsequent vignettes on persistence metrics.  




## Contents 

[Identify CIP codes]    
[Select and label programs]    
[Optional select and label procedure]  
[Case study program group]    
[Program label options]  
[Non-midfieldr CIP variables]    
[Optional select and label procedure]    





## Identify CIP codes 

The programs we are studying are Civil Engineering, Electrical Engineering, Industrial Engineering, and Mechanical Engineering. 

```{r message = FALSE}
# packages used
library("midfieldr")
library("dplyr")
library("stringr")
```

We use `cip_filter()` to search the `cip` dataset first for Engineering and then filter the result for Civil, Electrical, Industrial, and Mechanical. The results show that the codes we want are at the 4-digit level:  1408, 1410, 1419, and 1435.
 
```{r first-cip-search, echo = -1}
options(tibble.print_min = 15L)
cip_filter(data = cip, series = "engineering") %>%
  cip_filter(data = ., series = c("civil", "electrical", "industrial", "mechanical")) %>%
  print()
```











## Select and label programs

In the next step, we extract these programs individually so we can label the programs individually.  We'll start with Civil Engineering. 

```{r}
cve <- cip_filter(data = cip, series = "^1408") %>% 
  print()
```

We extract the 6-digit columns with `cip6_select()`. In this case, the default `cip4name` is suitably concise to use as the `program` argument. 

```{r}
cve <- cip6_select(data = cve, program = "cip4name") %>% 
  print()
```


```{r echo = FALSE}
ele <- cip_filter(data = cip, series = "^1410")
```

We repeat for the other three disciplines. For Electrical Engineering, the default 4-digit name is "`r unique(ele[["cip4name"]])`" which we shorten to the more concise "Electrical Engineering" using the `program` argument. 

```{r}
ele <- cip_filter(data = cip, series = "^1410") %>% 
  cip6_select(data = ., program = "Electrical Engineering")

mce <- cip_filter(data = cip, series = "^1419") %>% 
  cip6_select(data = ., program = "cip4name")

ise <- cip_filter(data = cip, series = "^1435") %>% 
  cip6_select(data = ., program = "cip4name")
```

We use `dplyr::bind_rows()` to bind the individual data frames into one data frame. 

```{r group-cip}
program_group <- bind_rows(cve, ele, mce, ise) %>% 
  print()
```

To learn more, open the help pages by running `?cip_filter` or `?cip6_select`. For practice, see the [Identifying program CIP codes](cip_filter.html) vignette.  




<br>
<a href="#top">&#9650; top of page</a> 





## Optional select and label procedure

In the [Select and label programs] section above, the basic procedure is to construct a data frame and label the program for each major then row-bind to assemble the separate data frames into one data frame. Of course this is not the only possible approach, but it is appropriate for R novices. 

An optional and more concise approach that works with one data frame throughout is shown here. The programming content is correspondingly more dense---suitable for more experienced R users. 

- We select the majors all at once and assign the default 4-digit program names.  
- We use `stringr::str_detect()` to identify `cip6` values starting with 1410 and change the corresponding `program` values to Electrical Engineering, replacing the original "Electrical, Electronics and Communications Engineering." 

```{r echo=-1}
options(tibble.print_min = 12L)
program_group <- cip_filter(data = cip, series = c("^1408", "^1410", "^1419", "^1435")) %>% 
  cip6_select(data = ., program = "cip4name") %>% 
  mutate(program = ifelse(str_detect(cip6, "^1410"), "Electrical Engineering", program)) %>% 
  print()
```



<br>
<a href="#top">&#9650; top of page</a> 




## Case study program group

`case_program_group`, a data set identical to the `program_group` data frame above, is bundled in midfieldr for use in subsequent vignettes and example. 

The data are available if midfieldr is loaded. 

```{r}
library("midfieldr")
case_program_group %>%
  print()
```




<br>
<a href="#top">&#9650; top of page</a> 





## Program label options 

In this section, we explore the arguments of `cip6_select()`. There are four options for `program` argument 

<br>

**Option 1:** When a string of our own choosing is assigned to `program`, then that string is the value. 

```{r results = "hide"}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "Leisure Studies") %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "Leisure Studies") %>% 
  kable2html()
```




<br> 


**Option 2:** When `program = NULL` (default) and `data`  matches one of the named `cip_series`, then the value from the named series is assigned to the new column.

```{r results = "hide"}
cip %>% 
  cip_filter(series = cip_math_stat) %>% 
  cip6_select() %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = cip_math_stat) %>% 
  cip6_select() %>% 
  kable2html()
```

<br>

**Option 3:** When `program` is assigned one of three strings ("cip2name", "cip4name", or "cip6name"), then the 2-, 4-, or 6-digit names from `cip` are  assigned to the new column.

```{r results = "hide"}
# 2-digit 
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip2name") %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip2name") %>% 
  kable2html()
```

```{r results = "hide"}
# 4-digit 
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip4name") %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip4name") %>% 
  kable2html()
```

```{r results = "hide"}
# 6-digit 
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip6name") %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "cip6name") %>% 
  kable2html()
```

<br>

**Option 4:** When `program = NULL` (default) and `data` does not match one of the  named `cip_series`, then the 6-digit CIP program name assigned to the new column. This result is identical to `program = "cip6name"`. 

```{r results = "hide"}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select() %>% 
  print() # or View
```

```{r echo = FALSE}
cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select() %>% 
  kable2html()
```






<br>
<a href="#top">&#9650; top of page</a> 





## Non-midfieldr CIP variables

Optional arguments in `cip6_select()` accommodate the possibility that one uses a CIP data frame with different variable names than those in `midfieldr::cip`. The four columns accommodated are `cip6`, `cip6name`, `cip4name`, and `cip2name`. 

For illustration only, let's create a CIP data frame called `nonstandard_cip` with a different name for the two variables `cip6` and `cip6name`. 

```{r echo=-1}
options(tibble.print_min = 5L)
nonstandard_cip <- cip %>% 
  rename("code_6" = cip6, "name_6" = cip6name) %>% 
  print() # or View
```

**Option 1:** If the non-standard variable names must be kept intact, then we use the optional arguments `cip6` and `cip6name` so that `cip6_select()` can operate on the  nonstandard column names.  

```{r}
nonstandard_cip %>% 
  cip_filter(series = "^31") %>% 
  cip6_select(program = "Leisure Studies", cip6 = "code_6", cip6name = "name_6") %>% 
  print() # or View
```

**Option 2:** If the non-standard variable names do not have to be kept intact, the simple option is to `dplyr::rename()` the nonstandard variable names to the standard names, e.g.,  

```{r}
standard_cip <- nonstandard_cip %>% 
  cip_filter(series = "^31") %>% 
  rename("cip6" = code_6, "cip6name" = name_6) %>% 
  print() # or View
```

Similar arguments are made when one has nonstandard column names for  `cip4name` and `cip2name`.






<br>
<a href="#top">&#9650; top of page</a> 










## References 


