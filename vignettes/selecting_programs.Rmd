---
title: "Selecting and labeling programs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Selecting and labeling programs}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
---

```{r setup, echo = FALSE, message = FALSE, purl = FALSE}
knitr::opts_knit$set(root.dir = "../")
knitr::opts_chunk$set(
  echo = TRUE, # varies from one Rmd to another
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = TRUE,
  purl = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center",
  fig.path = "../man/figures/selecting-programs-"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
options(tibble.print_min = 8L, tibble.print_max = 8L)

# normally, purl is FALSE. But in some code chunks, I want purl = TRUE so that the code in the vignette is executed to pass R CMD check. These next few lines set that up. In the code chunk header, add opts.label = 'dopurl'
knitr::knit_hooks$set(purl = knitr::hook_purl)
knitr::opts_template$set(dopurl = list(purl = TRUE, error = FALSE))
```

Before we can compute a persistence metric, we have to select the academic programs we wish to study. Here, we show the details of selecting and labeling a set of programs that we re-use in subsequent vignettes. 

## Explore CIP codes 

The programs we are studying in this example are Civil Engineering, Electrical Engineering, Industrial Engineering, and Mechanical Engineering. We start by assuming we do not know the CIP codes for these disciplines. 

```{r message = FALSE}
# packages used
library("midfieldr")
library("dplyr")
library("stringr")
```

```{r echo=FALSE}
# used by my_session() 
pkg_names <- c("midfieldr", "dplyr", "stringr")
```

We use `cip_filter()` to search the `cip` dataset first for Engineering and then filter the result for Civil, Electrical, Industrial, and Mechanical. Having done this type of search before, we know that we can exclude engineering technology programs. 

The results show that the codes we want are at the 4-digit level:  1408, 1410, 1419, and 1435.
 
```{r first-cip-search, echo = -1}
options(tibble.print_min = 15L)
cip_filter(data = cip, keep_any = "engineering", drop_any = "technology") %>%
  cip_filter(data = ., keep_any = c("civil", "electrical", "industrial", "mechanical")) %>%
  print() # or View() 
```

Notes. 

- Instead of `print()`, one can use `View()` for a spreadsheet-style view of a result. 
- We recommend that you examine the result of every step of your work to help find errors and correct them as you go.  
- Reminder that is a sequence of operations using the pipe operator (`%>%`), the outcome of the one operation is assigned to the data argument of the next operation using the dot (`.`) argument.
- For more practice using `cip_filter()`, see the vignette [Exploring program CIP codes](cip_filter.html).  
- To learn more, open the help page by running `? cip_filter`.   











## Select and label programs

In the next step, we extract these programs individually so we can label the programs individually.  We'll start with Civil Engineering. 

```{r}
cve <- cip_filter(data = cip, keep_any = "^1408") %>% 
  print() # or View() 
```

We extract the 6-digit columns with `cip6_select()`. In this case, the default `cip4name` is suitably concise to use as the `program` argument. 

```{r}
cve <- cip6_select(data = cve, program = "cip4name") %>% 
  print() # or View() 
```

```{r echo = FALSE}
# silent, to use inline R code below
ele <- cip_filter(data = cip, keep_any = "^1410")
```

We repeat for the other three disciplines. 

- For Electrical Engineering, the default 4-digit name is "`r unique(ele[["cip4name"]])`" which we shorten to the more concise "Electrical Engineering" using the `program` argument. 
- For the other two disciplines, the `cip4name` value is used for `program`. 

```{r}
ele <- cip_filter(data = cip, keep_any = "^1410") %>% 
  cip6_select(data = ., program = "Electrical Engineering")

mce <- cip_filter(data = cip, keep_any = "^1419") %>% 
  cip6_select(data = ., program = "cip4name")

ise <- cip_filter(data = cip, keep_any = "^1435") %>% 
  cip6_select(data = ., program = "cip4name")
```

We use `dplyr::bind_rows()` to bind the individual data frames into one data frame. 

```{r group-cip}
program_group <- bind_rows(cve, ele, mce, ise) %>% 
  print() # or View() 
```

To learn more, open the help page by running `? cip6_select`. 




<br>
<a href="#top">&#9650; top of page</a> 





## Optional select and label procedure

As a rule, the midfieldr vignettes are written for the R novice. We attempt to facilitate the reader's understanding by reducing the programming information density and using more and simpler lines of code than strictly necessary. 

In this optional section, we rewrite the procedure used above to illustrate a more concise approach that eliminates the row-binding of several data frames and simply operates on one data frame throughout. The programming content is correspondingly more dense---suitable for readers with some programming experience. 

- We select the majors all at once and assign the default 4-digit program names.  
- We use `stringr::str_detect()` to identify `cip6` values starting with 1410 and use `mutate()` to change the corresponding `program` values to Electrical Engineering, replacing the original, longer program name.  

```{r echo=-1}
options(tibble.print_min = 12L)
program_group <- cip_filter(data = cip, keep_any = c("^1408", "^1410", "^1419", "^1435")) %>% 
  cip6_select(data = ., program = "cip4name") %>% 
  mutate(program = ifelse(str_detect(cip6, "^1410"), "Electrical Engineering", program)) %>% 
  print() # or View() 
```

Thus we have 3 lines of code producing the same result as we obtained earlier with 9 lines (excluding the print functions). 







<br>
<a href="#top">&#9650; top of page</a> 




## Case study program group

`case_program_group`, a data set identical to the `program_group` data frame above, is bundled in midfieldr for use in subsequent vignettes and example. 

The data are available if midfieldr is loaded. 

```{r}
library("midfieldr")
case_program_group %>%
  print() # or View() 
```




<br>
<a href="#top">&#9650; top of page</a> 





## Program label options 

In this section, we explore the arguments of `cip6_select()`. There are four options for `program` argument 

<br>

**Option 1:** When a string of our own choosing is assigned to `program`, then that string is the value. 

```{r results = "hide"}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "Leisure Studies") %>% 
  print() # or View()
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "Leisure Studies") %>% 
  kable2html()
```




<br> 


**Option 2:** When `program = "named_series"` and `data`  matches one of the named `cip_series`, then the value from the named series is assigned to the new column.

```{r results = "hide"}
cip %>% 
  cip_filter(data = ., keep_any = cip_math_stat) %>% 
  cip6_select(data = ., program = "named_series") %>% 
  print() # or View()
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = cip_math_stat) %>% 
  cip6_select(data = ., program = "named_series") %>% 
  kable2html()
```

<br>

**Option 3:** When `program` is assigned one of three strings ("cip2name", "cip4name", or "cip6name"), then the 2-, 4-, or 6-digit names from `cip` are  assigned to the new column.

```{r results = "hide"}
# 2-digit 
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip2name") %>% 
  print() # or View()
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip2name") %>% 
  kable2html()
```

```{r results = "hide"}
# 4-digit 
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip4name") %>% 
  print() # or View() 
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip4name") %>% 
  kable2html()
```

```{r results = "hide"}
# 6-digit 
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip6name") %>% 
  print() # or View() 
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = ., program = "cip6name") %>% 
  kable2html()
```

<br>

**Option 4:** When `program = NULL` (default), then the 4-digit CIP program name assigned to the new column. This result is identical to `program = "cip4name"`. 

```{r results = "hide"}
# program is NULL
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = .) %>% 
  print() # or View()
```

```{r echo = FALSE}
cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(data = .) %>% 
  kable2html()
```






<br>
<a href="#top">&#9650; top of page</a> 





## Non-midfieldr CIP variables

Optional arguments in `cip6_select()` accommodate the possibility that one uses a CIP data frame with different variable names than those in `midfieldr::cip`. The four columns accommodated are `cip6`, `cip6name`, `cip4name`, and `cip2name`. 

For illustration only, let's create a CIP data frame called `nonstandard_cip` with a different name for the two variables `cip6` and `cip6name`. 

```{r echo=-1}
options(tibble.print_min = 5L)
nonstandard_cip <- cip %>% 
  rename("code_6" = cip6, "name_6" = cip6name) %>% 
  print() # or View() 
```

**Option 1:** If the non-standard variable names must be kept intact, then we use the optional arguments `cip6` and `cip6name` so that `cip6_select()` can operate on the  nonstandard column names.  

```{r}
nonstandard_cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  cip6_select(program = "Leisure Studies", cip6 = "code_6", cip6name = "name_6") %>% 
  print() # or View() 
```

**Option 2:** If the non-standard variable names do not have to be kept intact, the simple option is to `dplyr::rename()` the nonstandard variable names to the standard names, e.g.,  

```{r}
standard_cip <- nonstandard_cip %>% 
  cip_filter(data = ., keep_any = "^31") %>% 
  rename("cip6" = code_6, "cip6name" = name_6) %>% 
  print() # or View() 
```


Notes. 

- Similar arguments are made when one has nonstandard column names for  `cip4name` and `cip2name`.
- To learn more about the optional arguments, open the help page by running `? cip6_select`. 






<br>
<a href="#top">&#9650; top of page</a> 




## Session information 

```{r echo = FALSE, comment = NA}
# internal function for session information
my_session(pkg_names)
```

<br>
<a href="#top">&#9650; top of page</a>   

## References

<div id="refs"></div>

<br>
<a href="#top"         >&#9650;     top of page </a>     
<a href="../index.html">&#9665;       main page </a> 

