---
title: "Select and label programs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Select and label programs}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
---

```{r setup, echo = FALSE, message = FALSE, purl = FALSE}
knitr::opts_knit$set(root.dir = "../")
knitr::opts_chunk$set(
  echo = TRUE, # varies from one Rmd to another
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = TRUE,
  purl = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center",
  fig.path = "../man/figures/selecting-programs-"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
# options(tibble.print_min = 8L, tibble.print_max = 8L)

# normally, purl is FALSE. But in some code chunks, I want purl = TRUE so that the code in the vignette is executed to pass R CMD check. These next few lines set that up. In the code chunk header, add opts.label = 'dopurl'
knitr::knit_hooks$set(purl = knitr::hook_purl)
knitr::opts_template$set(dopurl = list(purl = TRUE, error = FALSE))
```

In the vignettes illustrating various persistence metrics, the first step is to select the programs to study. We will use the same set of programs in different vignettes, so here we show the details of selecting and labeling those programs.  




## Contents 

[Identify CIP codes]    
[Select and label programs]    
[A saved data set of programs]    






## Identify CIP codes 

The programs we are studying are Civil Engineering, Electrical Engineering, Industrial Engineering, and Mechanical Engineering. 

```{r message = FALSE}
# packages used
library("midfieldr")
library("dplyr")
```

We use `cip_filter()` to search the `cip` dataset first for Engineering and then filter the result for Civil, Electrical, Industrial, and Mechanical. 
 
```{r first-cip-search, echo = -1}
options(tibble.print_min = 15L)
cip_filter(cip, series = "engineering")%>%
  cip_filter(., series = c("civil", "electrical", "industrial", "mechanical")) %>%
  print()
```

The results show that the codes we want are at the 4-digit level:  1408, 1410, 1419, and 1435.  









## Select and label programs

In the next step, we extract these programs individually. 

```{r extract-cip}
cve <- cip_filter(cip, series = "^1408")
ele <- cip_filter(cip, series = "^1410")
mce <- cip_filter(cip, series = "^1419")
ise <- cip_filter(cip, series = "^1435")
```

We use `cip6_select()` to assign program names to these programs. One possibility is to use the 4-digit program names already available in the data. To view those names:    

```{r}
unique(cve[["cip4name"]])
unique(ele[["cip4name"]])
unique(mce[["cip4name"]])
unique(ise[["cip4name"]])
```

Except for Electrical Engineering, the default program names are concise. We use `cip6_select()` to assign default names to three of the programs and a shorter name for Electrical Engineering. 

```{r}
cve <- cip6_select(cve, program = "cip4name")
ele <- cip6_select(ele, program = "Electrical Engineering")
mce <- cip6_select(mce, program = "cip4name")
ise <- cip6_select(ise, program = "cip4name")
```

`cip6_select()` is pipe-compatible, so the two previous steps could have been combined, for example,  

```{r}
cve <- cip_filter(cip, "^1408") %>%
  cip6_select(., "cip4name")
```

We use `dplyr::bind_rows()` to bind the individual data frames into one data frame. 

```{r group-cip}
program_group <- bind_rows(cve, ele, mce, ise)
```

Examine the result: there are a total of `r length(unique(program_group[["cip6"]]))` CIP codes for these programs. 

```{r echo = -1}
options(tibble.print_min = 12L)
program_group
```

For additional information, try the [Identifying program CIP codes](cip_filter.html) vignette and the help pages by running `?cip_filter` and `?cip6_select`. 




<br>
<a href="#top">&#9650; top of page</a> 




## A saved data set of programs

For convenience, this data frame of engineering CIP codes and program names has been bundled with midfieldr to use in vignettes. 

`case_program_group` is the name of the saved data frame. To access the data frame, load midfieldr and assign the data to an object such as `program_group`. Note that `case_program_group` is identical to the group of programs we created earlier. 

```{r}
library("midfieldr")
program_group <- case_program_group %>%
  print()
```
