---
title: "Explore program CIP codes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Explore program CIP codes}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
link-citations: yes
---

In analyzing student records, a common first step is filtering the data by academic program. In the US, programs are encoded by 6-digit CIP codes.

In midfieldr, the `cip_filter()` function acts on the `cip` data set to help us find the CIP codes of the programs we want to study. 

```{r setup, echo = FALSE, message = FALSE, purl = FALSE}
# knitr::opts_knit$set(root.dir = "../")
knitr::opts_chunk$set(
  echo = TRUE, # varies from one Rmd to another
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = TRUE,
  purl = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center",
  fig.path = "../man/figures/cip-filter-"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
options(tibble.print_min = 8L, tibble.print_max = 8L)

# normally, purl is FALSE. But in some code chunks, I want purl = TRUE so that the code in the vignette is executed to pass R CMD check. These next few lines set that up. In the code chunk header, add opts.label = 'dopurl'
knitr::knit_hooks$set(purl = knitr::hook_purl)
knitr::opts_template$set(dopurl = list(purl = TRUE, error = FALSE))
```





   




## Introduction

"CIP" is the acronym for *Classification of Instructional Programs*, a taxonomy of academic programs curated by the US Department of Education.  

A "CIP code" is a 6-digit integer representing a specific academic program. For example, 140803 is the CIP code for Structural Engineering and 450202 is the  CIP code for Physical Anthropology. 

The CIP code embeds three levels of program organization: the first 2 digits represent the most general grouping of programs to which the program belongs; the first 4 digits represent an intermediate grouping of programs to which the program belongs; the full 6 digits represent a specific program.  For example, 

- Structural Engineering (140803) is a subset of Civil Engineering (1408) which is a subset of Engineering (14).  
- Physical Anthropology (450202) is a subset of Anthropology (4502) which is a subset of Social Sciences (45) 

The CIP is periodically updated. A 2020 CIP has been released, but MIDFIELD currently uses the 2010 CIP. Read more about the CIP at  [@cip2010]. 





<br>
<a href="#top">&#9650; top of page</a>




## CIP data

```{r}
# packages used in the vignette
library("midfieldr")
library("dplyr")
```

`cip` is a data frame bundled with midfieldr containing columns of 2, 4, and 6-digit 2010 CIP codes and program names. All columns are character strings. 

```{r}
print(cip)
```

At the 6-digit level, there are `r length(unique(cip$cip6))` instructional   programs. A sample is shown below. 

```{r echo=FALSE}
set.seed(20200617)
cip %>% 
  select(cip6, cip6name) %>% 
  unique() %>% 
  sample_n(8) %>% 
  arrange(cip6) %>% 
  kable2html()
```
<br>

At the 4-digit level, the programs are organized into `r length(unique(cip$cip4))` program groupings, for example:  

```{r echo=FALSE}
cip %>% 
  select(cip4, cip4name) %>% 
  unique() %>% 
  sample_n(8) %>% 
  arrange(cip4) %>% 
  kable2html()
```
<br>

At the 2-digit level, the programs are organized into `r length(unique(cip$cip2))` program groupings, for example: 

```{r echo=FALSE}
cip %>% 
  select(cip2, cip2name) %>% 
  unique() %>% 
  sample_n(8) %>% 
  arrange(cip2) %>% 
  kable2html()
```
<br>

Notes. 

- Instead of `print()`, one can use `View()` for a spreadsheet-style view of a result. 
- We recommend that you examine the result of every step of your work to help find errors and correct them as you go. 
- Reminder that is a sequence of operations using the pipe operator (`%>%`), the outcome of the one operation is assigned to the data argument of the next operation using the dot (`.`) argument.
- To learn more, open the help page by running `? cip`.  








<br>
<a href="#top">&#9650; top of page</a> 





## Filtering basics


`cip_filter()` filters a data frame by specified search terms. The arguments are: 

- `data` data frame of character strings of CIP codes and names   
- `keep_any` character vector used to filter `data`, retaining rows containing any of these terms.
- `drop_any` optional argument, character vector used to filter `data`, deleting rows containing any of these terms. 


For example, to filter the CIP data for all programs containing the word "engineering",

```{r}
cip_filter(data = cip, keep_any = "engineering") %>%
  print()
```

The first two argument names can be omitted if they are in the correct order. We will generally include argument names for the benefit of R novices though readers are free to omit argument names like these if they wish. 

```{r}
cip_filter(cip, "engineering") %>%
  print()
```

If the optional `drop_any` argument is used, it must be named, 

```{r}
# correct
cip_filter(cip, "civil engineering", drop_any = "technology") %>%
  print()

# incorrect
cip_filter(cip, "civil engineering", "technology") %>%
  print()
```


Notes. 

- A function help page will indicate which arguments, if any, must be named. See the help page for this function by running `? cip_filter`. 
- In subsequent sections, we examine different strategies for using `cip_filter()`.


<br>
<a href="#top">&#9650; top of page</a> 





## Filtering using keywords

Suppose we want to find the CIP codes and names for all programs in Civil Engineering. The search is case-insensitive, so we start with the following code chunk. 

```{r}
cip_filter(data = cip, keep_any = "civil") %>%
  print() # View() can be used instead
```

Notes on viewing the results:

- The `print()` function sends an abbreviated view of the results to the Console. 
- In the remaining code chunks, I'll leave `print()` in place but you are welcome to replace it with `View()` to invoke a spreadsheet-like data viewer.
- For clarity on this vignette page, shorter data frames are printed as HTML tables, for example: 

<br>

```{r echo = FALSE}
# using kable_styling() for output but conceal from novice user
kable2html(cip_filter(data = cip, keep_any = "civil"))
```

<br>

The search returns some programs with Civilization in their names as well as Engineering Technology. If we wanted Civil Engineering only, we can use a sequence of function calls, where the outcome of the one operation is assigned to the data argument of the next operation using the dot (`.`) argument. 

The following code chunk could be read as "Start with the `cip` data frame, then filter on 'civil', then filter on 'engineering', then delete 'technology.'"

```{r results = "hide"}
cip %>%  
  cip_filter(data = ., keep_any = "civil") %>% 
  cip_filter(data = ., keep_any = "engineering") %>% 
  cip_filter(data = ., drop_any = "technology") %>% 
  print()
```

Only the `drop_any` argument must be named, so the following code chunk yields the same result, 

```{r results = "hide"}
cip %>% 
  cip_filter(., "civil") %>% 
  cip_filter(., "engineering") %>% 
  cip_filter(., drop_any = "technology") %>% 
  print()
```

```{r echo = FALSE}
kable2html(cip %>% 
  cip_filter(., "civil") %>% 
  cip_filter(., "engineering") %>% 
  cip_filter(., drop_any = "technology"))
```

<br>

Seeing that all Civil Engineering programs have the same `cip4name`, we could shorten our search to one line, 

```{r results = "hide"}
cip_filter(data = cip, keep_any = "civil engineering", drop_any = "technology") %>% 
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(data = cip, keep_any = "civil engineering", drop_any = "technology"))
```

<br>

In the next example, suppose we want to study programs relating to German culture, language, and literature. Using  "german" for the `keep_any` value yields 

```{r results = "hide"}
cip_filter(data = cip, keep_any = "german") %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(data = cip, keep_any = "german"))
```

<br>

From the 6-digit program names we find only two that are of interest, German Studies (050125) and German Language and Literature (160501). 

Note that the keep_any argument is a vector. 
 
```{r results = "hide"}
cip_filter(cip, keep_any = c("050125", "160501")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = c("050125", "160501")))
```

<br>

If the 6-digit codes are entered as integers, they are coerced to characters and used as search terms as above.
 
```{r results = "hide"}
cip_filter(cip, keep_any = c(050125, 160501)) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = c(050125, 160501)))
```

<br>

Because integers are coerced to characters, we can use a numerical sequence as a series using `seq()`. Here, the sequence is from 540101 to 540199. Invalid codes, e.g., from 540109--540198, are silently ignored. 

```{r results = "hide"}
# series as a sequence
cip_filter(cip, keep_any = seq(540101, 540199, 1)) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = seq(540101, 540199, 1)))
```

<br>

Specifying 4-digit codes yields a data frame all 6-digit programs containing the 4-digit string. We use the regular expression notation `^` to match the start of the strings.

```{r results = "hide"}
# 4-digit example matching the start of the string
cip_filter(cip, keep_any = c("^1407", "^1408")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = c("^1407", "^1408")))
```

<br>

The 2-digit series represent the most general groupings of related programs. Here, the result includes all History programs. 

```{r results = "hide"}
# 2-digit example
cip_filter(cip, keep_any = "^54") %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = "^54"))
```

<br>

The series argument can include any combination of 2, 4, and 6-digit codes. 

```{r results = "hide"}
# a series with 2, 4, and 6-digits specified
cip_filter(cip, keep_any = c("^24", "^4102", "^450202")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = c("^24", "^4102", "^450202")))
```







<br>
<a href="#top">&#9650; top of page</a> 





## Filtering using named series

midfieldr includes several datasets of *named series*. A named series is a character vector of 6-digit CIP codes that belong to a group of programs such as Engineering, Physical Sciences, STEM, etc. 



A named series is assigned to the series argument in `cip_filter()`. 

```{r results = "hide"}
# the math and statistics series
cip_filter(cip, keep_any = cip_math_stat) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, keep_any = cip_math_stat))
```

<br>

To see the full set of available named series, see the help page `?cip_series`. 



<br>
<a href="#top">&#9650; top of page</a> 






## Selecting the 6-digit codes

Once we've identified the codes for all the programs we want to study, we extract the 6-digit CIP codes from our program group to use as search terms to identify students in these programs. 

For example, if we were studying History, we filter CIPs using `"^54"`. Then we use the R `[[]]` notation to extract the vector of values in the `cip6` variable (column). 

```{r}
my_programs <- cip_filter(data = cip, keep_any = "^54") %>% 
  print()

my_cip6 <- my_programs[["cip6"]] %>% 
  print()
```

A vector like this is used later to find student-record data associated with these programs. 


<br>
<a href="#top">&#9650; top of page</a> 










## References

<div id="refs"></div>


## Appendix

### Complete script

In response to requests from some of our workshop attendees, we collect the vignette code chunks in one script. We condense the script by omitting exploratory steps so we can focus on the steps that produce the results. 

```{r eval=FALSE}
# TBD
```

<br>
<a href="#top"         >&#9650;     top of page </a>     
<a href="../index.html">&#9665;       main page </a> 








