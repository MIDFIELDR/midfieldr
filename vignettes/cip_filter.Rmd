---
title: "Filtering programs by CIP codes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Filtering programs by CIP codes}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
link-citations: yes
resource_files:
  - ../man/figures/header-cassiopeias-garden.png
---

<img src="../man/figures/header-cassiopeias-garden.png" width="100%" alt="image.png">
<small>
<br>
<i>Le jardin de Cassiop√©e</i> (cropped) by Patrice Ouellet is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">CC BY-NC-ND 2.0</a>
<br>
</small>

<br>

A common first step in analyzing student-record data is filtering by the academic programs of interest. In the MIDFIELD data sets, programs are encoded using 6-digit CIP codes.

 




## Contents

[Introduction]    
[CIP data]    
[Filtering basics]    
[Filtering using keywords]  
[Filtering using named series]    
[References] 





```{r setup, echo = FALSE, message = FALSE, purl = FALSE}
# knitr::opts_knit$set(root.dir = "../")
knitr::opts_chunk$set(
  echo = TRUE, # varies from one Rmd to another
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = TRUE,
  purl = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center",
  fig.path = "../man/figures/cip-filter-"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
options(tibble.print_min = 8L, tibble.print_max = 8L)

# normally, purl is FALSE. But in some code chunks, I want purl = TRUE so that the code in the vignette is executed to pass R CMD check. These next few lines set that up. In the code chunk header, add opts.label = 'dopurl'
knitr::knit_hooks$set(purl = knitr::hook_purl)
knitr::opts_template$set(dopurl = list(purl = TRUE, error = FALSE))
```

```{r echo = FALSE}
# unpack data bits
library(midfieldr)
# load("R/sysdata.rda")

# data_bits <- midfieldr:::data_bits
obs_cip <- 1584
var_cip <- 6
# obs_cip <- round(data_bits$data[data_bits$name == "obs_cip"] / 1e+0, 1)
# var_cip <- data_bits$data[data_bits$name == "var_cip"]
# size_cip <- round(data_bits$data[data_bits$name == "size_cip"] / 1e+3, 0)

# function to print to html using kable, control font size
kable2html <- function(...) {
  kable(..., "html") %>%
    kable_styling(font_size = 12)
}
```






   




## Introduction

"CIP" is the acronym for *Classification of Instructional Programs*, a taxonomy of academic programs curated by the US Department of Education.  

A "CIP code" is a 6-digit integer representing a specific academic program. For example, 140803 is the CIP code for Structural Engineering and 450202 is the  CIP code for Physical Anthropology. 

The CIP code embeds three levels of program organization: the first 2 digits represent the most general grouping of programs to which the program belongs, loosely analogous to an academic college; the first 4 digits represent an intermediate grouping of programs to which the program belongs, loosely analogous to an academic department; the full 6 digits represent a specific program, loosely analogous to an academic discipline.  For example, 

- Engineering (14) subsumes Civil Engineering (1408) which subsumes Structural Engineering (140803). 
- Social Sciences (45) subsumes Anthropology (4502) which subsumes Physical Anthropology (450202). 

The CIP is periodically updated. A 2020 CIP has been released, but MIDFIELD currently uses the 2010 CIP. Read more about the CIP at  [@cip2010]. 





<br>
<a href="#top">&#9650; top of page</a>



## CIP data

```{r}
# packages used in the vignette
library("dplyr")
library("stringr")
library("knitr")
library("midfieldr")
```

```{r echo = FALSE}
# for my use, load the following but conceal from novice user
library("kableExtra")
```

The `cip` data frame bundled with midfieldr contains columns of 2, 4, and 6-digit 2010 CIP codes and program names. All columns are character strings. 

```{r}
print(cip)
```

To learn more, open the help page by running `?cip`. 





<br>
<a href="#top">&#9650; top of page</a> 





## Filtering basics


`cip_filter()` filters a data frame by specified search terms. The arguments are: 

- `data` data frame of character strings of CIP codes and names   
- `series` character vector used to filter `data`, retaining rows containing any of these terms.
- `except` optional argument, character vector used to filter `data`, deleting rows containing any of these terms. 


For example, to filter the CIP data for all programs containing the word "engineering",

```{r}
cip_filter(data = cip, series = "engineering") %>%
  print()
```

The first two argument names can be omitted. 

```{r}
cip_filter(cip, "engineering") %>%
  print()
```

If the optional `except` argument is used, it must be named, 

```{r}
# correct
cip_filter(cip, "civil engineering", except = "technology") %>%
  print()

# incorrect
cip_filter(cip, "civil engineering", "technology") %>%
  print()
```

In subsequent sections, we examine different strategies for using `cip_filter()`. 

<br>
<a href="#top">&#9650; top of page</a> 





## Filtering using keywords

Suppose we want to find the CIP codes and names for all programs in Civil Engineering. The search is case-insensitive, so we start with the following code chunk. 

```{r}
cip_filter(cip, "civil") %>%
  print() # View() can be used instead
```

Notes on viewing the results:

- The `print()` function sends an abbreviated view of the results to the Console. 
- In the remaining code chunks, I'll leave `print()` in place but you are welcome to replace it with `View()` to invoke a spreadsheet-like data viewer.
- For clarity on this vignette page, shorter data frames are printed as HTML tables, for example: 

<br>

```{r echo = FALSE}
# using kable_styling() for output but conceal from novice user
kable2html(cip_filter(cip, series = "civil"))
```

<br>

The search returns some programs with Civilization in their names as well as Engineering Technology. If we wanted Civil Engineering only, we can use a sequence of function calls, where the outcome of the one operation is assigned to the data argument of the next operation using the dot (`.`) argument. 

```{r results = "hide"}
cip %>%
  cip_filter(., series = "civil") %>% 
  cip_filter(., series = "engineering") %>% 
  cip_filter(., except = "technology") %>% 
  print()
```

```{r echo = FALSE}
# using kable_styling() for output but conceal from novice user
kable2html(cip_filter(cip, series = "civil") %>% 
  cip_filter(., series = "engineering") %>% 
  cip_filter(., except = "technology"))
```

<br>

Seeing that all Civil Engineering programs have the same `cip4name`, we could shorten our search to one line, 

```{r results = "hide"}
cip_filter(cip, series = "civil engineering", except = "technology") %>% 
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = "civil engineering", except = "technology"))
```

<br>

In the next example, suppose we want to study programs relating to German culture, language, and literature. Using  "german" for the `series` value yields 

```{r results = "hide"}
cip_filter(cip, series = "german") %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = "german"))
```

<br>

From the 6-digit program names we find only two that are of interest, German Studies (050125) and German Language and Literature (160501). A character vector of these two codes is the revised series argument. 
 
```{r results = "hide"}
cip_filter(cip, series = c("050125", "160501")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = c("050125", "160501")))
```

<br>

If the 6-digit codes are entered as integers, they are coerced to characters and used as search terms as above.
 
```{r results = "hide"}
cip_filter(cip, series = c(050125, 160501)) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = c(050125, 160501)))
```

<br>

Because integers are coerced to characters, we can use a numerical sequence as a series using `seq()`. Here, the sequence is from 540101 to 540199. Invalid codes, e.g., from 540109--540198, are silently ignored. 

```{r results = "hide"}
# series as a sequence
cip_filter(cip, series = seq(540101, 540199, 1)) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = seq(540101, 540199, 1)))
```

<br>

Specifying 4-digit codes yields a data frame with as many rows as there are rows that include the search strings. We use the regular expression notation `^` to match the start of the strings.

```{r results = "hide"}
# 4-digit example matching the start of the string
cip_filter(cip, series = c("^1407", "^1408")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = c("^1407", "^1408")))
```

<br>

The 2-digit series represent the most general groupings of related programs. Here, the result includes all History programs. 

```{r results = "hide"}
# 2-digit example
cip_filter(cip, series = "^54") %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = "^54"))
```

<br>

The series argument can include any combination of 2, 4, and 6-digit codes. 

```{r results = "hide"}
# a series with 2, 4, and 6-digits specified
cip_filter(cip, series = c("^24", "^4102", "^450202")) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = c("^24", "^4102", "^450202")))
```







<br>
<a href="#top">&#9650; top of page</a> 





## Filtering using named series

midfieldr includes several datasets of *named series*. A named series is a character vector of 6-digit CIP codes that belong to a group of programs such as Engineering, Physical Sciences, STEM, etc. 

To see the full set of available named series, see the help page `?cip_series`. 

A named series is assigned to the series argument in `cip_filter()`. 

```{r results = "hide"}
# the math and statistics series
cip_filter(cip, series = cip_math_stat) %>%
  print()
```

```{r echo = FALSE}
kable2html(cip_filter(cip, series = cip_math_stat))
```


  






<br>
<a href="#top">&#9650; top of page</a> 

 



## References

<div id="refs"></div>

