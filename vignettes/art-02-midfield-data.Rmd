---
title: "MIDFIELD practice data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MIDFIELD practice data}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: ../inst/REFERENCES.bib
csl: ../inst/body-and-society.csl
link-citations: yes
nocite: | 
  @Dowle+Srinivasan:2020:data.table, @Harrell:2021:Hmisc. @Waring+Quinn:2021:skimr
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(fig.path = here::here("man/figures", 
                                            "art-02-midfield-data-"))
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  error = FALSE,
  fig.width = 6,
  fig.asp = 1 / 1.6,
  out.width = "70%",
  fig.align = "center"
)
knitr::knit_hooks$set(inline = function(x) {
  if (!is.numeric(x)) {
    x
  } else if (x >= 10000) {
    prettyNum(round(x, 2), big.mark = ",")
  } else {
    prettyNum(round(x, 2))
  }
})
```

## Introduction 

The midfielddata package is the repository of the MIDFIELD practice data, with records organized in four tables keyed by student ID. 

- `student`  
- `course`  
- `term`   
- `degree`  

To maintain confidentiality of human subject data, the identifiers for students and institutions have been anonymized.

In this vignette, we introduce the four data tables and briefly examine their contents before moving on in subsequent vignettes to operate on the data using the functions in midfieldr. 



### This vignette uses
 
packages

```{r}
# packages used
library("midfieldr")
library("midfielddata")
library("data.table")
```


### R "promise" objects 

The tables of practice data in midfielddata do not load into memory until you use them (so-called R "promise" objects). Thus, loading the package with  `library("midfielddata")` as we did above, then listing the R objects in the environment with 

```{r}
# the names of objects in the environment
ls()
```

shows zero objects. Yet the data are available. If you use the data in an operation, you'll see that the "promise" has been kept. For example, to subset the student data for students whose age at admission is over 40, we would run

```{r}
# age at admission over 40
dframe <- student[age > 40]

# the names of objects in the environment
ls()

# examine the result
dframe
```

If you look in the RStudio *Environment* pane, you should see `dframe` listed with `r nrow(dframe)` students meeting this criterion. 

All four practice data tables are promises when you load midfielddata, but  loaded into memory only when you use them. 

```{r echo = FALSE}
kable2html <- function(x, font_size = NULL, caption = NULL) {
  font_size <- ifelse(is.null(font_size), 11, font_size)
  kable_in <- knitr::kable(x, format = "html", caption = caption)
  kableExtra::kable_styling(kable_input = kable_in, font_size = font_size)
}

# cip
n_cip <- nrow(unique(cip))
  
# student
obs_students <- nrow(student)
var_students <- ncol(student)
size_students <- "19 MB"

# degree
n_id_degrees <- nrow(unique(degree[, .(mcid)]))
n_graduates <- nrow(unique(degree[!is.na(degree), .(mcid)]))
n_term <- nrow(unique(degree[, .(term)]))
obs_degrees <- nrow(degree)
var_degrees <- ncol(degree)
size_degrees <- "10 MB"

# term
n_id_terms <- nrow(unique(term[, .(mcid)]))
obs_terms <- nrow(term)
var_terms <- ncol(term)
n_institutions <- nrow(unique(term[, .(institution)]))
n_programs_terms <- nrow(unique(term[, .(institution, cip6)]))
n_terms <- nrow(unique(term[, .(term)]))
year_span <- c(substr(min(term[, term]), 1, 4), substr(max(term[, term]), 1, 4))
size_terms <- "82 MB"

# course
n_id_courses <- nrow(unique(course[, .(mcid)]))
n_courses <- nrow(unique(course[, .(institution, abbrev, number)]))
n_term_course <- nrow(unique(course[, .(term)]))
obs_courses <- nrow(course)
var_courses <- ncol(course)
size_courses <- "349 MB"
```

## Inpect the `student` data

Table of attributes of approximately 98,000 students upon being admitted as degree-seeking undergraduates. Each observation is a unique student keyed by student ID. Student IDs are anonymized but are consistent across the four data sets. The table comprises `r obs_students` observations of `r var_students` variables and occupies approximately `r size_students` memory. 

For definitions of variables, view the help page by running 

```r
? student
```
To see the data structure, run

```{r}
str(student)
```

Summarize some of the quantitative variables. 

```{r}
summary(student[, sat_math])

summary(student[, age])
```

Examine a few of the categorical variables and their values. 

```{r}
sort(unique(student[, sex]))

sort(unique(student[, race]))
```



## Inpect the `course` data

Table of course-related attributes of approximately 98,000 undergraduates enrolled in courses at their institutions. Each observation is one course in one term for one student keyed by student ID and a combination of course, abbreviation, number, and section. The table comprises `r obs_courses` observations of `r var_courses` variables and occupies approximately `r size_courses` memory. 

For definitions of variables, view the help page by running 

```r
? course
```
To see the data structure, run

```{r}
str(course)
```

Summarize a quantitative variable. 

```{r}
summary(course[, hours_course])
```

Examine some categorical variables and their values. 

```{r}
# type of courses
sort(unique(course[, type]))

# how many unique course names
all_course_names <- course[, .(course)]
all_course_names <- all_course_names[course != ""]
all_course_names <- unique(all_course_names)
n <- nrow(all_course_names)
n
```

A sample of course names.

```{r}
# a random sample of courses
print(all_course_names[sample(1:n, 20)], nrows = 20)
```


## Inpect the `term` data

Table of term-related attributes of approximately 96,000 undergraduates for all terms completed at their institutions. Each observation is one term for one student keyed by student ID and term. The table comprises `r obs_terms` observations of `r var_terms` variables and occupies approximately `r size_terms` memory. 

For definitions of variables, view the help page by running 

```r
? term
```
To see the data structure, run

```{r}
str(term)
```

Summarize some of the quantitative variables. 

```{r}
summary(term[, hours_term])

summary(term[, gpa_term])
```

Examine some categorical variables and their values.  

```{r}
sort(unique(term[, level]))

sort(unique(term[, standing]))
```


## Inpect the `degree` data

Table of degree-related attributes of approximately 48,000 undergraduates upon completing their programs. Each observation is a unique student keyed by student ID. The table comprises `r obs_degrees` observations of `r var_degrees` variables and occupies approximately `r size_degrees` memory. 

For definitions of variables, view the help page by running 

```r
? degree
```
To see the data structure, run

```{r}
str(degree)
```

Examine some categorical variables and their values. 

```{r}
sort(unique(degree[, institution]))

sort(unique(degree[, degree]))
```

Only students completing their programs.

```{r}
degree[!is.na(degree)]
```


## Exercises

To summarize a data frame in detail, try the following and compare results.

1. Install the `Hmisc` package, load it with `library("Hmisc")`, and run `describe(x)`, where `x` is one of the data tables, for example, `describe(student)`, `describe(course)`, etc. 

2. Install the `skimr` package, load it with `library("skimr")`, and run `skim(x)`, where `x` is one of the data tables, for example, `skim(student)`, `skim(course)`, etc.  


## References

<div id="refs"></div>


## Appendix

### Complete script

Each vignette concludes with the code chunks collected below in a single, condensed script. Some users like to copy and paste the to an R script of their own.  

```{r eval = FALSE}
# packages used
library("midfieldr")
library("midfielddata")
library("data.table")

# cip
str(cip)
sort(unique(cip[, cip2]))
length(unique(cip[, cip4]))
length(unique(cip[, cip6]))
set.seed(20210529)
some_programs <- cip[, .(cip4name)]
print(some_programs[sample(1:300, 20)], nrows = 20)

# student
str(student)
summary(student[, sat_math])
summary(student[, age])
sort(unique(student[, sex]))
sort(unique(student[, race]))

# course
str(course)
summary(course[, hours_course])
sort(unique(course[, type]))
some_courses <- course[, .(course)]
some_courses <- some_courses[course != ""]
some_courses <- unique(some_courses)
n <- nrow(some_courses)
print(some_courses[sample(1:n, 20)], nrows = 20)

# term
str(term)
summary(term[, hours_term])
summary(term[, gpa_term])
sort(unique(term[, level]))
sort(unique(term[, standing]))

# degree
str(degree)
sort(unique(degree[, institution]))
sort(unique(degree[, degree]))
degree[!is.na(degree)]
```
