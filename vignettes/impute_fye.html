<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Impute FYE starting programs</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Impute FYE starting programs</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Some US institutions have first year engineering (FYE) programs—typically a common first year curriculum that is a prerequisite for declaring an degree-granting engineering major.</p>
<p>FYE programs are problematic for some persistence metrics. The “graduation rate” metric, for example, defines successful graduation as students graduating (within 6 years) from the same program in which they matriculate. An FYE student cannot satisfy this requirement.</p>
<p>However, FYE students are neither undecided nor is their program “unknown”—their institutions have admitted them as engineering students. We know their 2-digit CIP code (“14”) but not their preferred 6-digit CIP code. Hence, midfielddata FYE codes are “14XXXX” and “14YYYY”.</p>
<p>To include an FYE student in metrics such as graduation rate, we have to predict their “starting program”: a 6-digit CIP code representing the engineering program they would have declared had they not been required to enroll in FYE. The vignette describes the prediction process and how the results are used.</p>
<div id="options-for-predicting-starting-programs" class="section level3">
<h3>Options for predicting starting programs</h3>
<ol style="list-style-type: decimal">
<li><p>Ready-to-use predictions in <code>fye_start</code>, a data set in midfieldr. Starting programs are predicted for every FYE student in midfielddata.</p></li>
<li><p>Perform your own prediction. Use <code>fye_mi_prep()</code> to operate on MIDFIELD data to prepare a data frame for imputation. Use the mice package (Multivariate Imputation by Chained Equations) to impute 6-digit CIP codes. The vignette describes the process that produces the <code>fye_start</code> data set.</p></li>
</ol>
</div>
<div id="this-vignette-uses" class="section level3">
<h3>This vignette uses</h3>
<p>midfieldr functions</p>
<ul>
<li><code>filter_by_id()</code></li>
<li><code>fye_mi_prep()</code></li>
</ul>
<p>data.table syntax</p>
<ul>
<li><code>setDT()</code> create data table</li>
<li><code>setnames()</code> rename columns</li>
<li><code>DT[]</code> print the data frame</li>
<li><code>DT[order(col)]</code> arrange rows</li>
<li><code>DT[rows_we_want]</code> subset rows</li>
<li><code>DT[, .(col1, col2)]</code> select columns</li>
<li><code>DT[, .(new_col = .N), by = grouping_variables]</code> count N by group</li>
<li><code>DT[, new_col := FUN]</code> create new column as a function of old columns</li>
</ul>
<p>mice functions (optional, for performing the imputation yourself)</p>
<ul>
<li><code>mice()</code> multiple imputation</li>
<li><code>complete()</code> extract completed data from <code>mice()</code> output</li>
</ul>
<p>packages</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># packages used</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(midfieldr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(midfielddata)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># optional</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>(mice)</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># print max 20 rows, otherwise 10 rows each head/tail</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">options</span>(<span class="dt">datatable.print.nrows =</span> <span class="dv">20</span>, <span class="dt">datatable.print.topn =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
</div>
<div id="option-1-ready-to-use-starting-programs" class="section level2">
<h2>Option 1: Ready-to-use starting programs</h2>
<p>The work described in this option is for using the ready-to-use predicted programs in <code>fye_start</code> instead of performing the computationally-expensive imputation yourself.</p>
<div id="examine-data-set-fye_start" class="section level3">
<h3>Examine data set <code>fye_start</code></h3>
<p>The data set <code>fye_start</code> contains predicted starting programs for all midfielddata FYE students. View its help page by running</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>? fye_start</span></code></pre></div>
<p>The data are loaded with midfieldr. The start column is the 6-digit CIP code predicted for FYE students. The prediction is the actual post-FYE engineering program for all students who continue in engineering. The prediction is an imputed value for all other FYE students.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># FYE predicted starting programs </span></span>
<span id="cb3-2"><a href="#cb3-2"></a>fye_start</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt;                id  start</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt;    1: MID25783162 140901</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt;    2: MID25783166 141901</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt;    3: MID25783167 140901</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt;    4: MID25783178 140701</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;    5: MID25783197 140701</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;    6: MID25783199 140301</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt;    7: MID25783227 141001</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt;    8: MID25783257 140701</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt;    9: MID25783275 140501</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt;   10: MID25783388 141901</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt;   ---                   </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; 5983: MID26648334 140801</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; 5984: MID26648354 140901</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; 5985: MID26648392 141901</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; 5986: MID26648417 140201</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; 5987: MID26648422 141901</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; 5988: MID26648435 141901</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; 5989: MID26648484 140801</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; 5990: MID26648508 140701</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; 5991: MID26648517 140801</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; 5992: MID26648544 141901</span></span></code></pre></div>
<p>To get a sense of the distribution of programs in these data, we can count the number of students in each program.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># tally N students by program CIP</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>fye_start_summary &lt;-<span class="st"> </span>fye_start[, .(<span class="dt">N =</span> .N), by =<span class="st"> &quot;start&quot;</span>]</span></code></pre></div>
<p>Before viewing the result, we can join the program names from <code>cip</code>. To join by the <code>cip6</code> variable, we first must rename <code>start</code> to <code>cip6</code> in our summary data frame.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># rename start to cip6 for join</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">setnames</span>(fye_start_summary, <span class="dt">old =</span> <span class="st">&quot;start&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;cip6&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># left-join program names from CIP data</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>fye_start_summary &lt;-<span class="st"> </span><span class="kw">merge</span>(fye_start_summary, cip, <span class="dt">by =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># order rows and select columns</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>fye_start_summary &lt;-<span class="st"> </span>fye_start_summary[<span class="kw">order</span>(<span class="op">-</span>N), .(cip6, cip6name, N)]</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="kw">setnames</span>(fye_start_summary, <span class="dt">old =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;start&quot;</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>fye_start_summary</span></code></pre></div>
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Summary of starting program predictions
</caption>
<thead>
<tr>
<th style="text-align:left;">
start
</th>
<th style="text-align:left;">
cip6name
</th>
<th style="text-align:right;">
N
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
141901
</td>
<td style="text-align:left;">
Mechanical Engineering
</td>
<td style="text-align:right;">
1579
</td>
</tr>
<tr>
<td style="text-align:left;">
140801
</td>
<td style="text-align:left;">
Civil Engineering, General
</td>
<td style="text-align:right;">
894
</td>
</tr>
<tr>
<td style="text-align:left;">
141001
</td>
<td style="text-align:left;">
Electrical, Electronics and Communications Engineering
</td>
<td style="text-align:right;">
790
</td>
</tr>
<tr>
<td style="text-align:left;">
140901
</td>
<td style="text-align:left;">
Computer Engineering, General
</td>
<td style="text-align:right;">
611
</td>
</tr>
<tr>
<td style="text-align:left;">
143501
</td>
<td style="text-align:left;">
Industrial Engineering
</td>
<td style="text-align:right;">
565
</td>
</tr>
<tr>
<td style="text-align:left;">
140701
</td>
<td style="text-align:left;">
Chemical Engineering
</td>
<td style="text-align:right;">
486
</td>
</tr>
<tr>
<td style="text-align:left;">
140201
</td>
<td style="text-align:left;">
Aerospace, Aeronautical and Astronautical, Space Engineering
</td>
<td style="text-align:right;">
417
</td>
</tr>
<tr>
<td style="text-align:left;">
140301
</td>
<td style="text-align:left;">
Agricultural, Biological Engineering and Bioengineering
</td>
<td style="text-align:right;">
146
</td>
</tr>
<tr>
<td style="text-align:left;">
142101
</td>
<td style="text-align:left;">
Mining and Mineral Engineering
</td>
<td style="text-align:right;">
105
</td>
</tr>
<tr>
<td style="text-align:left;">
140601
</td>
<td style="text-align:left;">
Ceramic Sciences and Engineering
</td>
<td style="text-align:right;">
103
</td>
</tr>
<tr>
<td style="text-align:left;">
141101
</td>
<td style="text-align:left;">
Engineering Mechanics
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
140501
</td>
<td style="text-align:left;">
Biomedical, Medical Engineering
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
141801
</td>
<td style="text-align:left;">
Materials Engineering
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
142801
</td>
<td style="text-align:left;">
Textile Sciences and Engineering
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
142301
</td>
<td style="text-align:left;">
Nuclear Engineering
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
143301
</td>
<td style="text-align:left;">
Construction Engineering
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
149999
</td>
<td style="text-align:left;">
Engineering, Other
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
<div id="how-to-use-fye_start" class="section level3">
<h3>How to use <code>fye_start</code></h3>
<p>We use the engineering case study to illustrate using the predicted starting majors.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># IDs of students ever enrolled in the case study programs </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">str</span>(rep_ever)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;  chr [1:10135] &quot;MID25783178&quot; &quot;MID25783197&quot; &quot;MID25783388&quot; &quot;MID25783441&quot; ...</span></span></code></pre></div>
<p>From <code>midfieldstudents</code> we obtain the matriculation programs for these students.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># matriculation CIP for representative example </span></span>
<span id="cb7-2"><a href="#cb7-2"></a>matric_programs &lt;-<span class="st"> </span><span class="kw">filter_by_id</span>(midfieldstudents, </span>
<span id="cb7-3"><a href="#cb7-3"></a>                                    <span class="dt">keep_id =</span> rep_ever, </span>
<span id="cb7-4"><a href="#cb7-4"></a>                                    <span class="dt">keep_col =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;cip6&quot;</span>))</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co"># examine the result</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>matric_programs</span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt;                 id   cip6</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;     1: MID25783178 14XXXX</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;     2: MID25783197 14XXXX</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt;     3: MID25783388 14XXXX</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt;     4: MID25783441 14XXXX</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;     5: MID25783491 14XXXX</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;     6: MID25783553 14XXXX</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;     7: MID25783606 14XXXX</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;     8: MID25783648 14XXXX</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt;     9: MID25783912 14XXXX</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;    10: MID25784022 14XXXX</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt;    ---                   </span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; 10126: MID26696484 141901</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; 10127: MID26696642 141001</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; 10128: MID26696738 141901</span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; 10129: MID26696771 140401</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; 10130: MID26696958 141901</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt; 10131: MID26696967 141901</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">#&gt; 10132: MID26696979 141901</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">#&gt; 10133: MID26697163 140101</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="co">#&gt; 10134: MID26697444 141901</span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">#&gt; 10135: MID26697447 140701</span></span></code></pre></div>
<p>Join the FYE starting programs by ID.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># left-join the predicted CIPs for FYE students</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>start_programs &lt;-<span class="st"> </span><span class="kw">merge</span>(matric_programs, </span>
<span id="cb8-3"><a href="#cb8-3"></a>                         fye_start, </span>
<span id="cb8-4"><a href="#cb8-4"></a>                         <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </span>
<span id="cb8-5"><a href="#cb8-5"></a>                         <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># examine the result</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>start_programs</span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;                 id   cip6  start</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;     1: MID25783178 14XXXX 140701</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;     2: MID25783197 14XXXX 140701</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;     3: MID25783388 14XXXX 141901</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;     4: MID25783441 14XXXX 140801</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;     5: MID25783491 14XXXX 141001</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;     6: MID25783553 14XXXX 140801</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;     7: MID25783606 14XXXX 141001</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;     8: MID25783648 14XXXX 140801</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt;     9: MID25783912 14XXXX 143501</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt;    10: MID25784022 14XXXX 141901</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt;    ---                          </span></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt; 10126: MID26696484 141901   &lt;NA&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt; 10127: MID26696642 141001   &lt;NA&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co">#&gt; 10128: MID26696738 141901   &lt;NA&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="co">#&gt; 10129: MID26696771 140401   &lt;NA&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="co">#&gt; 10130: MID26696958 141901   &lt;NA&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26"></a><span class="co">#&gt; 10131: MID26696967 141901   &lt;NA&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co">#&gt; 10132: MID26696979 141901   &lt;NA&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28"></a><span class="co">#&gt; 10133: MID26697163 140101   &lt;NA&gt;</span></span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="co">#&gt; 10134: MID26697444 141901   &lt;NA&gt;</span></span>
<span id="cb8-30"><a href="#cb8-30"></a><span class="co">#&gt; 10135: MID26697447 140701   &lt;NA&gt;</span></span></code></pre></div>
<p>For non-FYE students, the <code>start</code> value is the <code>cip6</code> value.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># non-FYE, replace NA with matriculation CIP </span></span>
<span id="cb9-2"><a href="#cb9-2"></a>rows_non_fye &lt;-<span class="st"> </span><span class="kw">is.na</span>(start_programs<span class="op">$</span>start)</span>
<span id="cb9-3"><a href="#cb9-3"></a>start_programs &lt;-<span class="st"> </span>start_programs[rows_non_fye, start <span class="op">:</span><span class="er">=</span><span class="st"> </span>cip6]</span></code></pre></div>
<p>The <code>cip6</code> column can be removed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># remove the matriculation CIP codes</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>start_programs[, cip6 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># examine the result</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>start_programs[]</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt;                 id  start</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt;     1: MID25783178 140701</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;     2: MID25783197 140701</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;     3: MID25783388 141901</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;     4: MID25783441 140801</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;     5: MID25783491 141001</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;     6: MID25783553 140801</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt;     7: MID25783606 141001</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;     8: MID25783648 140801</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt;     9: MID25783912 143501</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt;    10: MID25784022 141901</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt;    ---                   </span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; 10126: MID26696484 141901</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt; 10127: MID26696642 141001</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">#&gt; 10128: MID26696738 141901</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">#&gt; 10129: MID26696771 140401</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt; 10130: MID26696958 141901</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt; 10131: MID26696967 141901</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt; 10132: MID26696979 141901</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">#&gt; 10133: MID26697163 140101</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">#&gt; 10134: MID26697444 141901</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">#&gt; 10135: MID26697447 140701</span></span></code></pre></div>
<p>The starting program data derived above is the data set <code>rep_start</code> in midfieldr. View its help page by running</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>? rep_start</span></code></pre></div>
<p>To verify that these two data frames are identical,</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># verify result matches expectation</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">all.equal</span>(rep_start, start_programs)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
</div>
<div id="option-2-perform-the-multiple-imputation" class="section level2">
<h2>Option 2: Perform the multiple imputation</h2>
<p>The work described in this option is for those who want to do their own imputation. The example illustrates how the ready-to-use starting program data <code>fye_start</code> is created.</p>
<div id="how-to-use-fye_mi_prep" class="section level3">
<h3>How to use <code>fye_mi_prep()</code></h3>
<p>The midfieldr function <code>fye_mi_prep()</code> accesses MIDFIELD data (or equivalent) and prepares a data frame of all FYE students ready for imputation using the mice package.</p>
<p>The arguments of <code>fye_mi_prep()</code> are the student and term data sets.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># prepare data for mice()</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>mi_data &lt;-<span class="st"> </span><span class="kw">fye_mi_prep</span>(midfieldstudents, midfieldterms)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># examine the result</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>mi_data[]</span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt;                id   institution          race    sex   cip6</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt;    1: MID25783162 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt;    2: MID25783166 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt;    3: MID25783167 Institution M         White   Male 140901</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt;    4: MID25783178 Institution M         Black   Male 140701</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt;    5: MID25783197 Institution M         White   Male 140701</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt;    6: MID25783199 Institution M         White Female 140301</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt;    7: MID25783227 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt;    8: MID25783257 Institution M         White   Male 140701</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt;    9: MID25783275 Institution M         White   Male 140501</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt;   10: MID25783388 Institution M         White   Male 141901</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt;   ---                                                      </span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt; 5983: MID26648334 Institution J International   Male   &lt;NA&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; 5984: MID26648354 Institution J         Asian   Male   &lt;NA&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt; 5985: MID26648392 Institution J         White Female   &lt;NA&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; 5986: MID26648417 Institution J         White   Male   &lt;NA&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt; 5987: MID26648422 Institution J         White   Male   &lt;NA&gt;</span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt; 5988: MID26648435 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt; 5989: MID26648484 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">#&gt; 5990: MID26648508 Institution J International Female   &lt;NA&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">#&gt; 5991: MID26648517 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="co">#&gt; 5992: MID26648544 Institution J         White   Male   &lt;NA&gt;</span></span></code></pre></div>
<p>The result is a data frame with the predictor variables (institution, race, and sex) as factors. The NA values denote the CIP codes to be imputed.</p>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
<div id="how-fye_mi_prep-works" class="section level3">
<h3>How <code>fye_mi_prep()</code> works</h3>
<p>The function’s first operation extracts all FYE students from <code>midfieldstudents</code>, yielding:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#&gt;                id   institution          race    sex</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">#&gt;    1: MID25783162 Institution M         White   Male</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt;    2: MID25783166 Institution M         White   Male</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt;    3: MID25783167 Institution M         White   Male</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt;    4: MID25783178 Institution M         Black   Male</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt;    5: MID25783197 Institution M         White   Male</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt;    6: MID25783199 Institution M         White Female</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt;    7: MID25783227 Institution M         White   Male</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;    8: MID25783257 Institution M         White   Male</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt;    9: MID25783275 Institution M         White   Male</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt;   10: MID25783388 Institution M         White   Male</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt;   ---                                               </span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt; 5983: MID26648334 Institution J International   Male</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; 5984: MID26648354 Institution J         Asian   Male</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt; 5985: MID26648392 Institution J         White Female</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt; 5986: MID26648417 Institution J         White   Male</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt; 5987: MID26648422 Institution J         White   Male</span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt; 5988: MID26648435 Institution J      Hispanic   Male</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt; 5989: MID26648484 Institution J      Hispanic   Male</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt; 5990: MID26648508 Institution J International Female</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt; 5991: MID26648517 Institution J      Hispanic   Male</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt; 5992: MID26648544 Institution J         White   Male</span></span></code></pre></div>
<p>The function’s second operation extracts all term data for these students from <code>midfieldterms</code>. The function filters for students whose first post-FYE program is in engineering, yielding:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">#&gt;                id   cip6</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt;    1: MID25783167 140901</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt;    2: MID25783178 140701</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt;    3: MID25783197 140701</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt;    4: MID25783199 140301</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt;    5: MID25783257 140701</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt;    6: MID25783275 140501</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt;    7: MID25783388 141901</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt;    8: MID25783441 140801</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt;    9: MID25783491 141001</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt;   10: MID25783553 140801</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt;   ---                   </span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt; 3359: MID26640528 141901</span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">#&gt; 3360: MID26640591 141901</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">#&gt; 3361: MID26640613 142101</span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co">#&gt; 3362: MID26640916 141901</span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">#&gt; 3363: MID26640932 141101</span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co">#&gt; 3364: MID26641121 140201</span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt; 3365: MID26642386 140801</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt; 3366: MID26642809 140801</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt; 3367: MID26642812 141001</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt; 3368: MID26643920 141901</span></span></code></pre></div>
<p>The results from the two operations are joined, creating an NA in the <code>cip6</code> column, representing FYE students whose post-FYE programs are missing or non-engineering.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">#&gt;                id   institution          race    sex   cip6</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt;    1: MID25783162 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">#&gt;    2: MID25783166 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt;    3: MID25783167 Institution M         White   Male 140901</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt;    4: MID25783178 Institution M         Black   Male 140701</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt;    5: MID25783197 Institution M         White   Male 140701</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#&gt;    6: MID25783199 Institution M         White Female 140301</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt;    7: MID25783227 Institution M         White   Male   &lt;NA&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt;    8: MID25783257 Institution M         White   Male 140701</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">#&gt;    9: MID25783275 Institution M         White   Male 140501</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt;   10: MID25783388 Institution M         White   Male 141901</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt;   ---                                                      </span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">#&gt; 5983: MID26648334 Institution J International   Male   &lt;NA&gt;</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">#&gt; 5984: MID26648354 Institution J         Asian   Male   &lt;NA&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">#&gt; 5985: MID26648392 Institution J         White Female   &lt;NA&gt;</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co">#&gt; 5986: MID26648417 Institution J         White   Male   &lt;NA&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="co">#&gt; 5987: MID26648422 Institution J         White   Male   &lt;NA&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="co">#&gt; 5988: MID26648435 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co">#&gt; 5989: MID26648484 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="co">#&gt; 5990: MID26648508 Institution J International Female   &lt;NA&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="co">#&gt; 5991: MID26648517 Institution J      Hispanic   Male   &lt;NA&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co">#&gt; 5992: MID26648544 Institution J         White   Male   &lt;NA&gt;</span></span></code></pre></div>
<p>The final operation is to convert the three predictor variables—institution, race, and sex—to factors, yielding the form required for input data to <code>mice()</code>.</p>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
<div id="how-to-use-mice" class="section level3">
<h3>How to use <code>mice()</code></h3>
<p>The mice package creates multiple imputations (replacement values) for missing data <span class="citation">(van Buuren and Groothuis-Oudshoorn, <a href="#ref-vanBuuren+Oudshoorn:2011" role="doc-biblioref">2011</a>)</span>. The replacement values are CIP codes to replace the NA values in the prepared data frame.</p>
<p>Our predictors (institution, race, and sex) are unordered categorical variables, so the imputation method we select is a “polytomous logistic regression” (argument <code>polyreg</code>). To read more, view the help page by running</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>? <span class="kw">mice</span>() </span></code></pre></div>
<p>To examine the default arguments that <code>mice()</code> applies to our data, we call the function with zero iterations. (A warning may appear in your console. It can be ignored.)</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># examine default arguments </span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">mice</span>(mi_data, <span class="dt">maxit =</span> <span class="dv">0</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">#&gt; Class: mids</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; Number of multiple imputations:  5 </span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; Imputation methods:</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt;          id institution        race         sex        cip6 </span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;   &quot;polyreg&quot; </span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; PredictorMatrix:</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt;             id institution race sex cip6</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt; id           0           1    1   1    1</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">#&gt; institution  0           0    1   1    1</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">#&gt; race         0           1    0   1    1</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#&gt; sex          0           1    1   0    1</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="co">#&gt; cip6         0           1    1   1    0</span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">#&gt; Number of logged events:  1 </span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co">#&gt;   it im dep     meth out</span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="co">#&gt; 1  0  0     constant  id</span></span></code></pre></div>
<p>This framework is suited to our data, so no further editing of these data is needed. (If editing were required, a procedure is outlined in Appendix A.)</p>
<ul>
<li>Number of multiple imputations is 5</li>
<li>Imputation method is <code>polyreg</code>, applied to <code>cip6</code> only. This is the appropriate method for multiple, unordered, categorical predictor variables.</li>
<li><code>cip6</code> row of the predictor matrix correctly has a <code>1</code> in each of the three predictor columns (the other rows can be ignored)</li>
</ul>
<p>Applying <code>mice()</code> to our data returns an object of class <code>mids</code> (multiply imputed data set). The default <code>seed</code> argument is NULL, but by setting the seed as shown the vignette results are reproducible. Setting <code>printFlag = TRUE</code> displays progress in the console.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># impute missing CIP codes </span></span>
<span id="cb19-2"><a href="#cb19-2"></a>mi_mids &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(mi_data, <span class="dt">seed =</span> <span class="dv">20180624</span>, <span class="dt">printFlag =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">#&gt;  iter imp variable</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt;   1   1  cip6</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt;   1   2  cip6</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt;   1   3  cip6</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">#&gt;   1   4  cip6</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt;   1   5  cip6</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt; ---</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">#&gt;   5   1  cip6</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">#&gt;   5   2  cip6</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co">#&gt;   5   3  cip6</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co">#&gt;   5   4  cip6</span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co">#&gt;   5   5  cip6</span></span></code></pre></div>
<p>To export the <code>mids</code> object to a data frame, we use the <code>complete()</code> function.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># export result to data frame </span></span>
<span id="cb20-2"><a href="#cb20-2"></a>mi_start &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">complete</span>(mi_mids)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># convert to data.table structure</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>data.table<span class="op">::</span><span class="kw">setDT</span>(mi_start)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co"># examine the result</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>mi_start[]</span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">#&gt;                id   institution          race    sex   cip6</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt;    1: MID25783162 Institution M         White   Male 140901</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt;    2: MID25783166 Institution M         White   Male 141901</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt;    3: MID25783167 Institution M         White   Male 140901</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">#&gt;    4: MID25783178 Institution M         Black   Male 140701</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">#&gt;    5: MID25783197 Institution M         White   Male 140701</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co">#&gt;    6: MID25783199 Institution M         White Female 140301</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt;    7: MID25783227 Institution M         White   Male 141001</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">#&gt;    8: MID25783257 Institution M         White   Male 140701</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt;    9: MID25783275 Institution M         White   Male 140501</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="co">#&gt;   10: MID25783388 Institution M         White   Male 141901</span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="co">#&gt;   ---                                                      </span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="co">#&gt; 5983: MID26648334 Institution J International   Male 140801</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="co">#&gt; 5984: MID26648354 Institution J         Asian   Male 140901</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="co">#&gt; 5985: MID26648392 Institution J         White Female 141901</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="co">#&gt; 5986: MID26648417 Institution J         White   Male 140201</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="co">#&gt; 5987: MID26648422 Institution J         White   Male 141901</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="co">#&gt; 5988: MID26648435 Institution J      Hispanic   Male 141901</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="co">#&gt; 5989: MID26648484 Institution J      Hispanic   Male 140801</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="co">#&gt; 5990: MID26648508 Institution J International Female 140701</span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="co">#&gt; 5991: MID26648517 Institution J      Hispanic   Male 140801</span></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="co">#&gt; 5992: MID26648544 Institution J         White   Male 141901</span></span></code></pre></div>
<p>Some final data carpentry yields the data frame we want.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># select columns </span></span>
<span id="cb21-2"><a href="#cb21-2"></a>columns_we_want &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;cip6&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a>mi_start &lt;-<span class="st"> </span>mi_start[, ..columns_we_want]</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># ensure our columns are characters</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>mi_start[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(id)]</span>
<span id="cb21-7"><a href="#cb21-7"></a>mi_start[, cip6 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(cip6)]</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co"># order the rows</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>mi_start &lt;-<span class="st"> </span>mi_start[<span class="kw">order</span>(id)]</span>
<span id="cb21-11"><a href="#cb21-11"></a></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co"># rename CIP to start</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="kw">setnames</span>(mi_start, <span class="dt">old =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;start&quot;</span>)</span>
<span id="cb21-14"><a href="#cb21-14"></a></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co"># examine the result</span></span>
<span id="cb21-16"><a href="#cb21-16"></a>mi_start[]</span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">#&gt;                id  start</span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co">#&gt;    1: MID25783162 140901</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">#&gt;    2: MID25783166 141901</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">#&gt;    3: MID25783167 140901</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">#&gt;    4: MID25783178 140701</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">#&gt;    5: MID25783197 140701</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="co">#&gt;    6: MID25783199 140301</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="co">#&gt;    7: MID25783227 141001</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co">#&gt;    8: MID25783257 140701</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">#&gt;    9: MID25783275 140501</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="co">#&gt;   10: MID25783388 141901</span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co">#&gt;   ---                   </span></span>
<span id="cb21-29"><a href="#cb21-29"></a><span class="co">#&gt; 5983: MID26648334 140801</span></span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">#&gt; 5984: MID26648354 140901</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co">#&gt; 5985: MID26648392 141901</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co">#&gt; 5986: MID26648417 140201</span></span>
<span id="cb21-33"><a href="#cb21-33"></a><span class="co">#&gt; 5987: MID26648422 141901</span></span>
<span id="cb21-34"><a href="#cb21-34"></a><span class="co">#&gt; 5988: MID26648435 141901</span></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="co">#&gt; 5989: MID26648484 140801</span></span>
<span id="cb21-36"><a href="#cb21-36"></a><span class="co">#&gt; 5990: MID26648508 140701</span></span>
<span id="cb21-37"><a href="#cb21-37"></a><span class="co">#&gt; 5991: MID26648517 140801</span></span>
<span id="cb21-38"><a href="#cb21-38"></a><span class="co">#&gt; 5992: MID26648544 141901</span></span></code></pre></div>
<p>This data frame is identical to the <code>fye_start</code> data described earlier. To verify that these two data frames are identical,</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># verify result matches expectation</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="kw">all.equal</span>(mi_start, fye_start)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Lastly, because the mice package masks the base R <code>rbind()</code> and <code>cbind()</code> functions, we use the following to unload the package once we’re done with it.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># unload because mice masks rbind</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">detach</span>(<span class="st">&quot;package:mice&quot;</span>, <span class="dt">unload =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<div id="refs">
<div id="ref-Katitas:2019">
<p>Katitas A (2019) Getting started with multiple imputation in R. <a href="https://shorturl.at/bEFMZ">https://shorturl.at/bEFMZ</a></p>
</div>
<div id="ref-vanBuuren+Oudshoorn:2011">
<p>van Buuren S and Groothuis-Oudshoorn K (2011) mice: Multivariate Imputation by Chained Equations in R. <em>Journal of Statistical Software</em> <strong>45</strong>(3), 1–67 <a href="https://www.jstatsoft.org/v45/i03/">https://www.jstatsoft.org/v45/i03/</a></p>
</div>
</div>
</div>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
<div id="a.-editing-the-arguments-for-mice" class="section level3">
<h3>A. Editing the arguments for <code>mice()</code></h3>
<p>Had the default framework not been to our liking, we reset the arguments as follows, adapted from <span class="citation">(Katitas, <a href="#ref-Katitas:2019" role="doc-biblioref">2019</a>)</span>.</p>
<p>Obtain the <code>mi_data</code> as before, using <code>fye_mi_prep()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>mi_data &lt;-<span class="st"> </span><span class="kw">fye_mi_prep</span>()</span></code></pre></div>
<p>Use this data as the input to <code>mice()</code> with zero iterations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>mi_framework &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(mi_data, <span class="dt">maxit =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Extract the method and predictor matrix from the framework.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>mi_method &lt;-<span class="st"> </span>mi_framework<span class="op">$</span>method</span>
<span id="cb26-2"><a href="#cb26-2"></a>mi_predictors &lt;-<span class="st"> </span>mi_framework<span class="op">$</span>predictorMatrix</span></code></pre></div>
<p>Assign the <code>polyreg</code> method to <code>cip6</code> and the “empty” method (<code>&quot;&quot;</code>) to all others.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># apply an imputation method to CIP only </span></span>
<span id="cb27-2"><a href="#cb27-2"></a>mi_method[<span class="kw">c</span>(<span class="st">&quot;cip6&quot;</span>)] &lt;-<span class="st"> &quot;polyreg&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>mi_method[<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;institution&quot;</span>, <span class="st">&quot;race&quot;</span>, <span class="st">&quot;sex&quot;</span>)] &lt;-<span class="st"> &quot;&quot;</span></span></code></pre></div>
<p>Ensure the ID column is not a predictor by setting its column values in the predictor matrix to zero.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>mi_predictors[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></span></code></pre></div>
<p>An imputation method is assigned to <code>cip6</code> only, so only the <code>cip6</code> row of the predictor matrix is active. The values of <code>1</code> in the row indicate that institution, sex, and race are used to impute the CIP code.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># predictor matrix excerpt </span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co">#&gt;             id cip6 institution race sex</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co">#&gt; cip6         0    0           1    1   1</span></span></code></pre></div>
<p>Our three main arguments <code>mi_data</code>, <code>mi_method</code>, and <code>mi_predictors</code> are ready to use.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>mi_mids &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(<span class="dt">data =</span> mi_data,</span>
<span id="cb30-2"><a href="#cb30-2"></a>                      <span class="dt">method =</span> mi_method,</span>
<span id="cb30-3"><a href="#cb30-3"></a>                      <span class="dt">predictorMatrix =</span> mi_predictors, </span>
<span id="cb30-4"><a href="#cb30-4"></a>                      <span class="dt">seed =</span> <span class="dv">20180624</span>, </span>
<span id="cb30-5"><a href="#cb30-5"></a>                      <span class="dt">printFlag =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>The <code>seed</code> and <code>printFlag</code> arguments are optional.</p>
<p><br> <a href="#top">▲ top of page</a></p>
</div>
<div id="b.-complete-script" class="section level3">
<h3>B. Complete script</h3>
<p>The vignette code chunks are collected below in a single, condensed script.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># packages used</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">library</span>(midfieldr)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">library</span>(midfielddata)</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="kw">library</span>(mice)</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co"># Option 1: Ready-to-use starting programs</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co"># Summarize fye_start by program CIP</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>fye_start_summary &lt;-<span class="st"> </span>fye_start[, .(<span class="dt">N =</span> .N), by =<span class="st"> &quot;start&quot;</span>]</span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="kw">setnames</span>(fye_start_summary, <span class="dt">old =</span> <span class="st">&quot;start&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;cip6&quot;</span>)</span>
<span id="cb31-11"><a href="#cb31-11"></a>fye_start_summary &lt;-<span class="st"> </span><span class="kw">merge</span>(fye_start_summary, cip, <span class="dt">by =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-12"><a href="#cb31-12"></a>fye_start_summary &lt;-<span class="st"> </span>fye_start_summary[<span class="kw">order</span>(<span class="op">-</span>N), .(cip6, cip6name, N)]</span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="kw">setnames</span>(fye_start_summary, <span class="dt">old =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;start&quot;</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co"># How to use fye_start</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>matric_programs &lt;-<span class="st"> </span><span class="kw">filter_by_id</span>(midfieldstudents, </span>
<span id="cb31-17"><a href="#cb31-17"></a>                                <span class="dt">keep_id =</span> rep_ever, </span>
<span id="cb31-18"><a href="#cb31-18"></a>                                <span class="dt">keep_col =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;cip6&quot;</span>))</span>
<span id="cb31-19"><a href="#cb31-19"></a>start_programs &lt;-<span class="st"> </span><span class="kw">merge</span>(matric_programs, </span>
<span id="cb31-20"><a href="#cb31-20"></a>                        fye_start, </span>
<span id="cb31-21"><a href="#cb31-21"></a>                        <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, </span>
<span id="cb31-22"><a href="#cb31-22"></a>                        <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-23"><a href="#cb31-23"></a>rows_non_fye &lt;-<span class="st"> </span><span class="kw">is.na</span>(start_programs<span class="op">$</span>start)</span>
<span id="cb31-24"><a href="#cb31-24"></a>start_programs &lt;-<span class="st"> </span>start_programs[rows_non_fye, start <span class="op">:</span><span class="er">=</span><span class="st"> </span>cip6]</span>
<span id="cb31-25"><a href="#cb31-25"></a>start_programs[, cip6 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</span>
<span id="cb31-26"><a href="#cb31-26"></a></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="co"># Option 2: Perform the multiple imputation</span></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="co"># How to use fye_mi_prep()</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>mi_data &lt;-<span class="st"> </span><span class="kw">fye_mi_prep</span>(midfieldstudents, midfieldterms)</span>
<span id="cb31-30"><a href="#cb31-30"></a></span>
<span id="cb31-31"><a href="#cb31-31"></a><span class="co"># How to use mice()</span></span>
<span id="cb31-32"><a href="#cb31-32"></a><span class="kw">mice</span>(mi_data, <span class="dt">maxit =</span> <span class="dv">0</span>)</span>
<span id="cb31-33"><a href="#cb31-33"></a>mi_mids &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(mi_data, <span class="dt">seed =</span> <span class="dv">20180624</span>, <span class="dt">printFlag =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-34"><a href="#cb31-34"></a>mi_start &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">complete</span>(mi_mids)</span>
<span id="cb31-35"><a href="#cb31-35"></a>data.table<span class="op">::</span><span class="kw">setDT</span>(mi_start)</span>
<span id="cb31-36"><a href="#cb31-36"></a>columns_we_want &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;cip6&quot;</span>)</span>
<span id="cb31-37"><a href="#cb31-37"></a>mi_start &lt;-<span class="st"> </span>mi_start[, ..columns_we_want]</span>
<span id="cb31-38"><a href="#cb31-38"></a>mi_start[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(id)]</span>
<span id="cb31-39"><a href="#cb31-39"></a>mi_start[, cip6 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(cip6)]</span>
<span id="cb31-40"><a href="#cb31-40"></a>mi_start &lt;-<span class="st"> </span>mi_start[<span class="kw">order</span>(id)]</span>
<span id="cb31-41"><a href="#cb31-41"></a><span class="kw">setnames</span>(mi_start, <span class="dt">old =</span> <span class="st">&quot;cip6&quot;</span>, <span class="dt">new =</span> <span class="st">&quot;start&quot;</span>)</span>
<span id="cb31-42"><a href="#cb31-42"></a><span class="kw">detach</span>(<span class="st">&quot;package:mice&quot;</span>, <span class="dt">unload =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-43"><a href="#cb31-43"></a></span>
<span id="cb31-44"><a href="#cb31-44"></a><span class="co"># Appendix: editing the arguments for mice()</span></span>
<span id="cb31-45"><a href="#cb31-45"></a>mi_data &lt;-<span class="st"> </span><span class="kw">fye_mi_prep</span>()</span>
<span id="cb31-46"><a href="#cb31-46"></a>mi_framework &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(mi_data, <span class="dt">maxit =</span> <span class="dv">0</span>)</span>
<span id="cb31-47"><a href="#cb31-47"></a>mi_method &lt;-<span class="st"> </span>mi_framework<span class="op">$</span>method</span>
<span id="cb31-48"><a href="#cb31-48"></a>mi_predictors &lt;-<span class="st"> </span>mi_framework<span class="op">$</span>predictorMatrix</span>
<span id="cb31-49"><a href="#cb31-49"></a>mi_method[<span class="kw">c</span>(<span class="st">&quot;cip6&quot;</span>)] &lt;-<span class="st"> &quot;polyreg&quot;</span></span>
<span id="cb31-50"><a href="#cb31-50"></a>mi_method[<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;institution&quot;</span>, <span class="st">&quot;race&quot;</span>, <span class="st">&quot;sex&quot;</span>)] &lt;-<span class="st"> &quot;&quot;</span></span>
<span id="cb31-51"><a href="#cb31-51"></a>mi_predictors[, <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb31-52"><a href="#cb31-52"></a>mi_mids &lt;-<span class="st"> </span>mice<span class="op">::</span><span class="kw">mice</span>(<span class="dt">data =</span> mi_data,</span>
<span id="cb31-53"><a href="#cb31-53"></a>                      <span class="dt">method =</span> mi_method,</span>
<span id="cb31-54"><a href="#cb31-54"></a>                      <span class="dt">predictorMatrix =</span> mi_predictors, </span>
<span id="cb31-55"><a href="#cb31-55"></a>                      <span class="dt">seed =</span> <span class="dv">20180624</span>, </span>
<span id="cb31-56"><a href="#cb31-56"></a>                      <span class="dt">printFlag =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><br> <a href="#top">▲ top of page </a><br />
<a href="../index.html">◁ main page </a></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
