<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midfieldr">
<title>Blocs • midfieldr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Courier_Prime-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Blocs">
<meta property="og:description" content="midfieldr">
<meta property="og:image" content="https://midfieldr.github.io/midfieldr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">midfieldr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9029</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/art-000-getting-started.html">Getting started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-study">Case study</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-study">
    <a class="dropdown-item" href="../articles/art-001-case-goals.html">Goals</a>
    <a class="dropdown-item" href="../articles/art-002-case-data.html">Data</a>
    <a class="dropdown-item" href="../articles/art-003-case-results.html">Results</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/art-010-planning.html">Planning</a>
    <a class="dropdown-item" href="../articles/art-020-data-sufficiency.html">Data sufficiency</a>
    <a class="dropdown-item" href="../articles/art-030-degree-seeking.html">Degree seeking</a>
    <a class="dropdown-item" href="../articles/art-040-programs.html">Programs</a>
    <a class="dropdown-item" href="../articles/art-050-blocs.html">Blocs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MIDFIELDR/midfieldr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Blocs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MIDFIELDR/midfieldr/blob/HEAD/vignettes/art-050-blocs.Rmd" class="external-link"><code>vignettes/art-050-blocs.Rmd</code></a></small>
      <div class="d-none name"><code>art-050-blocs.Rmd</code></div>
    </div>

    
    
<p>A <em>bloc</em> is a grouping of Student Unit Records (SURs) dealt
with as a unit, for example, a grouping of starters in a program,
graduates of a program, or ever enrolled in a program. We often use a
<em>left join</em> merging operation to add one or more variables to a
working data frame and filter on those variables to construct the
desired bloc.</p>
<p>Different metrics require different blocs. Graduation rate, for
example, requires starters and their graduating subset; stickiness
requires ever-enrolled and their graduating subset. Subsequent articles
describe <a href="art-060-fye-proxies.html">FYE proxies</a> (special
case of starters), <a href="art-070-starters.html">Starters</a>, and <a href="art-080-graduates.html">Graduates</a>. This article treats the
<em>ever-enrolled</em> bloc and left joins generally.</p>
<p>Because a bloc is usually defined for specific programs, the final
filter applied in gathering a bloc is often an <em>inner join</em> to
filter by program labels, developed in <a href="art-040-programs.html#reusable-code">Programs</a>.</p>
<p>This article in the MIDFIELD workflow.</p>
<ol style="list-style-type: decimal">
<li>Planning<br>
</li>
<li>Initial processing<br>
</li>
<li>
<span style=" font-weight: bold;    color: #b35806 !important;">Blocs</span>
<ul>
<li>
<span style=" font-weight: bold;    color: #b35806 !important;">Ever-enrolled</span><br>
</li>
<li>FYE proxies<br>
</li>
<li>Starters<br>
</li>
<li>Graduates<br>
</li>
</ul>
</li>
<li>Groupings<br>
</li>
<li>Metrics<br>
</li>
<li>Displays</li>
</ol>
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<dl>
<dt>bloc</dt>
<dd>
<p>A grouping of student-level data dealt with as a unit, for example,
starters, students ever-enrolled, graduates, transfer students,
traditional and non-traditional students, migrators, etc.</p>
</dd>
<dt>ever-enrolled</dt>
<dd>
<p>Bloc of students whose term records include a specified program in at
least one term.</p>
</dd>
<dt>migrators</dt>
<dd>
<p>Bloc of students who leave one program to enroll in another. Also
called <em>switchers.</em></p>
</dd>
</dl>
</div>
<div class="section level2">
<h2 id="method">Method<a class="anchor" aria-label="anchor" href="#method"></a>
</h2>
<p>We use left joins to add variables to a working data frame and filter
for students ever-enrolled in the case study programs. Migrators (if
any) yield more than one observation (program) for the same ID.</p>
<ol style="list-style-type: decimal">
<li><p>Filter source SURs for data sufficiency and
degree-seeking.</p></li>
<li><p>Gather ever-enrolled</p></li>
<li><p>Filter by program.</p></li>
</ol>
<p><em>Reminder.</em>   midfielddata is suitable for learning to work
with student-level data but not for drawing inferences about program
attributes or student experiences. midfielddata supplies practice data,
not research data.</p>
</div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p><em>Open.</em>   If you are writing your own script to follow along,
we use these packages in this article:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://midfieldr.github.io/midfieldr/">midfieldr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://midfieldr.github.io/midfielddata/" class="external-link">midfielddata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p><em>Load.</em>   MIDFIELD practice data tables. Described in <a href="art-000-getting-started.html">Getting started</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load practice data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span>, <span class="va">degree</span><span class="op">)</span></span></code></pre></div>
<p><em>Loads with midfieldr.</em></p>
<ul>
<li>
<code>study_programs</code> (derived in <a href="art-040-programs.html#reusable-code">Programs</a>).</li>
</ul>
</div>
<div class="section level2">
<h2 id="initial-processing">Initial processing<a class="anchor" aria-label="anchor" href="#initial-processing"></a>
</h2>
<p><em>(Optional) Select.</em>   Columns required by midfieldr
functions. Code reproduced from <a href="art-000-getting-started.html#reusable-code">Getting
started</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optional. Copy of source files with all variables</span></span>
<span><span class="va">source_student</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">student</span><span class="op">)</span></span>
<span><span class="va">source_term</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="va">source_degree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">degree</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional. Select variables required by midfieldr functions</span></span>
<span><span class="va">student</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_required.html">select_required</a></span><span class="op">(</span><span class="va">source_student</span><span class="op">)</span></span>
<span><span class="va">term</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_required.html">select_required</a></span><span class="op">(</span><span class="va">source_term</span><span class="op">)</span></span>
<span><span class="va">degree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_required.html">select_required</a></span><span class="op">(</span><span class="va">source_degree</span><span class="op">)</span></span></code></pre></div>
<p><em>Work.</em>   Using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy()</a></code> avoids
<em>by-reference</em> effects <span class="citation">(<a href="#ref-data.table-reference-semantics" role="doc-biblioref">Dowle
&amp; Srinivasan, 2022</a>)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Working data frame</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span></code></pre></div>
<p><em>Data sufficiency.</em>   Filter to satisfy the data sufficiency
criterion. Code reproduced from <a href="art-020-data-sufficiency.html#reusable-code">Data
sufficiency</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for data sufficiency, output unique IDs</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_timely_term.html">add_timely_term</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_data_sufficiency.html">add_data_sufficiency</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">data_sufficiency</span> <span class="op">==</span> <span class="st">"include"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
<p><em>Degree seeking.</em>   Filter to retain degree seeking students
via an inner join with <code>student</code>. Code reproduced from <a href="art-030-degree-seeking.html#reusable-code">Degree seeking</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for degree seeking, output unique IDs</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">student</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
<p>We preserve this data frame as a baseline for examples in the
article.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="left-joins">Left joins<a class="anchor" aria-label="anchor" href="#left-joins"></a>
</h2>
<p>An left join is a merge operation between two data frames which
returns all observations (rows) of the “left” data frame <code>X</code>
and all the matching rows in the “right” data frame <code>Y</code>.
Using data.table syntax, we have two approaches:
<code>merge(X, Y, by)</code> (similar to base R) and
<code>Y[X, j, on]</code> (native to data.table).</p>
<div class="section level3">
<h3 id="using-mergex-y-by">Using <code>merge(X, Y, by)</code><a class="anchor" aria-label="anchor" href="#using-mergex-y-by"></a>
</h3>
<p>The general form for a left join is</p>
<pre><code><span>    <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, <span class="va">by</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
<p>where</p>
<ul>
<li>
<code>X</code> is the “left” data frame, all rows returned<br>
</li>
<li>
<code>Y</code> is the “right” data frame, matching rows
returned</li>
<li>
<code>by</code> is the vector of shared column names to merge
by<br>
</li>
<li>
<code>all.x = TRUE</code> ensures the left join</li>
</ul>
<p>In this example, the <code>Y</code> data frame is <code>term</code>,
from which we extract the ID and CIP columns before the join.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset of term data frame to join</span></span>
<span><span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># merge(X, Y, by) left join</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">cols_we_want</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   mcid   cip6</span></span>
<span><span class="co">#&gt;      1: MCID3111142689 090401</span></span>
<span><span class="co">#&gt;      2: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;      3: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;     ---                      </span></span>
<span><span class="co">#&gt; 531417: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531418: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531419: MCID3112870009 240102</span></span></code></pre></div>
<p>Alternatively, one can select <code>Y</code> columns within the merge
operation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge(X, Y, by) left join</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   mcid   cip6</span></span>
<span><span class="co">#&gt;      1: MCID3111142689 090401</span></span>
<span><span class="co">#&gt;      2: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;      3: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;     ---                      </span></span>
<span><span class="co">#&gt; 531417: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531418: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531419: MCID3112870009 240102</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-yx-j-on">Using <code>Y[X, j, on]</code><a class="anchor" aria-label="anchor" href="#using-yx-j-on"></a>
</h3>
<p>The second approach—native to data.table and computationally more
efficient—has the form</p>
<pre><code><span>    <span class="va">Y</span><span class="op">[</span><span class="va">X</span>, <span class="va">j</span>, <span class="va">on</span><span class="op">]</span></span></code></pre>
<p>where</p>
<ul>
<li>
<code>X</code> is the “left” data frame, all rows returned<br>
</li>
<li>
<code>Y</code> is the “right” data frame, matching rows
returned</li>
<li>
<code>j</code> selects columns from the joined data frame to
retain</li>
<li>
<code>on</code> is the vector of shared column names to merge
on</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Y[X, j, on] left join (data.table native syntax)</span></span>
<span><span class="va">term</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                   mcid   cip6</span></span>
<span><span class="co">#&gt;      1: MCID3111142689 090401</span></span>
<span><span class="co">#&gt;      2: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;      3: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;     ---                      </span></span>
<span><span class="co">#&gt; 531417: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531418: MCID3112870009 240102</span></span>
<span><span class="co">#&gt; 531419: MCID3112870009 240102</span></span></code></pre></div>
<p><em>Demonstrate equivalence.</em> Showing that the two approaches
produce the same result.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge(X, Y, by) left join</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Y[X, j, on] left join</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Demonstrate equivalence</span></span>
<span><span class="fu"><a href="../reference/same_content.html">same_content</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="left-join-matching-rules">Left join matching rules<a class="anchor" aria-label="anchor" href="#left-join-matching-rules"></a>
</h3>
<p><em>Rows in X with no match in Y</em>   will have NA values in the
columns normally filled with <code>Y</code> values.</p>
<p>For example, not all students in <code>DT</code> will earn a degree.
After a left join (<code>degree</code> into <code>DT</code>), all rows
of <code>DT</code> are returned. IDs in <code>DT</code> with no match in
<code>degree</code> have an NA in the <code>term_degree</code> column (a
variable from the <code>degree</code> source table).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">degree</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term_degree</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt;                  mcid term_degree</span></span>
<span><span class="co">#&gt;     1: MCID3111142689       19913</span></span>
<span><span class="co">#&gt;     2: MCID3111142782       19903</span></span>
<span><span class="co">#&gt;     3: MCID3111142881       19894</span></span>
<span><span class="co">#&gt;     4: MCID3111142884        &lt;NA&gt;</span></span>
<span><span class="co">#&gt;     5: MCID3111142893        &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    ---                           </span></span>
<span><span class="co">#&gt; 76988: MCID3112727985        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 76989: MCID3112730841       20164</span></span>
<span><span class="co">#&gt; 76990: MCID3112785480        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 76991: MCID3112800920        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 76992: MCID3112870009        &lt;NA&gt;</span></span></code></pre></div>
<p>The result has 76,875 unique IDs with 43,903 degrees.</p>
<p><em>Rows in X with multiple matches in Y</em>   yields a new row in
<code>X</code> for every matching row in <code>Y</code>.</p>
<p>For example, most students in <code>DT</code> will be enrolled in
multiple terms. After a left join (<code>term</code> into
<code>DT</code>), all rows in <code>DT</code> are returned. IDs in
<code>DT</code> with multiple matches in <code>term</code> have multiple
rows in the result, differentiated by the values in the
<code>term</code> column (a variable from the <code>term</code> source
table).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt;                   mcid  term</span></span>
<span><span class="co">#&gt;      1: MCID3111142689 19883</span></span>
<span><span class="co">#&gt;      2: MCID3111142782 19883</span></span>
<span><span class="co">#&gt;      3: MCID3111142782 19885</span></span>
<span><span class="co">#&gt;      4: MCID3111142782 19893</span></span>
<span><span class="co">#&gt;      5: MCID3111142782 19895</span></span>
<span><span class="co">#&gt;     ---                     </span></span>
<span><span class="co">#&gt; 531415: MCID3112800920 20163</span></span>
<span><span class="co">#&gt; 531416: MCID3112870009 19951</span></span>
<span><span class="co">#&gt; 531417: MCID3112870009 19953</span></span>
<span><span class="co">#&gt; 531418: MCID3112870009 19954</span></span>
<span><span class="co">#&gt; 531419: MCID3112870009 19983</span></span></code></pre></div>
<p>The result has 76,875 unique IDs distributed over 531,419
observations.</p>
<p><em>“Left” and “right” matter.</em>   In left joins (unlike inner
joins), <code>X[Y]</code> and <code>Y[X]</code> return different
results:</p>
<ul>
<li><p><code>Y[X, j, on]</code> returns all rows of
<code>X</code></p></li>
<li><p><code>X[Y, j, on]</code> returns all rows of
<code>Y</code></p></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># What we want</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">degree</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term_degree</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Not what we want</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">degree</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term_degree</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Same content?</span></span>
<span><span class="fu"><a href="../reference/same_content.html">same_content</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Different number of rows"</span></span>
<span></span>
<span><span class="co"># Compare N rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 76992</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 49665</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="ever-enrolled">Ever-enrolled<a class="anchor" aria-label="anchor" href="#ever-enrolled"></a>
</h2>
<p><em>Work.</em>   The baseline data frame we preserved earlier is the
intake for this section.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reusable starting state</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt;                  mcid</span></span>
<span><span class="co">#&gt;     1: MCID3111142689</span></span>
<span><span class="co">#&gt;     2: MCID3111142782</span></span>
<span><span class="co">#&gt;     3: MCID3111142881</span></span>
<span><span class="co">#&gt;    ---               </span></span>
<span><span class="co">#&gt; 76873: MCID3112785480</span></span>
<span><span class="co">#&gt; 76874: MCID3112800920</span></span>
<span><span class="co">#&gt; 76875: MCID3112870009</span></span></code></pre></div>
<p><em>Add a variable.</em>   Use a left join from <code>term</code> to
<code>DT</code> to add the CIP variable.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Left-outer join from term to DT</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p><em>Filter.</em>   Filter to retain unique combinations if ID and CIP
code.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One observation per ID-CIP combination</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt;                   mcid   cip6</span></span>
<span><span class="co">#&gt;      1: MCID3111142689 090401</span></span>
<span><span class="co">#&gt;      2: MCID3111142782 260101</span></span>
<span><span class="co">#&gt;      3: MCID3111142881 450601</span></span>
<span><span class="co">#&gt;     ---                      </span></span>
<span><span class="co">#&gt; 127347: MCID3112800920 240102</span></span>
<span><span class="co">#&gt; 127348: MCID3112800920 240199</span></span>
<span><span class="co">#&gt; 127349: MCID3112870009 240102</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filter-by-program">Filter by program<a class="anchor" aria-label="anchor" href="#filter-by-program"></a>
</h2>
<p><em>Filter.</em>   Because “ever-enrolled” usually means
“ever-enrolled in specific programs,” this bloc concludes with a filter
by program. Code reproduced from <a href="art-090-groupings.html#program-labels">Groupings</a>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter by program</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">study_programs</span><span class="op">[</span><span class="va">DT</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cip6"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">cip6</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="va">DT</span><span class="op">[</span><span class="op">]</span></span>
<span><span class="co">#&gt;       program           mcid</span></span>
<span><span class="co">#&gt;    1:      EE MCID3111142965</span></span>
<span><span class="co">#&gt;    2:      EE MCID3111145102</span></span>
<span><span class="co">#&gt;    3:      EE MCID3111146537</span></span>
<span><span class="co">#&gt;   ---                       </span></span>
<span><span class="co">#&gt; 5651:      ME MCID3112641399</span></span>
<span><span class="co">#&gt; 5652:      ME MCID3112641535</span></span>
<span><span class="co">#&gt; 5653:      ME MCID3112698681</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reusable-code-blocs">Reusable code: Blocs<a class="anchor" aria-label="anchor" href="#reusable-code-blocs"></a>
</h2>
<p><em>Preparation.</em>   The baseline data frame we preserved earlier
is the intake for this section.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span></span></code></pre></div>
<p><em>Ever-enrolled.</em>   A summary code chunk for ready reference.
Requires editing of <code>study_programs</code> before reuse with
different programs.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ever-enrolled bloc</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter by program</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">study_programs</span><span class="op">[</span><span class="va">DT</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cip6"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">cip6</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span></code></pre></div>
<p><em>Verify built-in data.</em>   <code>study_ever</code>, included
with midfieldr, contains the case study information developed above.
Here we verify that the two data frames have the same content.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate equivalence</span></span>
<span><span class="fu"><a href="../reference/same_content.html">same_content</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">study_ever</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Different number of rows"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-data.table-reference-semantics" class="csl-entry">
Dowle, M., &amp; Srinivasan, A. (2022). <em><span class="nocase">Reference semantics [data.table]</span></em>. <a href="https://rdatatable.gitlab.io/data.table/articles/datatable-reference-semantics.html" class="external-link">https://rdatatable.gitlab.io/data.table/articles/datatable-reference-semantics.html</a>
</div>
</div>
<style type="text/css">
blockquote {
    padding:     10px 20px;
    margin:      0 0 20px;
    border-left: 0px
}
caption {
    color:       #525252;
    text-align:  left;
    font-weight: normal;
    font-size:   medium;
    line-height: 1.5;
}
</style>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/graphdr" class="external-link">Richard Layton</a>, Russell Long, Matthew Ohland, Marisa Orr, Susan Lord.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
