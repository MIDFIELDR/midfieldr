<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midfieldr">
<title>FYE programs • midfieldr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="../deps/bs3compat-0.2.5.1/tabs.js"></script><script src="../deps/bs3compat-0.2.5.1/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../syntax-highlighting.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="FYE programs">
<meta property="og:description" content="midfieldr">
<meta property="og:image" content="https://midfieldr.github.io/midfieldr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc" data-headroom>
    

      <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a class="navbar-brand mb-0 h1" href="../index.html">midfieldr</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Released version">1.0.0.9018</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3">
<li class="nav-item">
  <a class="nav-link" href="../articles/art-000-getting-started.html">Getting started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-study">Case study</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-study">
    <a class="dropdown-item" href="../articles/art-002-case-study-programs.html">Programs</a>
    <a class="dropdown-item" href="../articles/art-004-case-study-students.html">Students</a>
    <a class="dropdown-item" href="../articles/art-006-case-study-stickiness.html">Stickiness</a>
    <a class="dropdown-item" href="../articles/art-008-case-study-grad-rate.html">Graduation rate</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/art-010-program-codes.html">Program codes and names</a>
    <a class="dropdown-item" href="../articles/art-015-subsetting-midfield-data.html">Subsetting MIDFIELD data</a>
    <a class="dropdown-item" href="../articles/art-020-data-sufficiency.html">Data sufficiency</a>
    <a class="dropdown-item" href="../articles/art-030-timely-completion.html">Timely completion</a>
    <a class="dropdown-item" href="../articles/art-040-fye-programs.html">FYE programs</a>
    <a class="dropdown-item" href="../articles/art-050-multiway-graphs.html">Multiway graphs</a>
    <a class="dropdown-item" href="../articles/art-060-tabulating-data.html">Tabulating data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control mr-sm-2" aria-label="Search" name="search-input" data-search-index="/search.json" id="search-input" placeholder="Search..." autocomplete="off">
</form>

      <ul class="navbar-nav ml-1">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MIDFIELDR/midfieldr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
  </div>
</nav><div class="container template-article">
<script src="art-040-fye-programs_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <img src="../package-logo.png" class="pkg-logo" alt=""><div class="page-header pb-2 mt-4 mb-2 border-bottom toc-ignore">
      <h1 class="display-4" data-toc-skip>FYE programs</h1>
                        <h4 data-toc-skip class="author">Richard Layton</h4>
            
            <h4 data-toc-skip class="date">2021-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MIDFIELDR/midfieldr/blob/master/vignettes/art-040-fye-programs.Rmd" class="external-link"><code>vignettes/art-040-fye-programs.Rmd</code></a></small>
      <div class="d-none name"><code>art-040-fye-programs.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p>Some US institutions have first year engineering (FYE) programs—typically a common first-year curriculum that is a prerequisite for acceptance into a degree-granting engineering major.</p>
<p>For some persistence metrics computed at the program level, FYE programs can be problematic. For example, graduation rate is conventionally defined as the ratio of the number of students who complete their program (in a specified span of years) to the number of students in the entering cohort <span class="citation"><a href="#ref-IPEDS-grad-rate:2016" role="doc-biblioref">[1]</a></span>. FYE students who don’t transition to a particular engineering program are easily overlooked as potential members of that program’s entering cohort—reducing the size of the cohort and artificially increasing the graduation rate.</p>
<p>FYE students have been admitted to Engineering (CIP 14)—their status is neither “undecided” nor “unknown.” We simply don’t know to which degree-granting program they intend to transition.</p>
<p>Therefore, to include FYE students in any persistence metric requiring a degree-granting “starting” program, we have to predict the engineering program the FYE student would have declared had they not been required to enroll in FYE. The vignette describes the prediction process and how the results are used.</p>
<div id="outline" class="section level3">
<h3 class="hasAnchor">
<a href="#outline" class="anchor" aria-hidden="true"></a>Outline</h3>
<p>Two approaches are described in this vignette.</p>
<ul>
<li>Use prepared predictions in <code>fye_start</code>, a built-in data set in midfieldr with predicted starting programs for all FYE students in the midfielddata practice data tables.</li>
<li>Perform your own imputation. Use <code><a href="../reference/condition_fye.html">condition_fye()</a></code> to construct a data frame with appropriate predictor variables formatted such that it can be used as an input argument for the <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code> function in the R package “mice” (multivariate imputation by chained equations).</li>
</ul>
</div>
<div id="this-vignette-uses" class="section level3">
<h3 class="hasAnchor">
<a href="#this-vignette-uses" class="anchor" aria-hidden="true"></a>This vignette uses</h3>
<p>midfieldr functions</p>
<ul>
<li>
<code><a href="../reference/add_race_sex.html">add_race_sex()</a></code><br>
</li>
<li><code><a href="../reference/filter_match.html">filter_match()</a></code></li>
<li><code><a href="../reference/filter_search.html">filter_search()</a></code></li>
<li><code><a href="../reference/condition_fye.html">condition_fye()</a></code></li>
</ul>
<p>packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># packages used</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span>

<span class="co"># only if performing your own imputation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/amices/mice" class="external-link">"mice"</a></span><span class="op">)</span>

<span class="co"># optional code to control data.table printing</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>
  datatable.print.nrows <span class="op">=</span> <span class="fl">10</span>,
  datatable.print.topn <span class="op">=</span> <span class="fl">5</span>,
  datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p>data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load data tables from midfielddata</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="use-prepared-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#use-prepared-predictions" class="anchor" aria-hidden="true"></a>Use prepared predictions</h2>
<p>A set of predicted starting programs for degree-seeking FYE students in midfielddata is provided in the midfieldr data set <code>fye_start</code>. View its help page by running,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="va">fye_start</span></code></pre></div>
<p>Examine the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepared starting programs of FYE students</span>
<span class="va">fye_start</span>
<span class="co">#&gt;              mcid  start</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25783162 140801</span>
<span class="co">#&gt;    2: MID25783166 141001</span>
<span class="co">#&gt;    3: MID25783167 140901</span>
<span class="co">#&gt;    4: MID25783178 140701</span>
<span class="co">#&gt;    5: MID25783197 140701</span>
<span class="co">#&gt;   ---                   </span>
<span class="co">#&gt; 5029: MID26648422 141901</span>
<span class="co">#&gt; 5030: MID26648484 140901</span>
<span class="co">#&gt; 5031: MID26648508 140201</span>
<span class="co">#&gt; 5032: MID26648517 140201</span>
<span class="co">#&gt; 5033: MID26648553 140701</span></code></pre></div>
<div id="example-using-fye_start" class="section level3">
<h3 class="hasAnchor">
<a href="#example-using-fye_start" class="anchor" aria-hidden="true"></a>Example using <code>fye_start</code>
</h3>
<p>To illustrate using these data, let’s suppose that we are trying to determine the number of students in the four majors of our case study (Civil, Electrical, Industrial, and Mechanical Engineering) at the start of their first year, second year, third year, etc. FYE students who transition to these majors would appear in the <code>term</code> data in the second year and beyond, but not in the first year. In this example, therefore, we will focus on determining how to include FYE students in the first-year count.</p>
<p>We use two additional prepared data sets, <code>study_program</code> with the case-study CIP codes and program names, and <code>study_student</code>, all students ever enrolled in these programs. To see their help pages, run</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># case study data sets </span>
<span class="op">?</span> <span class="va">study_program</span>
<span class="op">?</span> <span class="va">study_student</span></code></pre></div>
<p>Examine the two data sets. The student data does not include predicted starting majors for FYE students.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># case study programs</span>
<span class="va">study_program</span>
<span class="co">#&gt;       cip6    program</span>
<span class="co">#&gt;     &lt;char&gt;     &lt;char&gt;</span>
<span class="co">#&gt;  1: 140801      Civil</span>
<span class="co">#&gt;  2: 140802      Civil</span>
<span class="co">#&gt;  3: 140803      Civil</span>
<span class="co">#&gt;  4: 140804      Civil</span>
<span class="co">#&gt;  5: 140805      Civil</span>
<span class="co">#&gt; ---                  </span>
<span class="co">#&gt;  8: 141003 Electrical</span>
<span class="co">#&gt;  9: 141004 Electrical</span>
<span class="co">#&gt; 10: 141099 Electrical</span>
<span class="co">#&gt; 11: 141901 Mechanical</span>
<span class="co">#&gt; 12: 143501 Industrial</span>

<span class="co"># students ever enrolled in the case study programs</span>
<span class="va">study_student</span>
<span class="co">#&gt;              mcid   institution   cip6    program          race    sex</span>
<span class="co">#&gt;            &lt;char&gt;        &lt;char&gt; &lt;char&gt;     &lt;char&gt;        &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25783197 Institution M 140801      Civil         White   Male</span>
<span class="co">#&gt;    2: MID25783441 Institution M 140801      Civil         White   Male</span>
<span class="co">#&gt;    3: MID25783553 Institution M 140801      Civil         White   Male</span>
<span class="co">#&gt;    4: MID25784209 Institution M 140801      Civil International   Male</span>
<span class="co">#&gt;    5: MID25784489 Institution M 140801      Civil         Asian Female</span>
<span class="co">#&gt;   ---                                                                 </span>
<span class="co">#&gt; 8215: MID26692926 Institution L 143501 Industrial         White   Male</span>
<span class="co">#&gt; 8216: MID26693368 Institution L 143501 Industrial         White   Male</span>
<span class="co">#&gt; 8217: MID26695626 Institution L 143501 Industrial         White   Male</span>
<span class="co">#&gt; 8218: MID26696116 Institution L 143501 Industrial         White Female</span>
<span class="co">#&gt; 8219: MID26696429 Institution L 143501 Industrial         White Female</span>
<span class="co">#&gt;       timely_term data_sufficiency</span>
<span class="co">#&gt;            &lt;char&gt;           &lt;lgcl&gt;</span>
<span class="co">#&gt;    1:       19923             TRUE</span>
<span class="co">#&gt;    2:       19973             TRUE</span>
<span class="co">#&gt;    3:       20073             TRUE</span>
<span class="co">#&gt;    4:       20003             TRUE</span>
<span class="co">#&gt;    5:       19943             TRUE</span>
<span class="co">#&gt;   ---                             </span>
<span class="co">#&gt; 8215:       20153             TRUE</span>
<span class="co">#&gt; 8216:       20143             TRUE</span>
<span class="co">#&gt; 8217:       20143             TRUE</span>
<span class="co">#&gt; 8218:       20153             TRUE</span>
<span class="co">#&gt; 8219:       20153             TRUE</span></code></pre></div>
<p>We subset the <code>term</code> table for rows matching these student IDs. By matching IDs, we obtain all terms of all students ever enrolled in these programs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset term table by ID of case study students</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">term</span>,
  match_to <span class="op">=</span> <span class="va">study_student</span>,
  by_col <span class="op">=</span> <span class="st">"mcid"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We set keys to organize the rows in block by ID and ordered terms.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set keys for ordering rows</span>
<span class="va">keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">keys</span><span class="op">)</span>
<span class="va">DT</span>
<span class="co">#&gt;               mcid   term   cip6</span>
<span class="co">#&gt;             &lt;char&gt; &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25783178  19946 140102</span>
<span class="co">#&gt;     2: MID25783178  19951 140102</span>
<span class="co">#&gt;     3: MID25783178  19953 140102</span>
<span class="co">#&gt;     4: MID25783178  19956 140102</span>
<span class="co">#&gt;     5: MID25783178  19961 140102</span>
<span class="co">#&gt;    ---                          </span>
<span class="co">#&gt; 80864: MID26697447  20134 141001</span>
<span class="co">#&gt; 80865: MID26697447  20141 141001</span>
<span class="co">#&gt; 80866: MID26697447  20143 141001</span>
<span class="co">#&gt; 80867: MID26697447  20151 141001</span>
<span class="co">#&gt; 80868: MID26697447  20153 141001</span></code></pre></div>
<p>Now, use the ID key to subset the first row of each student’s block. We now have one row per unique student.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first term of each student</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"mcid"</span><span class="op">]</span>

<span class="co"># keys no longer required</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">DT</span>, <span class="cn">NULL</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">DT</span>
<span class="co">#&gt;              mcid   term   cip6</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25783178  19946 140102</span>
<span class="co">#&gt;    2: MID25783197  19871 140102</span>
<span class="co">#&gt;    3: MID25783388  19871 140102</span>
<span class="co">#&gt;    4: MID25783441  19921 140102</span>
<span class="co">#&gt;    5: MID25783491  19961 140102</span>
<span class="co">#&gt;   ---                          </span>
<span class="co">#&gt; 7680: MID26696958  20111 141901</span>
<span class="co">#&gt; 7681: MID26696967  20101 141901</span>
<span class="co">#&gt; 7682: MID26697163  20101 140101</span>
<span class="co">#&gt; 7683: MID26697444  20101 141901</span>
<span class="co">#&gt; 7684: MID26697447  20111 140701</span></code></pre></div>
<p>These data are subset again by matching program codes to those in <code>study_program</code>, thereby omitting students who were not enrolled in one of the four programs in their first term.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter for case study programs only</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">DT</span>,
  match_to <span class="op">=</span> <span class="va">study_program</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># ensure rows are unique</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">DT</span>
<span class="co">#&gt;              mcid   cip6</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25787414 140801</span>
<span class="co">#&gt;    2: MID25794372 140801</span>
<span class="co">#&gt;    3: MID25796088 140801</span>
<span class="co">#&gt;    4: MID25801036 140801</span>
<span class="co">#&gt;    5: MID25801582 140801</span>
<span class="co">#&gt;   ---                   </span>
<span class="co">#&gt; 3895: MID26687969 143501</span>
<span class="co">#&gt; 3896: MID26690944 143501</span>
<span class="co">#&gt; 3897: MID26692128 143501</span>
<span class="co">#&gt; 3898: MID26692594 143501</span>
<span class="co">#&gt; 3899: MID26696429 143501</span></code></pre></div>
<p>Before adding the FYE students, we can group and summarize for comparison later.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize by CIP code</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"cip6"</span><span class="op">]</span>

<span class="co"># join program names</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT_no_fye</span>, <span class="va">study_program</span>, by <span class="op">=</span> <span class="st">"cip6"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># order columns and rows for display</span>
<span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"program"</span>, <span class="st">"N"</span><span class="op">)</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="va">DT_no_fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span>, <span class="va">..cols_we_want</span><span class="op">]</span>
<span class="va">DT_no_fye</span>
<span class="co">#&gt;       program     N</span>
<span class="co">#&gt;        &lt;char&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1: Electrical  1422</span>
<span class="co">#&gt; 2: Mechanical  1350</span>
<span class="co">#&gt; 3:      Civil   807</span>
<span class="co">#&gt; 4: Industrial   320</span></code></pre></div>
<p>Now, turn to the FYE students. We subset <code>fye_start</code> for our four programs. Before using <code><a href="../reference/filter_match.html">filter_match()</a></code>, we change name of the key column from <code>start</code> to <code>cip6</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset predicted FYE start programs</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">fye_start</span>, old <span class="op">=</span> <span class="st">"start"</span>, new <span class="op">=</span> <span class="st">"cip6"</span><span class="op">)</span>
<span class="va">study_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">fye_start</span>,
  match_to <span class="op">=</span> <span class="va">study_program</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">study_fye</span>
<span class="co">#&gt;              mcid   cip6</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25783162 140801</span>
<span class="co">#&gt;    2: MID25783441 140801</span>
<span class="co">#&gt;    3: MID25783553 140801</span>
<span class="co">#&gt;    4: MID25783648 140801</span>
<span class="co">#&gt;    5: MID25783753 140801</span>
<span class="co">#&gt;   ---                   </span>
<span class="co">#&gt; 3109: MID26641136 143501</span>
<span class="co">#&gt; 3110: MID26641265 143501</span>
<span class="co">#&gt; 3111: MID26642173 143501</span>
<span class="co">#&gt; 3112: MID26642851 143501</span>
<span class="co">#&gt; 3113: MID26643299 143501</span></code></pre></div>
<p>Bind the two data frames.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine the two data frames</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">study_fye</span><span class="op">)</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">DT</span>
<span class="co">#&gt;              mcid   cip6</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25787414 140801</span>
<span class="co">#&gt;    2: MID25794372 140801</span>
<span class="co">#&gt;    3: MID25796088 140801</span>
<span class="co">#&gt;    4: MID25801036 140801</span>
<span class="co">#&gt;    5: MID25801582 140801</span>
<span class="co">#&gt;   ---                   </span>
<span class="co">#&gt; 7008: MID26641136 143501</span>
<span class="co">#&gt; 7009: MID26641265 143501</span>
<span class="co">#&gt; 7010: MID26642173 143501</span>
<span class="co">#&gt; 7011: MID26642851 143501</span>
<span class="co">#&gt; 7012: MID26643299 143501</span>

<span class="co"># check that the IDs are unique</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span>, <span class="va">mcid</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 7012</span></code></pre></div>
<p>Now we can group by CIP and count.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># group and summarize with FYE included</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"cip6"</span><span class="op">]</span>

<span class="co"># examine the result</span>
<span class="va">DT_with_fye</span>
<span class="co">#&gt;      cip6     N</span>
<span class="co">#&gt;    &lt;char&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1: 140801  1598</span>
<span class="co">#&gt; 2: 141001  2081</span>
<span class="co">#&gt; 3: 141901  2631</span>
<span class="co">#&gt; 4: 143501   702</span></code></pre></div>
<p>Adding program names from <code>study_program</code> is helpful in interpreting the results.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># join program names</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT_with_fye</span>, <span class="va">study_program</span>, by <span class="op">=</span> <span class="st">"cip6"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># order columns and rows for display</span>
<span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"program"</span>, <span class="st">"N"</span><span class="op">)</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="va">DT_with_fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span>, <span class="va">..cols_we_want</span><span class="op">]</span>

<span class="co"># examine the result</span>
<span class="va">DT_with_fye</span>
<span class="co">#&gt;       program     N</span>
<span class="co">#&gt;        &lt;char&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1: Mechanical  2631</span>
<span class="co">#&gt; 2: Electrical  2081</span>
<span class="co">#&gt; 3:      Civil  1598</span>
<span class="co">#&gt; 4: Industrial   702</span></code></pre></div>
<p>Compare to the earlier results, summarized without FYE students,</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># earlier summary for comparison</span>
<span class="va">DT_no_fye</span>
<span class="co">#&gt;       program     N</span>
<span class="co">#&gt;        &lt;char&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1: Electrical  1422</span>
<span class="co">#&gt; 2: Mechanical  1350</span>
<span class="co">#&gt; 3:      Civil   807</span>
<span class="co">#&gt; 4: Industrial   320</span></code></pre></div>
<p>Of course, because of the imputation, the counts are estimates. However, had we ignored the FYE students, the starting term counts in all programs would have been artificially low—leading to unreliable comparisons to totals for the subsequent years.</p>
</div>
</div>
<div id="perform-your-own-imputation-optional" class="section level2">
<h2 class="hasAnchor">
<a href="#perform-your-own-imputation-optional" class="anchor" aria-hidden="true"></a>Perform your own imputation (optional)</h2>
<div id="using-condition_fye" class="section level3">
<h3 class="hasAnchor">
<a href="#using-condition_fye" class="anchor" aria-hidden="true"></a>Using <code>condition_fye()</code>
</h3>
<p>This section shows the details of preparing the data for imputation and using the mice package to perform an imputation. This procedure results in the prepared <code>fye_start</code> data set we used above.</p>
<p>The main preparation work is done by <code><a href="../reference/condition_fye.html">condition_fye()</a></code>. View its help page by running</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="fu"><a href="../reference/condition_fye.html">condition_fye</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The first argument of <code><a href="../reference/condition_fye.html">condition_fye()</a></code> is the data frame of all available degree-seeking engineering students, with required variables student ID, race, and sex. Regardless of what programs we happen to be studying, if we impute starting majors for FYE students, we include all engineering programs at this point.</p>
<p>To collect these students, we start by obtaining all CIP codes that start with “14” (Engineering).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get engineering CIP codes</span>
<span class="va">engr_cip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_search.html">filter_search</a></span><span class="op">(</span><span class="va">cip</span>, keep_text <span class="op">=</span> <span class="st">"^14"</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">engr_cip</span>
<span class="co">#&gt;       cip2    cip2name   cip4</span>
<span class="co">#&gt;     &lt;char&gt;      &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;  1:     14 Engineering   1401</span>
<span class="co">#&gt;  2:     14 Engineering   1401</span>
<span class="co">#&gt;  3:     14 Engineering   1402</span>
<span class="co">#&gt;  4:     14 Engineering   1403</span>
<span class="co">#&gt;  5:     14 Engineering   1404</span>
<span class="co">#&gt; ---                          </span>
<span class="co">#&gt; 50:     14 Engineering   1442</span>
<span class="co">#&gt; 51:     14 Engineering   1443</span>
<span class="co">#&gt; 52:     14 Engineering   1444</span>
<span class="co">#&gt; 53:     14 Engineering   1445</span>
<span class="co">#&gt; 54:     14 Engineering   1499</span>
<span class="co">#&gt;                                                    cip4name   cip6</span>
<span class="co">#&gt;                                                      &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;  1:                                    Engineering, General 140101</span>
<span class="co">#&gt;  2:                                    Engineering, General 140102</span>
<span class="co">#&gt;  3:   Aerospace, Aeronautical and Astronautical Engineering 140201</span>
<span class="co">#&gt;  4: Agricultural, Biological Engineering and Bioengineering 140301</span>
<span class="co">#&gt;  5:                               Architectural Engineering 140401</span>
<span class="co">#&gt; ---                                                               </span>
<span class="co">#&gt; 50:       Mechatronics, Robotics and Automation Engineering 144201</span>
<span class="co">#&gt; 51:                                 Biochemical Engineering 144301</span>
<span class="co">#&gt; 52:                                   Engineering Chemistry 144401</span>
<span class="co">#&gt; 53:                      Biological, Biosystems Engineering 144501</span>
<span class="co">#&gt; 54:                                      Engineering, Other 149999</span>
<span class="co">#&gt;                                                         cip6name</span>
<span class="co">#&gt;                                                           &lt;char&gt;</span>
<span class="co">#&gt;  1:                                         Engineering, General</span>
<span class="co">#&gt;  2:                                              Pre-Engineering</span>
<span class="co">#&gt;  3: Aerospace, Aeronautical and Astronautical, Space Engineering</span>
<span class="co">#&gt;  4:      Agricultural, Biological Engineering and Bioengineering</span>
<span class="co">#&gt;  5:                                    Architectural Engineering</span>
<span class="co">#&gt; ---                                                             </span>
<span class="co">#&gt; 50:            Mechatronics, Robotics and Automation Engineering</span>
<span class="co">#&gt; 51:                                      Biochemical Engineering</span>
<span class="co">#&gt; 52:                                        Engineering Chemistry</span>
<span class="co">#&gt; 53:                           Biological, Biosystems Engineering</span>
<span class="co">#&gt; 54:                                           Engineering, Other</span></code></pre></div>
<p>To obtain the IDs of all students ever enrolled in these programs, we access the <code>term</code> table.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get IDs of all engineering students in all terms</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">term</span>,
  match_to <span class="op">=</span> <span class="va">engr_cip</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="st">"mcid"</span>
<span class="op">)</span>

<span class="co"># all terms, so there will be duplictae IDs</span>
<span class="va">engr</span>
<span class="co">#&gt;                mcid</span>
<span class="co">#&gt;              &lt;char&gt;</span>
<span class="co">#&gt;      1: MID25853474</span>
<span class="co">#&gt;      2: MID25853474</span>
<span class="co">#&gt;      3: MID25864225</span>
<span class="co">#&gt;      4: MID25864225</span>
<span class="co">#&gt;      5: MID25864273</span>
<span class="co">#&gt;     ---            </span>
<span class="co">#&gt; 129718: MID26529140</span>
<span class="co">#&gt; 129719: MID26529140</span>
<span class="co">#&gt; 129720: MID26544796</span>
<span class="co">#&gt; 129721: MID26544796</span>
<span class="co">#&gt; 129722: MID26550059</span>

<span class="co"># omit duplicate rows</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">engr</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">engr</span>
<span class="co">#&gt;               mcid</span>
<span class="co">#&gt;             &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25853474</span>
<span class="co">#&gt;     2: MID25864225</span>
<span class="co">#&gt;     3: MID25864273</span>
<span class="co">#&gt;     4: MID25864554</span>
<span class="co">#&gt;     5: MID25864996</span>
<span class="co">#&gt;    ---            </span>
<span class="co">#&gt; 19032: MID26346976</span>
<span class="co">#&gt; 19033: MID26355610</span>
<span class="co">#&gt; 19034: MID26529140</span>
<span class="co">#&gt; 19035: MID26544796</span>
<span class="co">#&gt; 19036: MID26550059</span></code></pre></div>
<p>The students must all be degree-seeking, we want to subset rows of <code>engr</code> to keep values of <code>mcid</code> that match values of <code>mcid</code> in the <code>student</code> data table. We use <code><a href="../reference/filter_match.html">filter_match()</a></code> again. In this case, there is no change to the data frame because all students were degree-seeking.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># limit the population to degree-seeking students</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">engr</span>,
  match_to <span class="op">=</span> <span class="va">student</span>,
  by_col <span class="op">=</span> <span class="st">"mcid"</span>
<span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">engr</span>
<span class="co">#&gt;               mcid</span>
<span class="co">#&gt;             &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25783162</span>
<span class="co">#&gt;     2: MID25783166</span>
<span class="co">#&gt;     3: MID25783167</span>
<span class="co">#&gt;     4: MID25783178</span>
<span class="co">#&gt;     5: MID25783197</span>
<span class="co">#&gt;    ---            </span>
<span class="co">#&gt; 19032: MID26697295</span>
<span class="co">#&gt; 19033: MID26697298</span>
<span class="co">#&gt; 19034: MID26697367</span>
<span class="co">#&gt; 19035: MID26697444</span>
<span class="co">#&gt; 19036: MID26697447</span></code></pre></div>
<p>Lastly, we add demographic information with <code><a href="../reference/add_race_sex.html">add_race_sex()</a></code>. View its help page by running</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="va">add_race_sex</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add race and sex variables</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_race_sex.html">add_race_sex</a></span><span class="op">(</span><span class="va">engr</span>, midfield_student <span class="op">=</span> <span class="va">student</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">engr</span>
<span class="co">#&gt;               mcid            race    sex</span>
<span class="co">#&gt;             &lt;char&gt;          &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25783162           White   Male</span>
<span class="co">#&gt;     2: MID25783166           White   Male</span>
<span class="co">#&gt;     3: MID25783167           White   Male</span>
<span class="co">#&gt;     4: MID25783178           Black   Male</span>
<span class="co">#&gt;     5: MID25783197           White   Male</span>
<span class="co">#&gt;    ---                                   </span>
<span class="co">#&gt; 19032: MID26697295           White   Male</span>
<span class="co">#&gt; 19033: MID26697298           Asian   Male</span>
<span class="co">#&gt; 19034: MID26697367 Hispanic/Latinx   Male</span>
<span class="co">#&gt; 19035: MID26697444           White   Male</span>
<span class="co">#&gt; 19036: MID26697447           Asian   Male</span></code></pre></div>
<p>Next we use the <code>engr</code> data frame as the first argument of the <code><a href="../reference/condition_fye.html">condition_fye()</a></code> function. The second argument is the <code>term</code> data table from midfielddata (or equivalent). The third argument <code>fye_codes</code> is optional because it has a default assignment (“140102”).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set up a data frame for imputation</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condition_fye.html">condition_fye</a></span><span class="op">(</span><span class="va">engr</span>, midfield_term <span class="op">=</span> <span class="va">term</span><span class="op">)</span>

<span class="co"># view the result</span>
<span class="va">fye</span>
<span class="co">#&gt;              mcid   institution            race    sex   cip6</span>
<span class="co">#&gt;            &lt;char&gt;        &lt;fctr&gt;          &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;</span>
<span class="co">#&gt;    1: MID26060301 Institution C           Asian Female   &lt;NA&gt;</span>
<span class="co">#&gt;    2: MID25995980 Institution C Hispanic/Latinx Female   &lt;NA&gt;</span>
<span class="co">#&gt;    3: MID25997636 Institution C Hispanic/Latinx Female   &lt;NA&gt;</span>
<span class="co">#&gt;    4: MID26086310 Institution C Hispanic/Latinx Female   &lt;NA&gt;</span>
<span class="co">#&gt;    5: MID26000057 Institution C           White Female   &lt;NA&gt;</span>
<span class="co">#&gt;   ---                                                        </span>
<span class="co">#&gt; 5029: MID25846316 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5030: MID25847220 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5031: MID25848589 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5032: MID25852023 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5033: MID25828870 Institution M           White   Male 149999</span></code></pre></div>
<p>Of all the engineering students, 5033 were enrolled in an FYE program at least once. Of the FYE students, an NA in the <code>cip6</code> column indicates students for whom we have to impute a starting major. The number of NAs in the CIP code column can be found using <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># number of NA values in cip6 column</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fye</span><span class="op">[</span>, <span class="va">cip6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 1931</span></code></pre></div>
<p>Thus we have 1931 starting programs to impute. (This works because in applying <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> to a logical vector, R coerces the TRUE/FALSE values to numerical values 1 and 0.)</p>
</div>
<div id="using-the-mice-package" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-mice-package" class="anchor" aria-hidden="true"></a>Using the mice package</h3>
<p>The mice package <span class="citation"><a href="#ref-vanbuuren2011" role="doc-biblioref">[2]</a></span> implements multivariate imputation by chained equations (MICE). MICE is also known as “fully conditional specification” or “sequential regression multiple imputation” and is suitable for categorical variables such as ours <span class="citation"><a href="#ref-azur2011" role="doc-biblioref">[3]</a></span>. Our computational procedure follows the approach suggested by Dhana <span class="citation"><a href="#ref-dhana2017" role="doc-biblioref">[4]</a></span>.</p>
<p>The procedure assumes the missing CIP data—the NA values in the prepared data frame—are “missing at random” (MAR), that is, independent of the variables used to impute the missing values. This is the rationale for using data only from FYE institutions to impute the missing values—the existence of the missing data does depend on the institution type, FYE or non-FYE. Within the FYE data itself, however, we assume that the imputed starting majors are missing at random.</p>
<p>Our first use of mice is to examine the framework by calling the function with zero iterations on the <code>fye</code> data frame. (A warning may appear in your console. It can be ignored.)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># imputation</span>
<span class="va">framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># examine the results</span>
<span class="va">framework</span>
<span class="co">#&gt; Class: mids</span>
<span class="co">#&gt; Number of multiple imputations:  5 </span>
<span class="co">#&gt; Imputation methods:</span>
<span class="co">#&gt;        mcid institution        race         sex        cip6 </span>
<span class="co">#&gt;          ""          ""          ""          ""   "polyreg" </span>
<span class="co">#&gt; PredictorMatrix:</span>
<span class="co">#&gt;             mcid institution race sex cip6</span>
<span class="co">#&gt; mcid           0           1    1   1    1</span>
<span class="co">#&gt; institution    0           0    1   1    1</span>
<span class="co">#&gt; race           0           1    0   1    1</span>
<span class="co">#&gt; sex            0           1    1   0    1</span>
<span class="co">#&gt; cip6           0           1    1   1    0</span>
<span class="co">#&gt; Number of logged events:  1 </span>
<span class="co">#&gt;   it im dep     meth  out</span>
<span class="co">#&gt; 1  0  0     constant mcid</span></code></pre></div>
<p>We look more closely at two elements of this framework. The first is the imputation method and to which variables the method is applied.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span>
<span class="va">method</span>
<span class="co">#&gt;        mcid institution        race         sex        cip6 </span>
<span class="co">#&gt;          ""          ""          ""          ""   "polyreg"</span></code></pre></div>
<p>In our case, this is correct. The “polyreg” imputation method (polytomous logistic regression) is appropriate for data comprised of unordered categorical variables. Had the method not been correctly assigned, we would assign it as follows,</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># variable(s) being imputed</span>
<span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cip6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"polyreg"</span>

<span class="co"># variable(s) not being imputed</span>
<span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span>

<span class="co"># examine the result</span>
<span class="va">method</span>
<span class="co">#&gt;        mcid institution        race         sex        cip6 </span>
<span class="co">#&gt;          ""          ""          ""          ""   "polyreg"</span></code></pre></div>
<p>The second element to review is the predictor matrix.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span>
<span class="va">predictors</span>
<span class="co">#&gt;             mcid institution race sex cip6</span>
<span class="co">#&gt; mcid           0           1    1   1    1</span>
<span class="co">#&gt; institution    0           0    1   1    1</span>
<span class="co">#&gt; race           0           1    0   1    1</span>
<span class="co">#&gt; sex            0           1    1   0    1</span>
<span class="co">#&gt; cip6           0           1    1   1    0</span></code></pre></div>
<p>Each row in predictor matrix identifies the predictors that would be used to predict the variable in the row name—but only for those variables with a prediction method assigned above. Since the only variable being predicted is <code>cip6</code>, we really only have to examine the last row in the matrix,</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictors</span><span class="op">[</span><span class="st">"cip6"</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>
<span class="co">#&gt;      mcid institution race sex cip6</span>
<span class="co">#&gt; cip6    0           1    1   1    0</span></code></pre></div>
<p>What the zeros and ones tell us is that <code>cip6</code> is going to be predicted by institution, race, and sex (and not mcid). This is correct.</p>
<p>Had the default setting been incorrect, we can set them manually</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set individual columns of the predictor matrix</span>
<span class="va">predictors</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co"># we need a one only in the last row for these three predictors</span>
<span class="va">predictors</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">predictors</span>
<span class="co">#&gt;             mcid institution race sex cip6</span>
<span class="co">#&gt; mcid           0           0    0   0    0</span>
<span class="co">#&gt; institution    0           0    0   0    0</span>
<span class="co">#&gt; race           0           0    0   0    0</span>
<span class="co">#&gt; sex            0           0    0   0    0</span>
<span class="co">#&gt; cip6           0           1    1   1    0</span></code></pre></div>
<p>We are ready for imputation. The default <code>seed</code> argument is NULL, but by setting the seed as shown the vignette results are reproducible. Setting <code>printFlag = TRUE</code> displays progress in the console.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># imputation</span>
<span class="va">fye_mids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">fye</span>,
  method <span class="op">=</span> <span class="va">method</span>,
  predictorMatrix <span class="op">=</span> <span class="va">predictors</span>,
  seed <span class="op">=</span> <span class="fl">20180624</span>,
  printFlag <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># output in console with printFlag = TRUE</span>
<span class="co"># &gt;  iter imp variable</span>
<span class="co"># &gt;   1   1  cip6</span>
<span class="co"># &gt;   1   2  cip6</span>
<span class="co"># &gt;   1   3  cip6</span>
<span class="co"># &gt;   1   4  cip6</span>
<span class="co"># &gt;   1   5  cip6</span>
<span class="co"># &gt;   ---</span>
<span class="co"># &gt;   5   1  cip6</span>
<span class="co"># &gt;   5   2  cip6</span>
<span class="co"># &gt;   5   3  cip6</span>
<span class="co"># &gt;   5   4  cip6</span>
<span class="co"># &gt;   5   5  cip6</span></code></pre></div>
<p><code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code> produces what it calls a <code>mids</code> object: a “multiply-imputed data set.” The <code><a href="https://amices.org/mice/reference/complete.mids.html" class="external-link">complete()</a></code> function extracts the completed data frame from the <code>mids</code> object, which we convert to a data.table.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/complete.mids.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">fye_mids</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span>

<span class="co"># examine the result</span>
<span class="va">fye</span>
<span class="co">#&gt;              mcid   institution            race    sex   cip6</span>
<span class="co">#&gt;            &lt;char&gt;        &lt;fctr&gt;          &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;</span>
<span class="co">#&gt;    1: MID26060301 Institution C           Asian Female 140801</span>
<span class="co">#&gt;    2: MID25995980 Institution C Hispanic/Latinx Female 141901</span>
<span class="co">#&gt;    3: MID25997636 Institution C Hispanic/Latinx Female 140701</span>
<span class="co">#&gt;    4: MID26086310 Institution C Hispanic/Latinx Female 141901</span>
<span class="co">#&gt;    5: MID26000057 Institution C           White Female 140701</span>
<span class="co">#&gt;   ---                                                        </span>
<span class="co">#&gt; 5029: MID25846316 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5030: MID25847220 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5031: MID25848589 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5032: MID25852023 Institution M           White   Male 143501</span>
<span class="co">#&gt; 5033: MID25828870 Institution M           White   Male 149999</span></code></pre></div>
<p>To use the result, we only need two columns, the predicted starting program keyed by ID.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span>, <span class="va">..cols_we_want</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span>
<span class="co">#&gt; Classes 'data.table' and 'data.frame':   5033 obs. of  2 variables:</span>
<span class="co">#&gt;  $ mcid: chr  "MID26060301" "MID25995980" "MID25997636" "MID26086310" ...</span>
<span class="co">#&gt;  $ cip6: Factor w/ 17 levels "140201","140301",..: 6 13 5 13 5 5 6 5 3 13 ...</span>
<span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></code></pre></div>
<p>The program codes are still factors. We change them back to characters.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fye</span><span class="op">[</span>, <span class="va">cip6</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cip6</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span>
<span class="co">#&gt; Classes 'data.table' and 'data.frame':   5033 obs. of  2 variables:</span>
<span class="co">#&gt;  $ mcid: chr  "MID26060301" "MID25995980" "MID25997636" "MID26086310" ...</span>
<span class="co">#&gt;  $ cip6: chr  "140801" "141901" "140701" "141901" ...</span>
<span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></code></pre></div>
<p>Because the program codes in this data frame are predicted, we change the variable name to <code>start</code> to distinguish it from other <code>cip6</code> variables in the data tables.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">fye</span>, old <span class="op">=</span> <span class="st">"cip6"</span>, new <span class="op">=</span> <span class="st">"start"</span><span class="op">)</span>
<span class="va">fye</span>
<span class="co">#&gt;              mcid  start</span>
<span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;    1: MID25783162 140801</span>
<span class="co">#&gt;    2: MID25783166 141001</span>
<span class="co">#&gt;    3: MID25783167 140901</span>
<span class="co">#&gt;    4: MID25783178 140701</span>
<span class="co">#&gt;    5: MID25783197 140701</span>
<span class="co">#&gt;   ---                   </span>
<span class="co">#&gt; 5029: MID26648422 141901</span>
<span class="co">#&gt; 5030: MID26648484 140901</span>
<span class="co">#&gt; 5031: MID26648508 140201</span>
<span class="co">#&gt; 5032: MID26648517 140201</span>
<span class="co">#&gt; 5033: MID26648553 140701</span></code></pre></div>
<p>This process is how the built-in data set <code>fye_start</code> was constructed, using the same random number seed that we used above. To confirm they are identical,</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">fye</span>, <span class="va">fye_start</span><span class="op">)</span>
<span class="co">#&gt; [1] "Different column names"</span></code></pre></div>
<p>Lastly, because the mice package masks the base R <code><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind()</a></code> and <code><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind()</a></code> functions, we use the following to unload the package once we’re done with it.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/detach.html" class="external-link">detach</a></span><span class="op">(</span><span class="st">"package:mice"</span>, unload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h2>
<div id="refs" class="references csl-bib-body references csl-bib-body">
<div id="ref-IPEDS-grad-rate:2016" class="csl-entry">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">NCES-IPEDS, <em><span class="nocase">Graduation Rates, Publication number 2017046</span></em>. <span>National Center for Education Statistics</span>; [Online; accessed 2021-06-06], 2016 [Online]. Available: <a href="https://nces.ed.gov/pubs2017/2017046.pdf" class="external-link">https://nces.ed.gov/pubs2017/2017046.pdf</a>
</div>
</div>
<div id="ref-vanbuuren2011" class="csl-entry">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">S. van Buuren and K. Groothuis-Oudshoorn, <span>“<span class="nocase">mice</span>: Multivariate imputation by chained equations in r,”</span> <em>Journal of Statistical Software</em>, vol. 45, no. 3, pp. 1–67, 2011 [Online]. Available: <a href="https://www.jstatsoft.org/v45/i03/" class="external-link">https://www.jstatsoft.org/v45/i03/</a>
</div>
</div>
<div id="ref-azur2011" class="csl-entry">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">M. J. Azur, E. A. Stuart, C. Frangakis, and P. J. Leaf, <span>“Multiple imputation by chained equations: <span>W</span>hat is it and how does it work?”</span> <em>International Journal of Methods in Psychiatric Research</em>, vol. 20, no. 1, pp. 40–49, 2011. </div>
</div>
<div id="ref-dhana2017" class="csl-entry">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">K. Dhana, <span>“Handling missing data with <span>MICE</span> package: A simple approach.”</span> <a href="https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/" class="external-link">https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/</a>, 2017. </div>
</div>
</div>
</div>
<div id="appendix" class="section level2">
<h2 class="hasAnchor">
<a href="#appendix" class="anchor" aria-hidden="true"></a>Appendix</h2>
<p>The vignette code chunks are collected below in a single, condensed script.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># packages used</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/amices/mice" class="external-link">"mice"</a></span><span class="op">)</span>

<span class="co"># prepared predictions</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">term</span>,
  match_to <span class="op">=</span> <span class="va">study_student</span>,
  by_col <span class="op">=</span> <span class="st">"mcid"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">keys</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"mcid"</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">DT</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">DT</span>,
  match_to <span class="op">=</span> <span class="va">study_program</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>

<span class="co"># summarize for later</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"cip6"</span><span class="op">]</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT_no_fye</span>, <span class="va">study_program</span>, by <span class="op">=</span> <span class="st">"cip6"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"program"</span>, <span class="st">"N"</span><span class="op">)</span>
<span class="va">DT_no_fye</span> <span class="op">&lt;-</span> <span class="va">DT_no_fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span>, <span class="va">..cols_we_want</span><span class="op">]</span>

<span class="co"># subset predicted FYE start programs</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">fye_start</span>, old <span class="op">=</span> <span class="st">"start"</span>, new <span class="op">=</span> <span class="st">"cip6"</span><span class="op">)</span>
<span class="va">study_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">fye_start</span>,
  match_to <span class="op">=</span> <span class="va">study_program</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">study_fye</span><span class="op">)</span><span class="op">)</span>

<span class="co"># group and summarize with FYE included</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"cip6"</span><span class="op">]</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT_with_fye</span>, <span class="va">study_program</span>, by <span class="op">=</span> <span class="st">"cip6"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"program"</span>, <span class="st">"N"</span><span class="op">)</span>
<span class="va">DT_with_fye</span> <span class="op">&lt;-</span> <span class="va">DT_with_fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span>, <span class="va">..cols_we_want</span><span class="op">]</span>

<span class="co"># perform your own prediction</span>
<span class="va">engr_cip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_search.html">filter_search</a></span><span class="op">(</span><span class="va">cip</span>, keep_text <span class="op">=</span> <span class="st">"^14"</span><span class="op">)</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">term</span>,
  match_to <span class="op">=</span> <span class="va">engr_cip</span>,
  by_col <span class="op">=</span> <span class="st">"cip6"</span>,
  select <span class="op">=</span> <span class="st">"mcid"</span>
<span class="op">)</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">engr</span><span class="op">)</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_match.html">filter_match</a></span><span class="op">(</span><span class="va">engr</span>,
  match_to <span class="op">=</span> <span class="va">student</span>,
  by_col <span class="op">=</span> <span class="st">"mcid"</span>
<span class="op">)</span>
<span class="va">engr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_race_sex.html">add_race_sex</a></span><span class="op">(</span><span class="va">engr</span>, midfield_student <span class="op">=</span> <span class="va">student</span><span class="op">)</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condition_fye.html">condition_fye</a></span><span class="op">(</span><span class="va">engr</span>, midfield_term <span class="op">=</span> <span class="va">term</span><span class="op">)</span>

<span class="co"># mice</span>
<span class="va">framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">method</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span>
<span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cip6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"polyreg"</span>
<span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span>
<span class="va">predictors</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span>
<span class="va">predictors</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">predictors</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">fye_mids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">fye</span>,
  method <span class="op">=</span> <span class="va">method</span>,
  predictorMatrix <span class="op">=</span> <span class="va">predictors</span>,
  seed <span class="op">=</span> <span class="fl">20180624</span>,
  printFlag <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/complete.mids.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">fye_mids</span><span class="op">)</span>

<span class="co"># prepare for use</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span>
<span class="va">cols_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"cip6"</span><span class="op">)</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span>, <span class="va">..cols_we_want</span><span class="op">]</span>
<span class="va">fye</span><span class="op">[</span>, <span class="va">cip6</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cip6</span><span class="op">)</span><span class="op">]</span>
<span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">fye</span>, old <span class="op">=</span> <span class="st">"cip6"</span>, new <span class="op">=</span> <span class="st">"start"</span><span class="op">)</span>

<span class="co"># reinitialize random number seed</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></code></pre></div>
</div>
  </div>
 <div class="col-md-3 d-none d-md-block" id="pkgdown-sidebar">
        <div class="sticky-top">
    <nav id="toc"><h2 data-toc-skip>Contents</h2>

    </nav>
</div>
      </div>

</div>



      <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/graphdr" class="external-link external-link">Richard Layton</a>, Russell Long, Matthew Ohland, US National Science Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  

  

  </body>
</html>
