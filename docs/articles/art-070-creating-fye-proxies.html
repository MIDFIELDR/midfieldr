<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midfieldr">
<title>Creating FYE proxies • midfieldr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating FYE proxies">
<meta property="og:description" content="midfieldr">
<meta property="og:image" content="https://midfieldr.github.io/midfieldr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">midfieldr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9026</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/art-000-getting-started.html">Getting started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-study">Case study</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-study">
    <a class="dropdown-item" href="../articles/art-001-case-goals.html">Goals</a>
    <a class="dropdown-item" href="../articles/art-002-case-data.html">Data</a>
    <a class="dropdown-item" href="../articles/art-003-case-results.html">Results</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/art-010-data-sufficiency.html">Data sufficiency</a>
    <a class="dropdown-item" href="../articles/art-020-degree-seeking.html">Degree seeking (inner joins)</a>
    <a class="dropdown-item" href="../articles/art-030-programs.html">Programs</a>
    <a class="dropdown-item" href="../articles/art-040-completion.html">Completion status</a>
    <a class="dropdown-item" href="../articles/art-050-demographics.html">Demographics (left outer joins)</a>
    <a class="dropdown-item" href="../articles/art-060-multiway.html">Multiway data and charts</a>
    <a class="dropdown-item" href="../articles/art-070-creating-fye-proxies.html">Creating FYE proxies</a>
    <a class="dropdown-item" href="../articles/art-071-using-fye-proxies.html">Using FYE proxies</a>
    <a class="dropdown-item" href="../articles/art-080-grad-rate.html">Graduation rate</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MIDFIELDR/midfieldr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Creating FYE proxies</h1>
            
            <h4 data-toc-skip class="date">2022-10-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MIDFIELDR/midfieldr/blob/HEAD/vignettes/art-070-creating-fye-proxies.Rmd" class="external-link"><code>vignettes/art-070-creating-fye-proxies.Rmd</code></a></small>
      <div class="d-none name"><code>art-070-creating-fye-proxies.Rmd</code></div>
    </div>

    
    
<p>Part 1 of 2 parts illustrating how we work with First-Year
Engineering (FYE) programs when a count of “starters” is needed.</p>
<ol style="list-style-type: decimal">
<li><p>Creating FYE proxies (this page). Estimating the 6-digit CIP
codes of the degree-granting engineering programs that FYE students
would have declared in their first term had they not been required to
enroll in FYE</p></li>
<li><p><a href="art-071-using-fye-proxies.html">Using FYE proxies</a>.
Incorporating a set of prepared FYE proxies with other first-term CIP
codes when a count of starters in degree-granting engineering programs
is required.</p></li>
</ol>
<div class="section level2">
<h2 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h2>
<p>At some US institutions, engineering students are required to
complete a First-Year Engineering (FYE) program as a prerequisite for
declaring an engineering major. Administratively, degree-granting
engineering programs such as Electrical Engineering or Mechanical
Engineering treat their incoming post-FYE students as their “starting”
cohorts. However, when computing a metric that requires a count of
starters—graduation rate, for example—FYE records must be treated with
special care to avoid a miscount.</p>
<p>To illustrate the potential for miscounting starters, suppose we wish
to calculate a Mechanical Engineering (ME) graduation rate. Students
starting in ME constitute the starting pool and the fraction of that
pool graduating in ME is the graduation rate.</p>
<p>At FYE institutions, an ME program would typically define their
starting pool as the post-FYE cohort entering their program. This may be
the best information available, but it invariably undercounts starters
by failing to account for FYE students who do not transition (post-FYE)
to degree-granting engineering programs—students who may have left the
institution or switched to non-engineering majors. In the absence of the
FYE requirement some of these students would have been ME starters. By
neglecting these students, the count of ME starters is artificially low
resulting in an ME graduation rate that is artificially high. The same
is true for every degree-granting engineering discipline in an FYE
institution.</p>
<p>Because of the special nature of FYE programs, we cannot address
starter miscounts by grouping FYE students with those admitted with
“undecided” or “unknown” CIP codes—FYE students are neither. They were
admitted as Engineering majors (2-digit CIP 14). We simply don’t know to
which degree-granting program (6-digit CIP) they intended to
transition.</p>
<p>Therefore, to avoid miscounting starters at FYE institutions, we have
to estimate the 6-digit CIP codes of the degree-granting engineering
programs that FYE students would have declared had they not been
required to enroll in FYE.</p>
</div>
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<dl>
<dt>FYE</dt>
<dd>
<p>First-Year Engineering program, a common-first-year curriculum that
is a prerequisite for declaring an engineering major at some US
institutions.</p>
</dd>
<dt>migrator</dt>
<dd>
<p>A student who changes majors. In dealing with FYE records, we are
concerned with migrators into or out of Engineering at the 2-digit
program level (CIP 14).</p>
</dd>
<dt>FYE proxy</dt>
<dd>
<p>The degree-granting engineering program we estimate an FYE student
would have declared had they not been required to enroll in FYE. The
proxy, a 6-digit CIP code, acts as a substitute for the FYE CIP code as
needed. Applies only to students enrolled in FYE in their first
term.</p>
</dd>
<dt>multiple imputation</dt>
<dd>
<p>Method of imputing missing categorical data, in this case, the
6-digit CIP codes of FYE proxy programs.</p>
</dd>
</dl>
</div>
<div class="section level2">
<h2 id="method">Method<a class="anchor" aria-label="anchor" href="#method"></a>
</h2>
<p><em>This section is optional if you are working with the midfielddata
practice data and are more interested (at this time) in using a set of
proxies than creating a set of proxies. You may skip to <a href="art-071-using-fye-proxies.html">Using FYE proxies</a>.</em></p>
<p>Start here if you are working with MIDFIELD research data or if you
want to practice the estimation/imputation process using the
midfielddata practice data.</p>
<p>In this section, we apply <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> to the
<code>student</code> and <code>term</code> data tables to construct a
data frame suitable for imputation using the mice R package. Three
outcomes are possible, depending on your goals and available data:</p>
<ol style="list-style-type: decimal">
<li><p>Using midfielddata practice data, recreate the
<code>fye_proxy</code> data set included with midfieldr. This is the
example used in this vignette.</p></li>
<li><p>Using midfielddata practice data, you can create an alternate set
of FYE proxies using a different random number generator seed or using
different predictor variables for imputation. The resulting data frame
will have the same IDs and number of rows as
<code>fye_proxy</code>.</p></li>
<li><p>Using MIDFIELD research data, constructing your own proxy data
set is required. The resulting data frame will have as many rows as your
research data has first-term FYE students.</p></li>
</ol>
<p>For a given set of <code>student</code> and <code>term</code> data,
FYE proxies can be created once and written to file to be reused as
needed unless the source files change. The procedure has four steps:</p>
<ol style="list-style-type: decimal">
<li><p>Use <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> from the midfieldr package to
estimate some of the FYE proxy CIPs, treat the remainder as missing
values, and structure the data frame for imputation.</p></li>
<li><p>Optional. Define a custom set of imputation predictor variables
if the defaults (institution, race/ethnicity, and sex) do not meet the
needs of your study.</p></li>
<li><p>Use <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code> from the mice package to impute the
6-digit CIP missing values.</p></li>
<li><p>Post-processing to limit the results to first-term FYE students
only.</p></li>
</ol>
<p>If you are writing your own script to follow along, we start with
these packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only if creating your own FYE proxies</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/amices/mice" class="external-link">"mice"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing options for data.table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  datatable.print.nrows <span class="op">=</span> <span class="fl">17</span>,</span>
<span>  datatable.print.topn <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p><strong>Importing.</strong> Data tables from midfielddata.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data sets from midfielddata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></span></code></pre></div>
<p>You can view the help pages (and data dictionaries) by running</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run in Console</span></span>
<span><span class="op">?</span> <span class="va">student</span></span>
<span><span class="op">?</span> <span class="va">term</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prep_fye_mice">
<code>prep_fye_mice()</code><a class="anchor" aria-label="anchor" href="#prep_fye_mice"></a>
</h2>
<p>This function prepares FYE data for multiple imputation. You can view
the help page by running</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run in Console</span></span>
<span><span class="op">?</span> <span class="va">prep_fye_mice</span></span></code></pre></div>
<p><strong>Arguments:</strong></p>
<dl>
<dt>midfield_student</dt>
<dd>
<p>Data frame of student observations, keyed by student ID. Default is
<code>student</code>. Required variables are <code>mcid</code>,
<code>race</code>, and <code>sex</code>. Use all rows of your source
<code>student</code> data table.</p>
</dd>
<dt>midfield_term</dt>
<dd>
<p>Data frame of term observations keyed by student ID. Default is
<code>term</code>. Required variables are <code>mcid</code>,
<code>institution</code>, <code>term</code>, and <code>cip6</code>. Use
all rows of your source <code>term</code> data table.</p>
</dd>
<dt>fye_codes</dt>
<dd>
<p>Optional character vector of 6-digit CIP codes assigned to FYE
programs. Default is “140102”.</p>
</dd>
</dl>
<p><strong>Usage.</strong> The following implementations yield identical
results.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Required arguments in order and explicitly named</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_fye_mice.html">prep_fye_mice</a></span><span class="op">(</span>midfield_student <span class="op">=</span> <span class="va">student</span>, midfield_term <span class="op">=</span> <span class="va">term</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Required arguments in order, but not named</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_fye_mice.html">prep_fye_mice</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the implicit defaults</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_fye_mice.html">prep_fye_mice</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Equality test between the data tables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The arguments of <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> should include all rows
of the <code>student</code> and <code>term</code> data tables to provide
as many observations as possible of FYE students. Filters normally
applied for measures of program completion, e.g., <a href="art-010-data-sufficiency.html">data sufficiency</a>, unnecessarily
restrict the estimation/imputation process by potentially removing
observations of FYE students’ first post-FYE majors. The only required
filter is <a href="art-020-degree-seeking.html">degree-seeking</a>—which
is an inherent property of the <code>student</code> data table.</p>
<p>The function extracts all terms for all FYE students, including
migrators, and returns one row per FYE student with columns for
institution, race, sex, and proxy CIP code if any. All variables except
ID are are factors as required by <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the working data frame</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_fye_mice.html">prep_fye_mice</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">fye</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid   race    sex   institution  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;fctr&gt; &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID26060301  Asian Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    2: MID25995980 Latine Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    3: MID25997636 Latine Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    4: MID26086310 Latine Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    5: MID26000057  White Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   ---                                               </span></span>
<span><span class="co">#&gt; 4488: MID25844276  White   Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4489: MID25846316  White   Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4490: MID25847220  White   Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4491: MID25848589  White   Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4492: MID25828870  White   Male Institution M 149999</span></span></code></pre>
<p>The function identifies the CIP code, if any, of the first post-FYE
program in which the student enrolls. This treatment yields a CIP code
or NA in the <code>proxy</code> column as follows:</p>
<ol style="list-style-type: decimal">
<li><p>The student completes FYE and enrolls in an engineering major.
For this outcome, we know that at the student’s first opportunity, they
enrolled in an engineering program of their choosing. The CIP code of
that program is returned by <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> as the
student’s FYE proxy.</p></li>
<li><p>The student does not enroll post-FYE in an engineering major.
Such students have no further records in the database or migrated to a
non-engineering program. For this outcome, the data provide no
information regarding what engineering program the student would have
declared originally had the institution not required them to enroll in
FYE. For these students, <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> returns a proxy
value of NA. These are the data treated as missing values to be imputed
by <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h2>
<p>We construct the data frame for imputation such that the only missing
values are in the proxy column. Other variables are complete. A
race/ethnicity or sex value of “unknown” is treated as an observed
value, not missing data. And while no values of ID or institution are
unknown or missing in this example, such observations (if they existed)
would have to be removed.</p>
<p>Checking that all variables except <code>proxy</code> are
complete.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of complete cases on four variables</span></span>
<span><span class="op">(</span><span class="va">N_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">race</span>, <span class="va">sex</span>, <span class="va">institution</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4492</span></span></code></pre></div>
<p>Number of missing observations in <code>proxy</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number NAs in proxy</span></span>
<span><span class="op">(</span><span class="va">N_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fye</span><span class="op">$</span><span class="va">proxy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1689</span></span></code></pre></div>
<p>These missing <code>proxy</code> data are caused by a student’s
decision to migrate to a non-engineering major or to leave the database.
At the time of making that decision, the student would not yet have
enrolled in a degree-granting engineering major, thus their decision is
unlikely to be related to any specific engineering major.</p>
<p>Hence, that a CIP is missing is unlikely to be related to a specific
CIP value—but may be related to other observations such as institution,
race/ethnicity, or sex. Missing data of this type are classified as
“missing at random” (MAR) which are suitable for multiple imputation and
yield unbiased results <span class="citation">(<a href="#ref-GraceMartin:2012" role="doc-biblioref">Grace-Martin,
2012</a>)</span>.</p>
<p>Lastly, while 5–10 imputations are generally considered adequate for
unbiasedness, Bodner <span class="citation">(<a href="#ref-Bodner:2008" role="doc-biblioref">2008</a>)</span> recommends having as many
imputations as the percentage of missing data. As shown here, the
overall percentage of missing data is 38%, suggesting we set the number
of imputations to 38.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Percent missing proxies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">N_impute</span> <span class="op">/</span> <span class="va">N_complete</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 37.6</span></span></code></pre></div>
<p>Percent missing data grouped by category are shown in the chart. The
vertical dashed line indicates the overall percentage of missing
data.</p>
<p><img src="../../../../R%20projects/MIDFIELDR-repos/midfieldr/articles/reference/figures/art-070-creating-fye-proxies-pct-missing.png" style="width:100.0%"></p>
<p><strong>Data set-aside.</strong> The current <code>fye</code> data
set with missing proxies is set aside for use in creating the chart. The
script for the chart is given in the <a href="#missing-data-chart">Missing data chart</a> appendix.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set aside for the chart</span></span>
<span><span class="va">fye_missing_proxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-mice">Using <code>mice()</code><a class="anchor" aria-label="anchor" href="#using-mice"></a>
</h2>
<p>The mice package <span class="citation">(<a href="#ref-vanBuuren+Oudshoorn:2011" role="doc-biblioref">van Buuren
&amp; Groothuis-Oudshoorn, 2011</a>)</span> implements multiple
imputation by chained equations (MICE). MICE is also known as “fully
conditional specification” or “sequential regression multiple
imputation” and is suitable for categorical variables such as ours <span class="citation">(<a href="#ref-azur2011" role="doc-biblioref">Azur et
al., 2011</a>)</span>. Our computational procedure follows the approach
suggested by Dhana <span class="citation">(<a href="#ref-dhana2017" role="doc-biblioref">2017</a>)</span>.</p>
<p><strong>Framework.</strong> Our first use of <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code> is
to examine the imputation framework by calling the function with zero
iterations on the <code>fye</code> data frame. <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code>
produces a “multiply-imputed data set”, an R object of class “mids”.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation framework</span></span>
<span><span class="va">framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">framework</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Class: mids</span></span>
<span><span class="co">#&gt; Number of multiple imputations:  5 </span></span>
<span><span class="co">#&gt; Imputation methods:</span></span>
<span><span class="co">#&gt;        mcid        race         sex institution       proxy </span></span>
<span><span class="co">#&gt;          ""          ""          ""          ""   "polyreg" </span></span>
<span><span class="co">#&gt; PredictorMatrix:</span></span>
<span><span class="co">#&gt;             mcid race sex institution proxy</span></span>
<span><span class="co">#&gt; mcid           0    1   1           1     1</span></span>
<span><span class="co">#&gt; race           0    0   1           1     1</span></span>
<span><span class="co">#&gt; sex            0    1   0           1     1</span></span>
<span><span class="co">#&gt; institution    0    1   1           0     1</span></span>
<span><span class="co">#&gt; proxy          0    1   1           1     0</span></span>
<span><span class="co">#&gt; Number of logged events:  1 </span></span>
<span><span class="co">#&gt;   it im dep     meth  out</span></span>
<span><span class="co">#&gt; 1  0  0     constant mcid</span></span></code></pre>
<p><strong>Imputation methods.</strong> We look more closely at two
elements of this framework. The first is the imputation method
vector.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation method</span></span>
<span><span class="va">method_vector</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">method_vector</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        mcid        race         sex institution       proxy </span></span>
<span><span class="co">#&gt;          ""          ""          ""          ""   "polyreg"</span></span></code></pre>
<p>The “polyreg” imputation method (polytomous logistic regression) is
appropriate for data, like ours, comprising unordered categorical
variables. Variable <code>proxy</code> is imputed using the polyreg
method; the other variables, being predictors, are not imputed, thus
their methods are empty.</p>
<p>Had the method not been correctly assigned, we would assign it as
follows,</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually assign the variable(s) being imputed</span></span>
<span><span class="va">method_vector</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proxy"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"polyreg"</span></span>
<span></span>
<span><span class="co"># Manually assign the variable(s) not being imputed</span></span>
<span><span class="va">method_vector</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">method_vector</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        mcid        race         sex institution       proxy </span></span>
<span><span class="co">#&gt;          ""          ""          ""          ""   "polyreg"</span></span></code></pre>
<p><strong>Predictor matrix.</strong> The second element to review is
the predictor matrix. A row label identifies the variable being
predicted; the columns indicate the predictor variables.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation predictor matrix</span></span>
<span><span class="va">predictor_matrix</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">predictor_matrix</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;             mcid race sex institution proxy</span></span>
<span><span class="co">#&gt; mcid           0    1   1           1     1</span></span>
<span><span class="co">#&gt; race           0    0   1           1     1</span></span>
<span><span class="co">#&gt; sex            0    1   0           1     1</span></span>
<span><span class="co">#&gt; institution    0    1   1           0     1</span></span>
<span><span class="co">#&gt; proxy          0    1   1           1     0</span></span></code></pre>
<p>However, only those variables assigned a method are imputed. In our
case, the only variable to be imputed is <code>proxy</code>, so the only
row of this matrix that gets used is the last row.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictor row for this example</span></span>
<span><span class="va">predictor_matrix</span><span class="op">[</span><span class="st">"proxy"</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        mcid        race         sex institution       proxy </span></span>
<span><span class="co">#&gt;           0           1           1           1           0</span></span></code></pre>
<p>The zeros and ones tell us that <code>proxy</code> is going to be
predicted by institution, race, and sex.</p>
<p>Had the default setting been incorrect, we can set them manually.
Again, note that the bottom row is the only row we need because only the
<code>proxy</code> variable is being imputed.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually assign zero columns</span></span>
<span><span class="va">predictor_matrix</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"proxy"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Manually assign predictor columns</span></span>
<span><span class="va">predictor_matrix</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">predictor_matrix</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;             mcid race sex institution proxy</span></span>
<span><span class="co">#&gt; mcid           0    0   0           0     0</span></span>
<span><span class="co">#&gt; race           0    0   0           0     0</span></span>
<span><span class="co">#&gt; sex            0    0   0           0     0</span></span>
<span><span class="co">#&gt; institution    0    0   0           0     0</span></span>
<span><span class="co">#&gt; proxy          0    1   1           1     0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="optional-predictors">Optional predictors<a class="anchor" aria-label="anchor" href="#optional-predictors"></a>
</h2>
<p>The default predictors set up by <code><a href="../reference/prep_fye_mice.html">prep_fye_mice()</a></code> are
institution (required), race/ethnicity, and sex. If these are
acceptable, you can skip to the next section, <a href="#imputing-missing-values">Imputing missing values</a>.</p>
<p>Predictors can be edited or added before invoking
<code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code>. As before, ensure that the only missing values are
in the proxy column. Other variables are expected to be complete (no NA
values). A value of “unknown” in a predictor column, e.g.,
race/ethnicity or sex, is an acceptable value, not missing data.
Observations with missing or unknown values in the ID or institution
columns should be removed.</p>
<p>For example, suppose we wish to replace race/ethnicity and sex with a
<code>people</code> variable that has four possible values
(<code>Domestic Female</code>, <code>Domestic Male</code>,
<code>International Female</code>, and <code>International Male</code>)
where “domestic” means a US citizen; and we want to add a variable that
encodes the <code>year</code> of a student’s first term in FYE.</p>
<p><strong>Creating variables.</strong> Remove any unknown observations
of race/ethnicity and sex to create the desired <code>people</code>
variable.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data frame to illustrate optional predictors</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Factor to character</span></span>
<span><span class="va">cols_to_edit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="op">(</span><span class="va">cols_to_edit</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.character</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols_to_edit</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Filter unknown race and sex</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">sex</span> <span class="op">!=</span> <span class="st">"Unknown"</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">race</span> <span class="op">!=</span> <span class="st">"Other/Unknown"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create origin variable</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">origin</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span></span>
<span>    <span class="va">race</span> <span class="op">!=</span> <span class="st">"International"</span>, <span class="st">"Domestic"</span>, </span>
<span>    <span class="va">race</span> <span class="op">==</span> <span class="st">"International"</span>, <span class="st">"International"</span>, </span>
<span>    default <span class="op">=</span> <span class="cn">NA_character_</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create people variable</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">people</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">sex</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">people</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">people</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"sex"</span>, <span class="st">"origin"</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display result</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setcolorder.html" class="external-link">setcolorder</a></span><span class="op">(</span><span class="va">opt_fye</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"people"</span>, <span class="st">"institution"</span>, <span class="st">"proxy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid          people   institution  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt;          &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID26060301 Domestic Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    2: MID25995980 Domestic Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    3: MID25997636 Domestic Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    4: MID26086310 Domestic Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    5: MID26000057 Domestic Female Institution C   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   ---                                                 </span></span>
<span><span class="co">#&gt; 4339: MID25844276   Domestic Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4340: MID25846316   Domestic Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4341: MID25847220   Domestic Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4342: MID25848589   Domestic Male Institution M 143501</span></span>
<span><span class="co">#&gt; 4343: MID25828870   Domestic Male Institution M 149999</span></span></code></pre>
<p>Check the unique values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display unique people</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">$</span><span class="va">people</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Domestic Female      Domestic Male        International Female</span></span>
<span><span class="co">#&gt; [4] International Male  </span></span>
<span><span class="co">#&gt; 4 Levels: Domestic Female Domestic Male ... International Male</span></span></code></pre></div>
<p><strong>Adding a variable.</strong> Obtain the student’s first term
in the data set from the <code>term</code> data table using a left-outer
join.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add all term variables by ID</span></span>
<span><span class="va">cols_to_join</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">cols_to_join</span><span class="op">[</span><span class="va">opt_fye</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Filter for first term</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">opt_fye</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create year variable</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">year</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">term</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">year</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">term</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display result</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setcolorder.html" class="external-link">setcolorder</a></span><span class="op">(</span><span class="va">opt_fye</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"people"</span>, <span class="st">"institution"</span>, <span class="st">"year"</span>, <span class="st">"proxy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid               people   institution   year  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt;               &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162        Domestic Male Institution M   1992   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    2: MID25783178        Domestic Male Institution M   1994 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197        Domestic Male Institution M   1987 140701</span></span>
<span><span class="co">#&gt;    4: MID25783259        Domestic Male Institution M   1988   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    5: MID25783388        Domestic Male Institution M   1987 141901</span></span>
<span><span class="co">#&gt;   ---                                                             </span></span>
<span><span class="co">#&gt; 4339: MID26648422        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4340: MID26648484        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4341: MID26648508 International Female Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4342: MID26648517        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4343: MID26648553        Domestic Male Institution J   2009   &lt;NA&gt;</span></span></code></pre>
<p><strong>Filtering.</strong> Ensure complete cases except in
<code>proxy</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify complete cases in predictor variables </span></span>
<span><span class="va">rows_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">people</span>, <span class="va">institution</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter for complete predictors</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">rows_we_want</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid               people   institution   year  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt;               &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162        Domestic Male Institution M   1992   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    2: MID25783178        Domestic Male Institution M   1994 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197        Domestic Male Institution M   1987 140701</span></span>
<span><span class="co">#&gt;    4: MID25783259        Domestic Male Institution M   1988   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    5: MID25783388        Domestic Male Institution M   1987 141901</span></span>
<span><span class="co">#&gt;   ---                                                             </span></span>
<span><span class="co">#&gt; 4339: MID26648422        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4340: MID26648484        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4341: MID26648508 International Female Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4342: MID26648517        Domestic Male Institution J   2009   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4343: MID26648553        Domestic Male Institution J   2009   &lt;NA&gt;</span></span></code></pre>
<p><strong>Framework</strong> for optional predictors.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation framework</span></span>
<span><span class="va">opt_framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">opt_fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">opt_framework</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Class: mids</span></span>
<span><span class="co">#&gt; Number of multiple imputations:  5 </span></span>
<span><span class="co">#&gt; Imputation methods:</span></span>
<span><span class="co">#&gt;        mcid      people institution        year       proxy </span></span>
<span><span class="co">#&gt;          ""          ""          ""          ""   "polyreg" </span></span>
<span><span class="co">#&gt; PredictorMatrix:</span></span>
<span><span class="co">#&gt;             mcid people institution year proxy</span></span>
<span><span class="co">#&gt; mcid           0      1           1    1     1</span></span>
<span><span class="co">#&gt; people         0      0           1    1     1</span></span>
<span><span class="co">#&gt; institution    0      1           0    1     1</span></span>
<span><span class="co">#&gt; year           0      1           1    0     1</span></span>
<span><span class="co">#&gt; proxy          0      1           1    1     0</span></span>
<span><span class="co">#&gt; Number of logged events:  1 </span></span>
<span><span class="co">#&gt;   it im dep     meth  out</span></span>
<span><span class="co">#&gt; 1  0  0     constant mcid</span></span></code></pre>
<p><strong>Imputation method</strong> for optional predictors.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation framework</span></span>
<span><span class="va">opt_method_vector</span> <span class="op">&lt;-</span> <span class="va">opt_framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">opt_method_vector</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        mcid      people institution        year       proxy </span></span>
<span><span class="co">#&gt;          ""          ""          ""          ""   "polyreg"</span></span></code></pre>
<p><strong>Predictor matrix</strong> for optional predictors.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imputation predictor matrix</span></span>
<span><span class="va">opt_predictor_matrix</span> <span class="op">&lt;-</span> <span class="va">opt_framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="va">opt_predictor_matrix</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;             mcid people institution year proxy</span></span>
<span><span class="co">#&gt; mcid           0      1           1    1     1</span></span>
<span><span class="co">#&gt; people         0      0           1    1     1</span></span>
<span><span class="co">#&gt; institution    0      1           0    1     1</span></span>
<span><span class="co">#&gt; year           0      1           1    0     1</span></span>
<span><span class="co">#&gt; proxy          0      1           1    1     0</span></span></code></pre>
<p><strong>Percent missing data</strong> for setting the number of
multiple imputations.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">$</span><span class="va">proxy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">N_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Percent missing data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">N_impute</span> <span class="op">/</span> <span class="va">N_fye</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 37</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="imputing-missing-values">Imputing missing values<a class="anchor" aria-label="anchor" href="#imputing-missing-values"></a>
</h2>
<p>The three essential arguments for <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice()</a></code> are the
<code>fye</code> data frame, the <code>method_vector</code>, and the
<code>predictor_matrix</code>. The number of multiple imputations
<code>m</code> is set to 38 as discussed in <a href="#missing-data">Missing data</a>. The default <code>seed</code>
argument is NULL, but by setting the seed as shown the vignette results
are reproducible. Setting <code>printFlag = TRUE</code> displays
progress in the console.</p>
<p><strong>Imputation.</strong> For the practice data, 5 iterations of
38 imputations takes about 3 minutes (depending on your machine). For
MIDFIELD research data, however, imputation runs significantly
longer.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Impute missing proxy data</span></span>
<span><span class="va">fye_mids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fye</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">38</span>, </span>
<span>  maxit <span class="op">=</span> <span class="fl">5</span>, <span class="co"># default</span></span>
<span>  method <span class="op">=</span> <span class="va">method_vector</span>,</span>
<span>  predictorMatrix <span class="op">=</span> <span class="va">predictor_matrix</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">20180624</span>,</span>
<span>  printFlag <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># output in console with printFlag = TRUE</span></span>
<span><span class="co"># &gt;  iter imp variable</span></span>
<span><span class="co"># &gt;   1   1  proxy</span></span>
<span><span class="co"># &gt;   1   2  proxy</span></span>
<span><span class="co"># &gt;   1   3  proxy</span></span>
<span><span class="co"># &gt;   1   4  proxy</span></span>
<span><span class="co"># &gt;   1   5  proxy</span></span>
<span><span class="co"># &gt;   ---</span></span>
<span><span class="co"># &gt;   5  34  proxy</span></span>
<span><span class="co"># &gt;   5  35  proxy</span></span>
<span><span class="co"># &gt;   5  36  proxy</span></span>
<span><span class="co"># &gt;   5  37  proxy</span></span>
<span><span class="co"># &gt;   5  38  proxy</span></span></code></pre></div>
<p><strong>Extracting the result.</strong> We apply
<code><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">mice::complete()</a></code> to extract the data from the
<code>mids</code> object. The missing data have been replaced by imputed
values.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Revert to default random number generation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract data from the mids object</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">fye_mids</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to data.table structure</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fye</span><span class="op">[</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid          race    sex   institution  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt;        &lt;fctr&gt; &lt;fctr&gt;        &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162         White   Male Institution M 140801</span></span>
<span><span class="co">#&gt;    2: MID25783178         Black   Male Institution M 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197         White   Male Institution M 140701</span></span>
<span><span class="co">#&gt;    4: MID25783259         White   Male Institution M 141901</span></span>
<span><span class="co">#&gt;    5: MID25783388         White   Male Institution M 141901</span></span>
<span><span class="co">#&gt;   ---                                                      </span></span>
<span><span class="co">#&gt; 4488: MID26648422         White   Male Institution J 142101</span></span>
<span><span class="co">#&gt; 4489: MID26648484        Latine   Male Institution J 143501</span></span>
<span><span class="co">#&gt; 4490: MID26648508 International Female Institution J 143501</span></span>
<span><span class="co">#&gt; 4491: MID26648517        Latine   Male Institution J 140201</span></span>
<span><span class="co">#&gt; 4492: MID26648553         White   Male Institution J 141901</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="post-processing">Post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<p><strong>Selecting columns.</strong> To use the result, we need only
two columns: IDs and the the predicted starting programs.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset the data</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">fye</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162 140801</span></span>
<span><span class="co">#&gt;    2: MID25783178 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197 140701</span></span>
<span><span class="co">#&gt;    4: MID25783259 141901</span></span>
<span><span class="co">#&gt;    5: MID25783388 141901</span></span>
<span><span class="co">#&gt;   ---                   </span></span>
<span><span class="co">#&gt; 4488: MID26648422 142101</span></span>
<span><span class="co">#&gt; 4489: MID26648484 143501</span></span>
<span><span class="co">#&gt; 4490: MID26648508 143501</span></span>
<span><span class="co">#&gt; 4491: MID26648517 140201</span></span>
<span><span class="co">#&gt; 4492: MID26648553 141901</span></span></code></pre>
<p><strong>Recoding.</strong> We convert the CIP codes from factor to
character.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert factors</span></span>
<span><span class="va">fye</span><span class="op">[</span>, <span class="va">proxy</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">fye</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162 140801</span></span>
<span><span class="co">#&gt;    2: MID25783178 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197 140701</span></span>
<span><span class="co">#&gt;    4: MID25783259 141901</span></span>
<span><span class="co">#&gt;    5: MID25783388 141901</span></span>
<span><span class="co">#&gt;   ---                   </span></span>
<span><span class="co">#&gt; 4488: MID26648422 142101</span></span>
<span><span class="co">#&gt; 4489: MID26648484 143501</span></span>
<span><span class="co">#&gt; 4490: MID26648508 143501</span></span>
<span><span class="co">#&gt; 4491: MID26648517 140201</span></span>
<span><span class="co">#&gt; 4492: MID26648553 141901</span></span></code></pre>
<p><strong>Filtering.</strong> For imputing missing values we used all
students ever enrolled in FYE, including migrators. In use, however, the
proxies are substitutes for students starting in FYE. Therefore, we
filter to retain the proxies of first-term FYE students only.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain first term of all students in term data</span></span>
<span><span class="va">all_start</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorderv</a></span><span class="op">(</span><span class="va">all_start</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_start</span> <span class="op">&lt;-</span> <span class="va">all_start</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Subset for FYE only</span></span>
<span><span class="va">fye_start</span> <span class="op">&lt;-</span> <span class="va">all_start</span><span class="op">[</span><span class="va">cip6</span> <span class="op">==</span> <span class="st">"140102"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fye_start</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid</span></span>
<span><span class="co">#&gt;            &lt;char&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162</span></span>
<span><span class="co">#&gt;    2: MID25783178</span></span>
<span><span class="co">#&gt;    3: MID25783197</span></span>
<span><span class="co">#&gt;    4: MID25783388</span></span>
<span><span class="co">#&gt;    5: MID25783441</span></span>
<span><span class="co">#&gt;   ---            </span></span>
<span><span class="co">#&gt; 3734: MID26648222</span></span>
<span><span class="co">#&gt; 3735: MID26648283</span></span>
<span><span class="co">#&gt; 3736: MID26648422</span></span>
<span><span class="co">#&gt; 3737: MID26648484</span></span>
<span><span class="co">#&gt; 3738: MID26648553</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inner join to retain the FYE starters</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye_start</span><span class="op">[</span><span class="va">fye</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Display the result</span></span>
<span><span class="va">fye</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              mcid  proxy</span></span>
<span><span class="co">#&gt;            &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;    1: MID25783162 140801</span></span>
<span><span class="co">#&gt;    2: MID25783178 140701</span></span>
<span><span class="co">#&gt;    3: MID25783197 140701</span></span>
<span><span class="co">#&gt;    4: MID25783388 141901</span></span>
<span><span class="co">#&gt;    5: MID25783441 140801</span></span>
<span><span class="co">#&gt;   ---                   </span></span>
<span><span class="co">#&gt; 3734: MID26648222 141901</span></span>
<span><span class="co">#&gt; 3735: MID26648283 141901</span></span>
<span><span class="co">#&gt; 3736: MID26648422 142101</span></span>
<span><span class="co">#&gt; 3737: MID26648484 143501</span></span>
<span><span class="co">#&gt; 3738: MID26648553 141901</span></span></code></pre>
<p><strong>Confirming results.</strong> This process is how the built-in
data set <code>fye_proxy</code> was constructed, using the same random
number seed that we used above. To confirm they are identical,</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Verify that result matches the built-in data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">fye</span>, <span class="va">fye_proxy</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><em>This step concludes the procedure for creating FYE proxy
data.</em></p>
</div>
<div class="section level2">
<h2 id="closing">Closing<a class="anchor" aria-label="anchor" href="#closing"></a>
</h2>
<p>At institutions with First-Year Engineering (FYE) programs, students
“starting” in degree-granting engineering majors are under-counted
unless care is taken to account for FYE students who do not transition
(post-FYE) to degree-granting engineering programs</p>
<p>We address this problem using FYE “proxies”—6-digit CIP codes of the
degree-granting engineering programs we estimate FYE students would have
declared had they not been required to enroll in FYE. Estimated values
are based on the engineering program in which a student enrolls
immediately post-FYE and are otherwise treated a missing data for a
multiple imputation.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-azur2011" class="csl-entry">
Azur, M. J., Stuart, E. A., Frangakis, C., &amp; Leaf, P. J. (2011).
Multiple imputation by chained equations: <span>W</span>hat is it and
how does it work? <em>International Journal of Methods in Psychiatric
Research</em>, <em>20</em>(1), 40–49.
</div>
<div id="ref-Bodner:2008" class="csl-entry">
Bodner, T. E. (2008). <span class="nocase">What improves with increased
missing data imputations?</span> <em><span>Structural Equation Modeling:
A Multidisciplinary Journal</span></em>, <em>15</em>(4), 651–675. <a href="https://doi.org/10.1080/10705510802339072" class="external-link">https://doi.org/10.1080/10705510802339072</a>
</div>
<div id="ref-dhana2017" class="csl-entry">
Dhana, K. (2017). <em>Handling missing data with <span>MICE</span>
package: A simple approach</em> (D. S. Plus, Ed.). <a href="https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/" class="external-link uri">https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/</a>.
</div>
<div id="ref-GraceMartin:2012" class="csl-entry">
Grace-Martin, K. (2012). <em><span class="nocase">Two recommended
solutions for missing data: Multiple imputation and maximum
likelihood</span></em>. Blog post. <a href="https://www.theanalysisfactor.com/missing-data-two-recommended-solutions/" class="external-link">https://www.theanalysisfactor.com/missing-data-two-recommended-solutions/</a>
</div>
<div id="ref-vanBuuren+Oudshoorn:2011" class="csl-entry">
van Buuren, S., &amp; Groothuis-Oudshoorn, K. (2011). <span class="nocase">mice: Multivariate Imputation by Chained Equations in
R</span>. <em>Journal of Statistical Software</em>, <em>45</em>(3),
1–67. <a href="https://www.jstatsoft.org/v45/i03/" class="external-link">https://www.jstatsoft.org/v45/i03/</a>
</div>
</div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="missing-data-chart">Missing data chart<a class="anchor" aria-label="anchor" href="#missing-data-chart"></a>
</h3>
<p>Script for creating the chart of percent missing data grouped by
category.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># New memory location</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">fye_missing_proxy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert factors to characters</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Overall percentage missing proxies</span></span>
<span><span class="va">overall_miss</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">proxy</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Determine percent missing proxies by category</span></span>
<span><span class="va">missing_fraction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">DT</span>, <span class="va">cat_level</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">DT</span><span class="op">[</span>, <span class="va">group</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">proxy</span><span class="op">)</span>, <span class="st">"missing"</span>, </span>
<span>      default <span class="op">=</span> <span class="st">"not_missing"</span></span>
<span>  <span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">"cat_level"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">cat_level</span> <span class="op">~</span> <span class="va">group</span>, value.var <span class="op">=</span> <span class="st">"N"</span><span class="op">)</span></span>
<span>  <span class="va">DT</span><span class="op">[</span>, <span class="va">pct_miss</span> <span class="op">:=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">missing</span> <span class="op">/</span> <span class="op">(</span><span class="va">missing</span> <span class="op">+</span> <span class="va">not_missing</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">cat_level</span>, <span class="va">pct_miss</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>cat_level <span class="op">=</span> <span class="va">institution</span>, <span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu">missing_fraction</span><span class="op">(</span><span class="va">y</span>, cat_level <span class="op">=</span> <span class="st">"institution"</span><span class="op">)</span></span>
<span><span class="va">inst</span><span class="op">[</span>, <span class="va">category</span> <span class="op">:=</span> <span class="st">"institution"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>cat_level <span class="op">=</span> <span class="va">race</span>, <span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">race</span> <span class="op">&lt;-</span> <span class="fu">missing_fraction</span><span class="op">(</span><span class="va">y</span>, cat_level <span class="op">=</span> <span class="st">"race"</span><span class="op">)</span></span>
<span><span class="va">race</span><span class="op">[</span>, <span class="va">category</span> <span class="op">:=</span> <span class="st">"race"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>cat_level <span class="op">=</span> <span class="va">sex</span>, <span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">missing_fraction</span><span class="op">(</span><span class="va">y</span>, cat_level <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="va">sex</span><span class="op">[</span>, <span class="va">category</span> <span class="op">:=</span> <span class="st">"sex"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">inst</span>, <span class="va">race</span>, <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">DT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pct_miss</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">cat_level</span>, <span class="va">pct_miss</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">overall_miss</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray35"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">category</span>, <span class="va">pct_miss</span><span class="op">)</span><span class="op">)</span>, </span>
<span>               as.table <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>               scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>               space <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"FYE proxy missing values (%)"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>  filename <span class="op">=</span> <span class="st">"man/figures/art-070-creating-fye-proxies-pct-missing.png"</span>,</span>
<span>  plot <span class="op">=</span> <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="fl">7</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="complete-script">Complete script<a class="anchor" aria-label="anchor" href="#complete-script"></a>
</h3>
<p>The vignette code chunks are collected below in a single, condensed
script.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only if creating your own FYE proxies</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/amices/mice" class="external-link">"mice"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing options for data.table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  datatable.print.nrows <span class="op">=</span> <span class="fl">17</span>,</span>
<span>  datatable.print.topn <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creating FYE proxies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_fye_mice.html">prep_fye_mice</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Percent missing proxy data </span></span>
<span><span class="va">N_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">race</span>, <span class="va">sex</span>, <span class="va">institution</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">N_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fye</span><span class="op">$</span><span class="va">proxy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">N_impute</span> <span class="op">/</span> <span class="va">N_complete</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set aside for the chart</span></span>
<span><span class="va">fye_missing_proxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using mice()</span></span>
<span><span class="va">framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Method vector</span></span>
<span><span class="va">method_vector</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">method_vector</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proxy"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"polyreg"</span></span>
<span><span class="va">method_vector</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span><span class="co"># Imputation predictor matrix</span></span>
<span><span class="va">predictor_matrix</span> <span class="op">&lt;-</span> <span class="va">framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">predictor_matrix</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"proxy"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">predictor_matrix</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional predictors</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span>
<span><span class="va">cols_to_edit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="op">(</span><span class="va">cols_to_edit</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.character</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">cols_to_edit</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">sex</span> <span class="op">!=</span> <span class="st">"Unknown"</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">race</span> <span class="op">!=</span> <span class="st">"Other/Unknown"</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">origin</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span></span>
<span>    <span class="va">race</span> <span class="op">!=</span> <span class="st">"International"</span>, <span class="st">"Domestic"</span>, </span>
<span>    <span class="va">race</span> <span class="op">==</span> <span class="st">"International"</span>, <span class="st">"International"</span>, </span>
<span>    default <span class="op">=</span> <span class="cn">NA_character_</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">people</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">sex</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">people</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">people</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"sex"</span>, <span class="st">"origin"</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Optional predictors add a variable</span></span>
<span><span class="va">cols_to_join</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">cols_to_join</span><span class="op">[</span><span class="va">opt_fye</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">opt_fye</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">year</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">term</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">year</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">opt_fye</span><span class="op">[</span>, <span class="va">term</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setcolorder.html" class="external-link">setcolorder</a></span><span class="op">(</span><span class="va">opt_fye</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"people"</span>, <span class="st">"institution"</span>, <span class="st">"year"</span>, <span class="st">"proxy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional predictors filter complete cases</span></span>
<span><span class="va">rows_we_want</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">people</span>, <span class="va">institution</span>, <span class="va">year</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">opt_fye</span> <span class="op">&lt;-</span> <span class="va">opt_fye</span><span class="op">[</span><span class="va">rows_we_want</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Optional predictors framework and method</span></span>
<span><span class="va">opt_framework</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">opt_fye</span>, maxit <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">opt_method_vector</span> <span class="op">&lt;-</span> <span class="va">opt_framework</span><span class="op">[[</span><span class="st">"method"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">opt_predictor_matrix</span> <span class="op">&lt;-</span> <span class="va">opt_framework</span><span class="op">[[</span><span class="st">"predictorMatrix"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Optional predictors percent missing data</span></span>
<span><span class="va">N_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">$</span><span class="va">proxy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">N_fye</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">opt_fye</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">N_impute</span> <span class="op">/</span> <span class="va">N_fye</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Imputing missing values</span></span>
<span><span class="va">fye_mids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fye</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">38</span>, </span>
<span>  maxit <span class="op">=</span> <span class="fl">5</span>, <span class="co"># default</span></span>
<span>  method <span class="op">=</span> <span class="va">method_vector</span>,</span>
<span>  predictorMatrix <span class="op">=</span> <span class="va">predictor_matrix</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">20180624</span>,</span>
<span>  printFlag <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">fye_mids</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">fye</span><span class="op">)</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Post-processing</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fye</span><span class="op">[</span>, <span class="va">proxy</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">proxy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">all_start</span> <span class="op">&lt;-</span> <span class="va">term</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">term</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorderv</a></span><span class="op">(</span><span class="va">all_start</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_start</span> <span class="op">&lt;-</span> <span class="va">all_start</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fye_start</span> <span class="op">&lt;-</span> <span class="va">all_start</span><span class="op">[</span><span class="va">cip6</span> <span class="op">==</span> <span class="st">"140102"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fye</span> <span class="op">&lt;-</span> <span class="va">fye_start</span><span class="op">[</span><span class="va">fye</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Confirming results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">fye</span>, <span class="va">fye_proxy</span><span class="op">)</span></span></code></pre></div>
<style type="text/css">
blockquote {
    padding: 10px 20px;
    margin: 0 0 20px;
    border-left: 0px
}
</style>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/graphdr" class="external-link">Richard Layton</a>, Russell Long, Matthew Ohland, Marisa Orr, Susan Lord, US National Science Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
