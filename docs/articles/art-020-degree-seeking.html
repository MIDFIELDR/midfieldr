<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="midfieldr">
<title>Degree seeking (inner joins) • midfieldr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Degree seeking (inner joins)">
<meta property="og:description" content="midfieldr">
<meta property="og:image" content="https://midfieldr.github.io/midfieldr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">midfieldr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9022</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/art-000-getting-started.html">Getting started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-case-study">Case study</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-case-study">
    <a class="dropdown-item" href="../articles/art-001-case-goals.html">Goals</a>
    <a class="dropdown-item" href="../articles/art-002-case-data.html">Data</a>
    <a class="dropdown-item" href="../articles/art-003-case-results.html">Results</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/art-010-data-sufficiency.html">Data sufficiency</a>
    <a class="dropdown-item" href="../articles/art-020-degree-seeking.html">Degree seeking (inner joins)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MIDFIELDR/midfieldr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Degree seeking (inner joins)</h1>
            
            <h4 data-toc-skip class="date">2022-06-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MIDFIELDR/midfieldr/blob/HEAD/vignettes/art-020-degree-seeking.Rmd" class="external-link"><code>vignettes/art-020-degree-seeking.Rmd</code></a></small>
      <div class="d-none name"><code>art-020-degree-seeking.Rmd</code></div>
    </div>

    
    
<p>After subsetting longitudinal Student Unit Records (SURs) for data
sufficiency, a typical second step is to restrict a study to students
admitted as degree-seeking.</p>
<p>Within this context, this vignette illustrates using inner joins to
filter observations using data.table syntax. We use MIDFIELD data, but
no midfieldr functions are required.</p>
<div class="section level2">
<h2 id="method">Method<a class="anchor" aria-label="anchor" href="#method"></a>
</h2>
<p>We filter observations to retain degree-seeking students using an
inner join with the <code>student</code> data table. This works because
<code>student</code> (unlike <code>term</code>) contains degree-seeking
SURs only.</p>
</div>
<div class="section level2">
<h2 id="population">Population<a class="anchor" aria-label="anchor" href="#population"></a>
</h2>
<p>If you are writing your own script to follow along, we start with
these packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span>

<span class="co"># Printing options for data.table</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>
  datatable.print.nrows <span class="op">=</span> <span class="fl">55</span>,
  datatable.print.topn <span class="op">=</span> <span class="fl">5</span>,
  datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><strong>Importing.</strong> Load the midfielddata data tables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load data sets from midfielddata</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span></code></pre></div>
<p><strong>Data sufficiency.</strong> To set up for filtering for
degree-seeking, we start with the <code>term</code> data and filter for
data sufficiency as described in the <a href="art-010-data-sufficiency.html">Data sufficiency vignette</a>.
Those steps are reproduced here in condensed form without details.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filter for data sufficiency</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_timely_term.html">add_timely_term</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_data_sufficiency.html">add_data_sufficiency</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">data_sufficiency</span> <span class="op">==</span> <span class="st">"include"</span><span class="op">]</span>

<span class="co"># Drop unnecessary variables</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>
<span class="va">DT</span><span class="op">[</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;                mcid   cip6</span>
<span class="co">#&gt;              &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;      1: MID25783135 520101</span>
<span class="co">#&gt;      2: MID25783162 140102</span>
<span class="co">#&gt;      3: MID25783162 520301</span>
<span class="co">#&gt;      4: MID25783162 521401</span>
<span class="co">#&gt;      5: MID25783178 140102</span>
<span class="co">#&gt;     ---                   </span>
<span class="co">#&gt; 111928: MID26697576 521401</span>
<span class="co">#&gt; 111929: MID26697599 521201</span>
<span class="co">#&gt; 111930: MID26697599 110401</span>
<span class="co">#&gt; 111931: MID26697615 500901</span>
<span class="co">#&gt; 111932: MID26697623 451001</span></code></pre>
<p>The result has 111,932 observations of 63,952 unique IDs. The number
of unique students is smaller than the number of observations because
some students change programs over their course of study. Here we have
one row per unique combination of student (mcid) and program code
(cip6).</p>
<p>Retaining the CIP variable is not strictly necessary for
degree-seeking filtering. We retain it here to assist in the inner-join
examples.</p>
</div>
<div class="section level2">
<h2 id="inner-joins">Inner joins<a class="anchor" aria-label="anchor" href="#inner-joins"></a>
</h2>
<p>An <em>inner join</em> is a merge operation between two data frame
which returns only those records that match on selected variables
between the two data frames.</p>
<p>We use inner joins regularly to subset observations of our working
data frames by shared columns in another data frame. To illustrate, we
will filter our <code>DT</code> data by the IDs in the “toy” (exercise)
data sets bundled with midfieldr. Using data.table syntax, we have two
approaches: <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge()</a></code> and the <code>X[Y, j]</code>
syntax.</p>
<p><strong>Using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge()</a></code>.</strong> Using the data.table
<code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge()</a></code> syntax, the <code>all = FALSE</code> argument
creates the inner join. We first isolate the ID column in
<code>toy_student</code>. Otherwise, all columns from both data frames
would be returned.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Isolate the IDs of the second data frame</span>
<span class="va">toy_select</span> <span class="op">&lt;-</span> <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Inner join to filter the observations of the first data frame</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">toy_select</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt;             mcid   cip6</span>
<span class="co">#&gt;           &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;   1: MID25784187 010901</span>
<span class="co">#&gt;   2: MID25784187 520801</span>
<span class="co">#&gt;   3: MID25819358 511103</span>
<span class="co">#&gt;   4: MID25819358 260502</span>
<span class="co">#&gt;   5: MID25828870 140102</span>
<span class="co">#&gt;  ---                   </span>
<span class="co">#&gt; 131: MID26692025 500702</span>
<span class="co">#&gt; 132: MID26692025 131202</span>
<span class="co">#&gt; 133: MID26692254 520201</span>
<span class="co">#&gt; 134: MID26692254 400404</span>
<span class="co">#&gt; 135: MID26692254 450701</span></code></pre>
<p>The result has 135 observations of 74 unique IDs.</p>
<p>Alternatively, one can include the ID selection within the merge
operation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Isolating the IDs inside the merge function </span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt;             mcid   cip6</span>
<span class="co">#&gt;           &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;   1: MID25784187 010901</span>
<span class="co">#&gt;   2: MID25784187 520801</span>
<span class="co">#&gt;   3: MID25819358 511103</span>
<span class="co">#&gt;   4: MID25819358 260502</span>
<span class="co">#&gt;   5: MID25828870 140102</span>
<span class="co">#&gt;  ---                   </span>
<span class="co">#&gt; 131: MID26692025 500702</span>
<span class="co">#&gt; 132: MID26692025 131202</span>
<span class="co">#&gt; 133: MID26692254 520201</span>
<span class="co">#&gt; 134: MID26692254 400404</span>
<span class="co">#&gt; 135: MID26692254 450701</span></code></pre>
<p><strong>Using <code>X[Y, j]</code>.</strong> The second
approach—computationally more efficient—uses the data.table
<code>X[Y, j]</code> syntax.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A more computationally efficient approach</span>
<span class="va">DT</span><span class="op">[</span><span class="va">toy_student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;             mcid   cip6</span>
<span class="co">#&gt;           &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;   1: MID25784187 010901</span>
<span class="co">#&gt;   2: MID25784187 520801</span>
<span class="co">#&gt;   3: MID25819358 511103</span>
<span class="co">#&gt;   4: MID25819358 260502</span>
<span class="co">#&gt;   5: MID25828870 140102</span>
<span class="co">#&gt;  ---                   </span>
<span class="co">#&gt; 131: MID26692025 500702</span>
<span class="co">#&gt; 132: MID26692025 131202</span>
<span class="co">#&gt; 133: MID26692254 520201</span>
<span class="co">#&gt; 134: MID26692254 400404</span>
<span class="co">#&gt; 135: MID26692254 450701</span></code></pre>
<p>The <code>nomatch = NULL</code> argument makes the merge an inner
join, the <code>on</code> argument defines the shared column to use in
matching, and the <code>j</code> argument,<code>.(mcid, cip6)</code>,
defines the columns from both data frames to return.</p>
<p>The way to read this code out loud is: “Take <code>DT</code>, retain
rows where <code>toy_student$mcid == DT$mcid</code>, then select columns
<code>mcid</code> and <code>cip6</code>.”</p>
<p>For inner joins, <code>X[Y, j]</code> and <code>Y[X, j]</code>
produce the same result.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Swap the roles of the two data frames</span>
<span class="va">toy_student</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;             mcid   cip6</span>
<span class="co">#&gt;           &lt;char&gt; &lt;char&gt;</span>
<span class="co">#&gt;   1: MID25784187 010901</span>
<span class="co">#&gt;   2: MID25784187 520801</span>
<span class="co">#&gt;   3: MID25819358 511103</span>
<span class="co">#&gt;   4: MID25819358 260502</span>
<span class="co">#&gt;   5: MID25828870 140102</span>
<span class="co">#&gt;  ---                   </span>
<span class="co">#&gt; 131: MID26692025 500702</span>
<span class="co">#&gt; 132: MID26692025 131202</span>
<span class="co">#&gt; 133: MID26692254 520201</span>
<span class="co">#&gt; 134: MID26692254 400404</span>
<span class="co">#&gt; 135: MID26692254 450701</span></code></pre>
<p><strong>Confirm results.</strong> We nullify the key automatically
assigned by <code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge()</a></code> and then compare the equality of
results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Three equivalent inner joins</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">toy_student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="va">toy_student</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>

<span class="co"># Check equality </span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p><strong>Selecting columns.</strong> In either method, we can select
columns from both data frames. The difference being that with
<code><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge()</a></code> we select the columns by explicitly subsetting the
two data frames.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Selecting columns from both data frames using merge() </span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>, <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">institution</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">x</span><span class="op">[</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;             mcid   institution</span>
<span class="co">#&gt;           &lt;char&gt;        &lt;char&gt;</span>
<span class="co">#&gt;   1: MID25784187 Institution M</span>
<span class="co">#&gt;   2: MID25784187 Institution M</span>
<span class="co">#&gt;   3: MID25819358 Institution M</span>
<span class="co">#&gt;   4: MID25819358 Institution M</span>
<span class="co">#&gt;   5: MID25828870 Institution M</span>
<span class="co">#&gt;  ---                          </span>
<span class="co">#&gt; 131: MID26692025 Institution L</span>
<span class="co">#&gt; 132: MID26692025 Institution L</span>
<span class="co">#&gt; 133: MID26692254 Institution L</span>
<span class="co">#&gt; 134: MID26692254 Institution L</span>
<span class="co">#&gt; 135: MID26692254 Institution L</span></code></pre>
<p>In the <code>X[Y, j]</code> syntax, however, we can list the columns
to be returned from both data frames in the <code>j</code> list, that
is, <code>.(var1, var2, etc.)</code>, without subsetting the original
two data frames.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Repeat using X[Y, j] syntax</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">toy_student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">institution</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>

<span class="co"># Check equality </span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="degree-seeking">Degree seeking<a class="anchor" aria-label="anchor" href="#degree-seeking"></a>
</h2>
<p>Returning to the original context, we require only the IDs from our
data sufficient data frame.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Unique IDs that are data sufficient</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>
<span class="va">DT</span><span class="op">[</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;               mcid</span>
<span class="co">#&gt;             &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25783135</span>
<span class="co">#&gt;     2: MID25783162</span>
<span class="co">#&gt;     3: MID25783178</span>
<span class="co">#&gt;     4: MID25783195</span>
<span class="co">#&gt;     5: MID25783220</span>
<span class="co">#&gt;    ---            </span>
<span class="co">#&gt; 63948: MID26697574</span>
<span class="co">#&gt; 63949: MID26697576</span>
<span class="co">#&gt; 63950: MID26697599</span>
<span class="co">#&gt; 63951: MID26697615</span>
<span class="co">#&gt; 63952: MID26697623</span></code></pre>
<p>We now filter for degree seeking using the <code>student</code> data
table.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="va">DT</span><span class="op">[</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">#&gt;               mcid</span>
<span class="co">#&gt;             &lt;char&gt;</span>
<span class="co">#&gt;     1: MID25783135</span>
<span class="co">#&gt;     2: MID25783162</span>
<span class="co">#&gt;     3: MID25783178</span>
<span class="co">#&gt;     4: MID25783195</span>
<span class="co">#&gt;     5: MID25783220</span>
<span class="co">#&gt;    ---            </span>
<span class="co">#&gt; 63948: MID26697574</span>
<span class="co">#&gt; 63949: MID26697576</span>
<span class="co">#&gt; 63950: MID26697599</span>
<span class="co">#&gt; 63951: MID26697615</span>
<span class="co">#&gt; 63952: MID26697623</span></code></pre>
<p>The number of observations doesn’t change because the practice data
sets in midfielddata are all degree-seeking. This is not true of the
research data available to MIDFIELD partners.</p>
</div>
<div class="section level2">
<h2 id="closing">Closing<a class="anchor" aria-label="anchor" href="#closing"></a>
</h2>
<p>Starting with the <code>student</code> and <code>term</code> data
tables, we filtered the data for data sufficiency and degree seeking,
with a focus on applying inner joins using data.table syntax.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs">

</div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>We conclude each vignette by collecting its code chunks in a single,
condensed script for the convenience of those who wish to copy it into
their own R file.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfieldr" class="external-link">"midfieldr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MIDFIELDR/midfielddata" class="external-link">"midfielddata"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span>

<span class="co"># Printing options for data.table</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>
  datatable.print.nrows <span class="op">=</span> <span class="fl">55</span>,
  datatable.print.topn <span class="op">=</span> <span class="fl">5</span>,
  datatable.print.class <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Load data sets from midfielddata</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">student</span>, <span class="va">term</span><span class="op">)</span>

<span class="co"># Filter for data sufficiency</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_timely_term.html">add_timely_term</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_data_sufficiency.html">add_data_sufficiency</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">term</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">data_sufficiency</span> <span class="op">==</span> <span class="st">"include"</span><span class="op">]</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span><span class="op">]</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>

<span class="co"># Three equivalent inner joins</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span>, <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">toy_student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="va">toy_student</span><span class="op">[</span><span class="va">DT</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">cip6</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span><span class="op">)</span>

<span class="co"># Selecting columns</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>, <span class="va">toy_student</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">institution</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">toy_student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span>, <span class="va">institution</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>

<span class="co"># Degree seeking</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span><span class="op">]</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">)</span>
<span class="va">DT</span> <span class="op">&lt;-</span> <span class="va">DT</span><span class="op">[</span><span class="va">student</span>, <span class="fu">.</span><span class="op">(</span><span class="va">mcid</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mcid"</span><span class="op">)</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/graphdr" class="external-link">Richard Layton</a>, Russell Long, Matthew Ohland, Marisa Orr, Susan Lord, US National Science Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
