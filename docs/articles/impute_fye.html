<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Impute FYE starting majors • midfieldr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Impute FYE starting majors">
<meta property="og:description" content="midfieldr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">midfieldr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/using_midfieldr.html">Using midfieldr</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/explore_cip.html">Explore program CIP codes</a>
    </li>
    <li>
      <a href="../articles/gather_program_data.html">Gather program data</a>
    </li>
    <li>
      <a href="../articles/apply_grad_window.html">Apply the graduation window</a>
    </li>
    <li>
      <a href="../articles/compute_stickiness.html">Compute stickiness</a>
    </li>
    <li>
      <a href="../articles/explore_multiway.html">Explore multiway data</a>
    </li>
    <li>
      <a href="../articles/impute_fye.html">Impute FYE starting majors</a>
    </li>
    <li>
      <a href="../articles/compute_grad_rate.html">Compute graduation rate</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Papers/Talks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pages/talks.html">Talks</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/get_session_info.html">Session info</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../articles/pages/about_midfield.html">About</a>
</li>
<li>
  <a href="https://github.com/MIDFIELDR/midfieldr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="impute_fye_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Impute FYE starting majors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MIDFIELDR/midfieldr/blob/master/vignettes/impute_fye.Rmd"><code>vignettes/impute_fye.Rmd</code></a></small>
      <div class="hidden name"><code>impute_fye.Rmd</code></div>

    </div>

    
    
<p>Packages used in this article:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"dplyr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"knitr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"midfieldr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"midfielddata"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"seplyr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"stringr"</span>)</pre></body></html></div>
<p>If you also wish to run the imputation, you will also require:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"mice"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"visdat"</span>)</pre></body></html></div>
<div id="the-need-to-predict-a-starting-major" class="section level2">
<h2 class="hasAnchor">
<a href="#the-need-to-predict-a-starting-major" class="anchor"></a>The need to predict a starting major</h2>
<p>Some US institutions have first year engineering (FYE) programs—typically a common first year curriculum that is a prerequisite for declaring an engineering major. For these FYE students, some persistence metrics require us to predict their “starting major.”</p>
<p><strong>Starting major</strong>: The degree-granting engineering program—Civil Engineering, Electrical Engineering, Mechanical Engineering, etc.—that we predict the student would have declared had they not been required to enroll in FYE.</p>
<p>Predicting the starting major of FYE students takes one of two forms.</p>
<ol style="list-style-type: decimal">
<li><p>In the first instance, we have students who complete an FYE and declare an engineering major. This is the easy case–at the student’s first opportunity, they enrolled in an engineering major of their choosing. We use that major as our predicted starting major.</p></li>
<li><p>In the second instance, we have students who, after FYE, do not declare an engineering major. This is the more complicated case—the data provide no information regarding what engineering major the student would have declared originally had the institution not required them to enroll in FYE. For these students, we treat the starting major as missing data and impute a predicted value.</p></li>
</ol>
<p>Note that FYE students are neither undecided nor undeclared. Their institutions admitted them as engineering students. We just don’t know their preferred major. We have to predict the starting majors of FYE students to make fair comparisons across programs and institutions.</p>
</div>
<div id="we-provide-an-imputed-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#we-provide-an-imputed-data-set" class="anchor"></a>We provide an imputed data set</h2>
<p>We impute these missing values using multiple imputation as implemented in the <a href="https://stefvanbuuren.github.io/mice/">mice</a> package (multivariate imputation via chained equations). The variables used to predict the missing values are institution, race, and sex.</p>
<p>The process is described in detail starting in the subsequent section. The process does take time—about 30 seconds for imputing the missing values in our FYE data with 5992 observations, 5 variables, and 5 imputations.</p>
<p>You can skip doing the imputation yourself if you wish. We’ve done it for you and saved the results. We provide a replacement data set <code>cip_fye</code> with the ID and predicted starting major of all FYE students in the midfieldr data sets.</p>
<p>We use these data in the package vignettes whenever an engineering starting major is required. You can do the same.</p>
<p>To access the case data, just load midfieldr and assign <code>cip_fye</code> to a variable. To distinguish the starting major from other 6-digit CIP codes used in this work, the imputed variable is <code>start</code> instead of <code>cip6</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># if midfieldr is loaded, assign the bundled data set to a variable</span>
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">cip_fye</span>

<span class="co"># examine the result</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="no">df</span>)
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25877315", "MID25896490", "MID25916711", "MID25921297", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; "140901", "141001", "141001", "140701", "140701", "141901", "1...</span></pre></body></html></div>
</div>
<div id="preparing-the-fye-data-for-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-fye-data-for-imputation" class="anchor"></a>Preparing the FYE data for imputation</h2>
<p>You may skip the rest of the vignette and simply incorporate the imputed data <code>cip_fye</code> in your analysis if the details of imputation are not important to you at this time.</p>
<p>If the details are of interest to you, we start by conditioning the data to prepare it for imputation.</p>
<p><strong>Step 1.</strong> Extract from <code>midfieldstudents</code> the IDs of all students whose matriculation major is FYE.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">fye_id</span> <span class="kw">&lt;-</span> <span class="no">midfieldstudents</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">cip6</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"14XXXX"</span>, <span class="st">"14YYYY"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 1</span>
<span class="co">#&gt; $ id &lt;chr&gt; "MID25783162", "MID25783166", "MID25783167", "MID25783178", "MID...</span></pre></body></html></div>
<p>Extract from <code>midfieldterms</code> all the term data for these students. <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join(x, y)</a></code> returns all rows from x where there are matching values in y, keeping just columns from x.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">all_fye_terms</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span>(<span class="no">midfieldterms</span>, <span class="no">fye_id</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">cip6</span>, <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 51,391</span>
<span class="co">#&gt; Columns: 3</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25783162", "MID25783162", "MID25783162", "MID25783162", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; "14XXXX", "14XXXX", "520301", "520301", "520301", "520301", "5...</span>
<span class="co">#&gt; $ term &lt;dbl&gt; 19921, 19923, 19931, 19933, 19941, 19943, 19951, 19953, 19961,...</span></pre></body></html></div>
<p><strong>Step 2.</strong> Subset the students who declare an engineering major after FYE.</p>
<p>Keeping those terms in which FYE is the declared major, we arrange the rows by ID and <em>descending</em> term. Then, grouped by ID, each first row is a student’s final FYE term, denoted <code>end_fye</code>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">last_fye_terms</span> <span class="kw">&lt;-</span> <span class="no">all_fye_terms</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">cip6</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"14XXXX"</span>, <span class="st">"14YYYY"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">id</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(<span class="no">term</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="kw">end_fye</span> <span class="kw">=</span> <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,220</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id      &lt;chr&gt; "MID25783162", "MID25783166", "MID25783167", "MID25783178",...</span>
<span class="co">#&gt; $ end_fye &lt;dbl&gt; 19923, 20093, 20053, 19961, 19873, 20063, 20053, 20063, 198...</span></pre></body></html></div>
<p>We join the column <code>end_fye</code> to the <code>all_fye_terms</code> data frame. <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join(x, y)</a></code> returns all rows from x, and all columns from x and y. All multiple matches between x and y are returned.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fye_to_engr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">all_fye_terms</span>, <span class="no">last_fye_terms</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>)</pre></body></html></div>
<p>Arranging by ID and <em>ascending</em> term and grouped by ID, each first row is a student’s first term after FYE.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fye_to_engr</span> <span class="kw">&lt;-</span> <span class="no">fye_to_engr</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">term</span> <span class="kw">&gt;</span> <span class="no">end_fye</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">id</span>, <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</pre></body></html></div>
<p>Because this data frame denotes students transitioning to an engineering major, we filter to keep only those whose CIP starts with “14.” For these students, the predicted starting major is their declared engineering major after FYE.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">fye_to_engr</span> <span class="kw">&lt;-</span> <span class="no">fye_to_engr</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="no">cip6</span>, <span class="st">"^14"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">cip6</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 3,368</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25783167", "MID25783178", "MID25783197", "MID25783199", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; "140901", "140701", "140701", "140301", "140701", "140501", "1...</span></pre></body></html></div>
<p><strong>Step 3.</strong> The remaining FYE students have an unknown starting major.</p>
<p>Starting with the IDs of all students in FYE and removing the IDs of students who have declared an engineering major after FYE yields the IDs of students whose starting major will have to be imputed. <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join(x, y)</a></code> returns all rows from x where there are not matching values in y, keeping just columns from x.</p>
<p>For these students, the predicted starting major after FYE is assumed missing (NA).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">fye_to_nonengr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span>(<span class="no">fye_id</span>, <span class="no">fye_to_engr</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cip6</span> <span class="kw">=</span> <span class="fl">NA_character_</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 2,624</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25783162", "MID25783166", "MID25783227", "MID25783428", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...</span></pre></body></html></div>
<p><strong>Step 4.</strong> Combine the two data frames and finish the data preparation.</p>
<p>Bind the two data frames.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">fye_start</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">fye_to_engr</span>, <span class="no">fye_to_nonengr</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25783167", "MID25783178", "MID25783197", "MID25783199", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; "140901", "140701", "140701", "140301", "140701", "140501", "1...</span></pre></body></html></div>
<p>Extract from <code>midfieldstudents</code> the institution names by student ID. <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join(x, y)</a></code> returns all rows from x where there are matching values in y, keeping just columns from x.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">inst_id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span>(<span class="no">midfieldstudents</span>, <span class="no">fye_start</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">institution</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id          &lt;chr&gt; "MID25783162", "MID25783166", "MID25783167", "MID257831...</span>
<span class="co">#&gt; $ institution &lt;chr&gt; "Institution M", "Institution M", "Institution M", "Ins...</span></pre></body></html></div>
<p>Join the institutions to the FYE starters data frame and add race and sex using <code><a href="../reference/race_sex_join.html">race_sex_join()</a></code>. We assume that these variables are appropriate predictors.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">fye_start</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">fye_start</span>, <span class="no">inst_id</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/race_sex_join.html">race_sex_join</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">institution</span>, <span class="no">race</span>, <span class="no">sex</span>, <span class="no">cip6</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 5</span>
<span class="co">#&gt; $ id          &lt;chr&gt; "MID25783167", "MID25783178", "MID25783197", "MID257831...</span>
<span class="co">#&gt; $ institution &lt;chr&gt; "Institution M", "Institution M", "Institution M", "Ins...</span>
<span class="co">#&gt; $ race        &lt;chr&gt; "White", "Black", "White", "White", "White", "White", "...</span>
<span class="co">#&gt; $ sex         &lt;chr&gt; "Male", "Male", "Male", "Female", "Male", "Male", "Male...</span>
<span class="co">#&gt; $ cip6        &lt;chr&gt; "140901", "140701", "140701", "140301", "140701", "1405...</span></pre></body></html></div>
<p>Convert the character variables to factors to use with mice. The resulting data frame <code>mi_input</code> is ready to be operated on by mice.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">mi_input</span> <span class="kw">&lt;-</span> <span class="no">fye_start</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">institution</span>, <span class="no">race</span>, <span class="no">sex</span>, <span class="no">cip6</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">institution</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">institution</span>),
    <span class="kw">race</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">race</span>),
    <span class="kw">sex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">sex</span>),
    <span class="kw">cip6</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">cip6</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 5</span>
<span class="co">#&gt; $ id          &lt;chr&gt; "MID25877315", "MID25896490", "MID25916711", "MID259212...</span>
<span class="co">#&gt; $ institution &lt;fct&gt; Institution B, Institution B, Institution B, Institutio...</span>
<span class="co">#&gt; $ race        &lt;fct&gt; Asian, Asian, Asian, Asian, Asian, Asian, Asian, Asian,...</span>
<span class="co">#&gt; $ sex         &lt;fct&gt; Female, Female, Female, Female, Female, Female, Male, M...</span>
<span class="co">#&gt; $ cip6        &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...</span></pre></body></html></div>
</div>
<div id="imputing-missing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#imputing-missing-data" class="anchor"></a>Imputing missing data</h2>
<p>The mice package <span class="citation">(van Buuren and Groothuis-Oudshoorn 2011)</span> implements multivariate imputation by chained equations (MICE). MICE is also known as “fully conditional specification” or “sequential regression multiple imputation” and is suitable for categorical variables such as ours <span class="citation">(Azur et al. 2011)</span>. Our computational procedure follows the approach suggested by Dhana <span class="citation">(2017)</span>.</p>
<p>The procedure assumes the missing data are “missing at random” (MAR), that is, independent of the variables used to impute the missing values. This is the rationale for using data only from FYE institutions to impute the missing values—the existence if the missing data does depend on the institution type, FYE or non-FYE. Within the FYE data itself, however, we assume that the imputed starting majors are missing at random.</p>
<p>Use <code><a href="http://visdat.njtierney.com//reference/vis_miss.html">visdat::vis_miss()</a></code> to see the pattern of missing data. As expected, all the missing values are in the <code>start</code> column.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="http://visdat.njtierney.com//reference/vis_miss.html">vis_miss</a></span>(<span class="no">mi_input</span>, <span class="kw">cluster</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">sort_miss</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="../man/figures/fye-mice-in-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Initialize parameters.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">init</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://stefvanbuuren.github.io/mice/reference/mice.html">mice</a></span>(<span class="no">mi_input</span>, <span class="kw">maxit</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">meth</span> <span class="kw">&lt;-</span> <span class="no">init</span>$<span class="no">method</span>
<span class="no">predM</span> <span class="kw">&lt;-</span> <span class="no">init</span>$<span class="no">predictorMatrix</span></pre></body></html></div>
<p>Identify variables not used as predictors.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">predM</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"id"</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span></pre></body></html></div>
<p>Assign variables not imputed. (In this case, this step could be skipped because a mice default is to not impute variables with zero missing values.)</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">meth</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"id"</span>, <span class="st">"institution"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span>)] <span class="kw">&lt;-</span> <span class="st">""</span></pre></body></html></div>
<p>Assign the imputation method. For unordered categorical data with more than two levels, the suggested method is “polyreg” (polytomous regression).</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">meth</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cip6"</span>)] <span class="kw">&lt;-</span> <span class="st">"polyreg"</span></pre></body></html></div>
<p>Run the multiple (m = 5) imputations. The seed is set for reproducible results. On my Windows machine, this imputation takes about 30 seconds.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">mi_output</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://stefvanbuuren.github.io/mice/reference/mice.html">mice</a></span>(
  <span class="no">mi_input</span>,
  <span class="kw">method</span> <span class="kw">=</span> <span class="no">meth</span>,
  <span class="kw">predictorMatrix</span> <span class="kw">=</span> <span class="no">predM</span>,
  <span class="kw">m</span> <span class="kw">=</span> <span class="fl">5</span>,
  <span class="kw">printFlag</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">20180624</span>
)</pre></body></html></div>
</div>
<div id="data-set-cip_fye" class="section level2">
<h2 class="hasAnchor">
<a href="#data-set-cip_fye" class="anchor"></a>Data set: <code>cip_fye</code>
</h2>
<p>Construct the data set after imputation, keeping ID and starting major only. Reformat the start major as a character. The data frame, <code>cip_fye</code>, is the data mentioned previously provided with the midfieldr package if you prefer not to do your own imputation.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">cip_fye</span> <span class="kw">&lt;-</span> <span class="kw pkg">mice</span><span class="kw ns">::</span><span class="fu"><a href="http://stefvanbuuren.github.io/mice/reference/complete.mids.html">complete</a></span>(<span class="no">mi_output</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">cip6</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cip6</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">cip6</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()
<span class="co">#&gt; Rows: 5,992</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ id   &lt;chr&gt; "MID25877315", "MID25896490", "MID25916711", "MID25921297", "M...</span>
<span class="co">#&gt; $ cip6 &lt;chr&gt; "140901", "141001", "141001", "140701", "140701", "141901", "1...</span></pre></body></html></div>
<p>Total number of FYE students in <code>midfieldstudents</code> is 5992.</p>
</div>
<div id="assessing-the-imputation-" class="section level2">
<h2 class="hasAnchor">
<a href="#assessing-the-imputation-" class="anchor"></a>Assessing the imputation.</h2>
<p>Confirm there are no missing values using <code>vis_dat::vis_dat()</code>. The result shows that all variables are characters and there are no missing values.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="http://visdat.njtierney.com//reference/vis_dat.html">vis_dat</a></span>(<span class="no">cip_fye</span>, <span class="kw">palette</span> <span class="kw">=</span> <span class="st">"cb_safe"</span>)</pre></body></html></div>
<p><img src="../man/figures/fye-mice-out-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>Examine to what majors and in what numbers the FYE students were assigned.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">cip_fye</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/seplyr/man/group_summarize.html">group_summarise</a></span>(<span class="no">.</span>, <span class="st">"cip6"</span>, <span class="kw">N</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(<span class="no">N</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">.</span>, <span class="no">cip</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"cip6"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">cip4</span>, <span class="no">cip4name</span>, <span class="no">N</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
cip4
</th>
<th style="text-align:left;">
cip4name
</th>
<th style="text-align:right;">
N
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1419
</td>
<td style="text-align:left;">
Mechanical Engineering
</td>
<td style="text-align:right;">
1565
</td>
</tr>
<tr>
<td style="text-align:left;">
1408
</td>
<td style="text-align:left;">
Civil Engineering
</td>
<td style="text-align:right;">
895
</td>
</tr>
<tr>
<td style="text-align:left;">
1410
</td>
<td style="text-align:left;">
Electrical, Electronics and Communications Engineering
</td>
<td style="text-align:right;">
811
</td>
</tr>
<tr>
<td style="text-align:left;">
1409
</td>
<td style="text-align:left;">
Computer Engineering, General
</td>
<td style="text-align:right;">
617
</td>
</tr>
<tr>
<td style="text-align:left;">
1435
</td>
<td style="text-align:left;">
Industrial Engineering
</td>
<td style="text-align:right;">
572
</td>
</tr>
<tr>
<td style="text-align:left;">
1407
</td>
<td style="text-align:left;">
Chemical Engineering
</td>
<td style="text-align:right;">
474
</td>
</tr>
<tr>
<td style="text-align:left;">
1402
</td>
<td style="text-align:left;">
Aerospace, Aeronautical and Astronautical Engineering
</td>
<td style="text-align:right;">
455
</td>
</tr>
<tr>
<td style="text-align:left;">
1403
</td>
<td style="text-align:left;">
Agricultural, Biological Engineering and Bioengineering
</td>
<td style="text-align:right;">
128
</td>
</tr>
<tr>
<td style="text-align:left;">
1406
</td>
<td style="text-align:left;">
Ceramic Sciences and Engineering
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
1421
</td>
<td style="text-align:left;">
Mining and Mineral Engineering
</td>
<td style="text-align:right;">
98
</td>
</tr>
<tr>
<td style="text-align:left;">
1411
</td>
<td style="text-align:left;">
Engineering Mechanics
</td>
<td style="text-align:right;">
97
</td>
</tr>
<tr>
<td style="text-align:left;">
1418
</td>
<td style="text-align:left;">
Materials Engineering
</td>
<td style="text-align:right;">
82
</td>
</tr>
<tr>
<td style="text-align:left;">
1405
</td>
<td style="text-align:left;">
Biomedical, Medical Engineering
</td>
<td style="text-align:right;">
75
</td>
</tr>
<tr>
<td style="text-align:left;">
1428
</td>
<td style="text-align:left;">
Textile Sciences and Engineering
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
1423
</td>
<td style="text-align:left;">
Nuclear Engineering
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
1433
</td>
<td style="text-align:left;">
Construction Engineering
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
1499
</td>
<td style="text-align:left;">
Engineering, Other
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs">
<div id="ref-azur2011">
<p>Azur, Melissa J., Elizabeth A. Stuart, Constantine Frangakis, and Philip J. Leaf. 2011. “Multiple Imputation by Chained Equations: What Is It and How Does It Work?” <em>International Journal of Methods in Psychiatric Research</em> 20 (1): 40–49.</p>
</div>
<div id="ref-dhana2017">
<p>Dhana, Klodian. 2017. “Handling Missing Data with MICE Package: A Simple Approach.” Edited by Data Science Plus. <a href="https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/">https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach/</a>.</p>
</div>
<div id="ref-vanbuuren2011">
<p>van Buuren, Stef, and Karin Groothuis-Oudshoorn. 2011. “mice: Multivariate Imputation by Chained Equations in R.” <em>Journal of Statistical Software</em> 45 (3): 1–67. <a href="https://www.jstatsoft.org/v45/i03/">https://www.jstatsoft.org/v45/i03/</a>.</p>
</div>
</div>
</div>
<div id="appendix" class="section level2">
<h2 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h2>
<div id="complete-script" class="section level3">
<h3 class="hasAnchor">
<a href="#complete-script" class="anchor"></a>Complete script</h3>
<p>In response to requests from some of our workshop attendees, we collect the vignette code chunks in one script. We condense the script by omitting exploratory steps so we can focus on the steps that produce the results.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"># TBD</pre></body></html></div>
<p><br><a href="#top">▲ top of page </a><br><a href="../index.html">◁ main page </a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard Layton, Russell Long, Matthew Ohland, US National Science Foundation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
